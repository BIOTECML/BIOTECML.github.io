<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MachineLearning - 5&nbsp; Introducción al análisis de datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_SupervisedAA.html" rel="next">
<link href="./02_FirstStepsAA.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos coincidentes",
    "search-copy-link-title": "Copiar enlace para buscar",
    "search-hide-matches-text": "Ocultar coincidencias adicionales",
    "search-more-match-text": "más coincidencia en este documento",
    "search-more-matches-text": "más coincidencias en este documento",
    "search-clear-button-title": "Limpiar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Entregar"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MachineLearning</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Prefacio</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./01_IntroCourse.html" class="sidebar-item-text sidebar-link">Parte 1. Introducción</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_introAD.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_introAA.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introducción al Aprendizaje Automático (AA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_RandRstudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducción a R y RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./40_DataBases.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bases de datos</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_FirstStepsAA.html" class="sidebar-item-text sidebar-link">Parte 2. Primeros pasos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_AED.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_SupervisedAA.html" class="sidebar-item-text sidebar-link">Parte 3. Aprendizaje supervisado</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_RegressionModels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos de Regresión</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_LogisticModels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de Regresión Logística</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./80_SurvivalModels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modelos de supervivencia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90_BayesianClassif.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modelos de clasificación Naïve Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100_kNNmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Modelo de los k vecinos más cercanos (kNN)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110_SVMmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Máquinas de Vector Soporte (SVM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120_DTmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Árboles de decisiónn (DT)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130_Ensemblemodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Modelos de conjunto (Ensemble models)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140_Boostingmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modelos Boosting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./04_NonSupervisedAA.html" class="sidebar-item-text sidebar-link">Parte 4. Aprendizaje no supervisado</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./150_Discriminantmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Análisis discriminante (AD)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./160_PrinCompmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Componentes principales (CP)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./170_MDSmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Métodos de escalado multidimensional (MDS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./180_Clustermodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Análisis cluster</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referencias</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#sec-50.1" id="toc-sec-50.1" class="nav-link active" data-scroll-target="#sec-50.1"><span class="toc-section-number">5.1</span>  Librerías para el AED</a>
  <ul>
  <li><a href="#sec-aedskimr" id="toc-sec-aedskimr" class="nav-link" data-scroll-target="#sec-aedskimr"><span class="toc-section-number">5.1.1</span>  Análisis exploratorio con <code>skimr</code></a>
  <ul class="collapse">
  <li><a href="#datos-iris" id="toc-datos-iris" class="nav-link" data-scroll-target="#datos-iris"><span class="toc-section-number">5.1.1.1</span>  Datos iris</a></li>
  <li><a href="#datos-penguins" id="toc-datos-penguins" class="nav-link" data-scroll-target="#datos-penguins"><span class="toc-section-number">5.1.1.2</span>  Datos Penguins</a></li>
  </ul></li>
  <li><a href="#sec-aeddataexplorer" id="toc-sec-aeddataexplorer" class="nav-link" data-scroll-target="#sec-aeddataexplorer"><span class="toc-section-number">5.1.2</span>  Análisis exploratorio con <code>DataExplorer</code></a>
  <ul class="collapse">
  <li><a href="#datos-iris-1" id="toc-datos-iris-1" class="nav-link" data-scroll-target="#datos-iris-1"><span class="toc-section-number">5.1.2.1</span>  Datos Iris</a></li>
  <li><a href="#datos-penguins-1" id="toc-datos-penguins-1" class="nav-link" data-scroll-target="#datos-penguins-1"><span class="toc-section-number">5.1.2.2</span>  Datos Penguins</a></li>
  </ul></li>
  <li><a href="#sec-aedggally" id="toc-sec-aedggally" class="nav-link" data-scroll-target="#sec-aedggally"><span class="toc-section-number">5.1.3</span>  Análisis exploratorio con <code>GGally</code></a>
  <ul class="collapse">
  <li><a href="#datos-iris-2" id="toc-datos-iris-2" class="nav-link" data-scroll-target="#datos-iris-2"><span class="toc-section-number">5.1.3.1</span>  Datos Iris</a></li>
  <li><a href="#datos-penguins-2" id="toc-datos-penguins-2" class="nav-link" data-scroll-target="#datos-penguins-2"><span class="toc-section-number">5.1.3.2</span>  Datos Penguins</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-50.2" id="toc-sec-50.2" class="nav-link" data-scroll-target="#sec-50.2"><span class="toc-section-number">5.2</span>  Librerías para el AA</a>
  <ul>
  <li><a href="#sec-50.2.1" id="toc-sec-50.2.1" class="nav-link" data-scroll-target="#sec-50.2.1"><span class="toc-section-number">5.2.1</span>  Ecosistema mlr3</a></li>
  <li><a href="#sec-50.2.2" id="toc-sec-50.2.2" class="nav-link" data-scroll-target="#sec-50.2.2"><span class="toc-section-number">5.2.2</span>  Crear un modelo con mlr3</a>
  <ul class="collapse">
  <li><a href="#sec-task" id="toc-sec-task" class="nav-link" data-scroll-target="#sec-task"><span class="toc-section-number">5.2.2.1</span>  Task</a></li>
  <li><a href="#sec-traintest" id="toc-sec-traintest" class="nav-link" data-scroll-target="#sec-traintest"><span class="toc-section-number">5.2.2.2</span>  Division de muestras</a></li>
  <li><a href="#sec-preprocesed" id="toc-sec-preprocesed" class="nav-link" data-scroll-target="#sec-preprocesed"><span class="toc-section-number">5.2.2.3</span>  Preprocesado de datos</a></li>
  <li><a href="#sec-learner" id="toc-sec-learner" class="nav-link" data-scroll-target="#sec-learner"><span class="toc-section-number">5.2.2.4</span>  Modelo (learner)</a></li>
  <li><a href="#sec-validation" id="toc-sec-validation" class="nav-link" data-scroll-target="#sec-validation"><span class="toc-section-number">5.2.2.5</span>  Validación</a></li>
  <li><a href="#sec-benchmarking" id="toc-sec-benchmarking" class="nav-link" data-scroll-target="#sec-benchmarking"><span class="toc-section-number">5.2.2.6</span>  Benchmarking</a></li>
  <li><a href="#sec-tunnig" id="toc-sec-tunnig" class="nav-link" data-scroll-target="#sec-tunnig"><span class="toc-section-number">5.2.2.7</span>  Optimización de hiperparámetros</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-50.3" id="toc-sec-50.3" class="nav-link" data-scroll-target="#sec-50.3"><span class="toc-section-number">5.3</span>  Consideraciones finales</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-50" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Antes de entrenar un modelo de aprendizaje automático, o incluso antes de realizar cualquier cálculo con un nuevo conjunto de datos, es muy importante realizar una exploración descriptiva de los mismos. Este proceso permite entender mejor qué información contiene cada variable, así como detectar posibles errores. Algunos ejemplos frecuentes son:</p>
<ul>
<li><p>Que una columna se haya almacenado con el tipo incorrecto: una variable numérica está siendo reconocida como texto o viceversa.</p></li>
<li><p>Que una variable contenga valores que no tienen sentido: por ejemplo, para indicar que no se dispone del precio de una vivienda se introduce el valor 0 o un espacio en blanco.</p></li>
<li><p>Que en una variable de tipo numérico se haya introducido una palabra en lugar de un número.</p></li>
</ul>
<p>Además, este análisis inicial puede dar pistas sobre qué variables son adecuadas como predictores en un modelo de aprendizaje (algo que profundizaremos en unidades posteriores).</p>
<p>En <code>R</code> existen multitud de paquetes que permiten el análisis exploratorio de datos, entre los que podemos destacar los presentados en la <a href="30_RandRstudio.html"><span>Unidad&nbsp;3</span></a>, pero en estos materiales vamos a hacer uso de tres paquetes que nos permiten una mejor comprensión del análisis exploratorio de datos gracias a sus funciones preconfiguradas.</p>
<section id="sec-50.1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sec-50.1"><span class="header-section-number">5.1</span> Librerías para el AED</h2>
<p>Los tres paquetes que vamos a utilizar son:</p>
<ul>
<li><a href="https://docs.ropensci.org/skimr/"><code>skimr</code></a> <span class="citation" data-cites="skimr">(<a href="references.html#ref-skimr" role="doc-biblioref">Waring et al. 2022</a>)</span>, que está diseñado para proporcionar estadísticas resumidas sobre variables en marcos de datos, tibbles, tablas de datos y vectores. Su valores predeterminados proporcionan buenos resultados, pero resultan fácil de modificar si es necesario.</li>
<li><a href="https://boxuancui.github.io/DataExplorer/"><code>DataExplorer</code></a><span class="citation" data-cites="dataexplorer">(<a href="references.html#ref-dataexplorer" role="doc-biblioref">Cui 2020</a>)</span>, que tiene como objetivo automatizar la mayor parte del manejo y la visualización de datos, para que los usuarios puedan concentrarse en estudiar los datos y extraer información.</li>
<li><code>GGally</code><span class="citation" data-cites="ggally">(<a href="references.html#ref-ggally" role="doc-biblioref">Schloerke et al. 2021</a>)</span>, que extiende <code>ggplot2</code>` agregando varias funciones para reducir la complejidad de combinar geoms con datos transformados. Algunas de estas funciones incluyen una matriz de gráficos por pares, una matriz de gráficos de dispersión, un gráfico de coordenadas paralelas, un gráfico de supervivencia y varias funciones para trazar redes.</li>
</ul>
<p>Antes de comenzar vamos a instalar los paquetes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"skimr"</span>,<span class="st">"DataExplorer"</span>,<span class="st">"GGally"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cargamos ahora los paquetes y vemos la versión que estamos utilizando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="fu">packageVersion</span>(<span class="st">"skimr"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '2.1.5'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">packageVersion</span>(<span class="st">"DataExplorer"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '0.8.2'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">packageVersion</span>(<span class="st">"GGally"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '2.1.2'</code></pre>
</div>
</div>
<p>Cargamos también los paquetes básicos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Paquetes anteriores</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">library</span>(knitr) <span class="co"># para formatos de tablas</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">theme_set</span>(<span class="fu">theme_sjplot2</span>())</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ya estamos en disposición de poder usar estos paquetes para el análisis exploratorio de datos. Para ejemplificar su uso utilizaremos los bancos de datos <code>Penguin</code> e <code>Iris</code> que introdujimos en la <a href="40_DataBases.html"><span>Unidad&nbsp;4</span></a>. Más concretamente en los apartados <a href="40_DataBases.html#sec-penguins"><span>4.2.6</span></a> y <a href="40_DataBases.html#sec-iris"><span>4.3.3</span></a>.</p>
<p>Antes de mostrar el uso de los paquetes anteriores vamos a cargar los datos que utilizaremos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>penguins <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"penguins.rds"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos a desechar las variables <code>Id</code> y <code>year</code> (por el momento) y generamos un nuevo marco de datos para no modificar el archivo original.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># indicamos las variables que debemos eliminar</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>borrar <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Id"</span>,<span class="st">"year"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># generamos el nuevo banco de datos eliminando esas variables</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>data_penguins <span class="ot">=</span> penguins <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>borrar)</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># vemos los primeros casos</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="fu">kable</span>(<span class="fu">head</span>(data_penguins))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 21%">
<col style="width: 14%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">island</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
<th style="text-align: right;">flipper_length_mm</th>
<th style="text-align: right;">body_mass_g</th>
<th style="text-align: left;">sex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.1</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">3750</td>
<td style="text-align: left;">male</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.5</td>
<td style="text-align: right;">17.4</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">3800</td>
<td style="text-align: left;">female</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">40.3</td>
<td style="text-align: right;">18.0</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">3250</td>
<td style="text-align: left;">female</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">36.7</td>
<td style="text-align: right;">19.3</td>
<td style="text-align: right;">193</td>
<td style="text-align: right;">3450</td>
<td style="text-align: left;">female</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adelie</td>
<td style="text-align: left;">Torgersen</td>
<td style="text-align: right;">39.3</td>
<td style="text-align: right;">20.6</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">3650</td>
<td style="text-align: left;">male</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Cargamos ahora el banco de datos iris:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>iris <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"iris.rds"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generamos el nuevo banco de datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># generamos el nuevo banco de datos</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>data_iris <span class="ot">=</span> iris</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co"># vemos los primeros casos</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">kable</span>(<span class="fu">head</span>(data_iris))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">sepal_length</th>
<th style="text-align: right;">sepal_width</th>
<th style="text-align: right;">petal_length</th>
<th style="text-align: right;">petal_width</th>
<th style="text-align: left;">species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">Iris-setosa</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-aedskimr" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="sec-aedskimr"><span class="header-section-number">5.1.1</span> Análisis exploratorio con <code>skimr</code></h3>
<p>La función central de <code>skimr</code> es <code>skim()</code>, que está diseñada para trabajar con data frames (agrupados). Al igual que <code>summary()</code>, que es la función por defecto para resúmenes numéricos que tenemos a nuestra disposición en <code>R,</code> la función <code>skim()</code> presenta un informe de resultados para cada columna del data frame; cuyas estadísticas dependen de la clase de cada una de las variables. Los resultados se estructuran según el tipo de variable.</p>
<section id="datos-iris" class="level4" data-number="5.1.1.1">
<h4 data-number="5.1.1.1" class="anchored" data-anchor-id="datos-iris"><span class="header-section-number">5.1.1.1</span> Datos iris</h4>
<p>Comenzamos con los datos iris, donde la variable de interés para nuestro modelo de aprendizaje automático es `Species`, con un análisis completo de todas las variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">skim</span>(data_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_iris</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">150</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">species</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Iri: 50, Iri: 50, Iri: 50</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sepal_length</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.84</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">4.3</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">5.80</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">7.9</td>
<td style="text-align: left;">▆▇▇▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">sepal_width</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: left;">▁▅▇▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">petal_length</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.76</td>
<td style="text-align: right;">1.76</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: left;">▇▁▆▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">petal_width</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">▇▁▇▅▃</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Los resultados se estructuran en tres tablas:</p>
<ul>
<li>En la primera tenemos información sobre el nombre y dimensiones del data frame, así como el número de variables numéricas y factores.</li>
<li>En la segunda tabla tenemos la información sobre las variables de tipo factor:
<ul>
<li><code>skim_variable</code>: nombre de la variable.</li>
<li><code>n_missing</code>: número de valores perdidos.</li>
<li><code>complete_rate</code>: ratio de valores completos (1 = sin valores perdidos).</li>
<li><code>ordered</code>: valor boleano para indicar si los niveles del factor están ordenados.</li>
<li><code>n_unique</code>: valores únicos de la variable.</li>
<li><code>top_counts</code>: frecuencia de cada uno de los valores de la variable.</li>
</ul></li>
<li>En la última tabla tenemos la información sobre las variables de tipo numéricas:
<ul>
<li><code>skim_variable</code>: nombre de la variable.</li>
<li><code>n_missing</code>: número de valores perdidos.</li>
<li><code>complete_rate</code>: ratio de valores completos (1 = sin valores perdidos).</li>
<li><code>mean</code>: media de la variable.</li>
<li><code>sd</code>: desviación típica de la variable.</li>
<li><code>p0</code>: mínimo de la variable.</li>
<li><code>p25</code>: percentil 25 de la variable.</li>
<li><code>p50</code>: percentil 50 (mediana) de la variable.</li>
<li><code>p75</code>: percentil 75 de la variable.</li>
<li><code>p100</code>: máximo de la variable.</li>
<li><code>hist</code>: histograma de valores de la variable.</li>
</ul></li>
</ul>
<p>Los resultado obtenidos nos permiten tener una primera visión del comportamiento de cada una de las variables que componen el banco de datos. Sin embargo, dado que nuestro objetivo es conocer el poder de clasificación de cada una de las variables predictoras para establecer la clasificación de especies, parece lógico que orientemos nuestro análisis descriptivo preliminar en esta línea. Para ello podemos utilizar una modificación de la función anterior donde establecemos el análisis para cada predictora en función de la variable <code>species.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>data_iris <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">skim</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">dplyr::group_by(data_iris…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">150</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">species</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: left;">species</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sepal_length</td>
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.01</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">4.3</td>
<td style="text-align: right;">4.80</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">5.20</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: left;">▃▃▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">sepal_length</td>
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.94</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: right;">5.90</td>
<td style="text-align: right;">6.30</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: left;">▂▇▆▃▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sepal_length</td>
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.59</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">6.23</td>
<td style="text-align: right;">6.50</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: right;">7.9</td>
<td style="text-align: left;">▁▃▇▃▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">sepal_width</td>
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.42</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">3.68</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: left;">▁▅▇▃▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sepal_width</td>
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2.52</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: left;">▁▅▆▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">sepal_width</td>
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: left;">▂▆▇▅▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">petal_length</td>
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.46</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: left;">▁▃▇▃▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">petal_length</td>
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.26</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">4.60</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: left;">▂▂▇▇▆</td>
</tr>
<tr class="odd">
<td style="text-align: left;">petal_length</td>
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.55</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5.10</td>
<td style="text-align: right;">5.55</td>
<td style="text-align: right;">5.88</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: left;">▃▇▇▃▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">petal_width</td>
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: left;">▇▂▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">petal_width</td>
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: left;">▅▇▃▆▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">petal_width</td>
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.03</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">1.80</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: left;">▂▇▆▅▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Ahora podemos comparar numéricamente el efecto de cada predictora en función de las diferentes especies de flor. Podemos ver que:</p>
<ul>
<li>Para <code>sepal_length</code> la especie con mayor valor en media es <code>virginica</code> con bastante diferencia de <code>setosa</code>, que es la que tiene el valor más bajo. Algo similar ocurre con las variabilidades, en términos de desviaciones típicas.</li>
<li>Para <code>sepal_width</code> todas las especies son muy parecidas (medias y desviaciones típicas similares).</li>
<li>Tanto para <code>petal_length</code> y <code>petal_width</code> se observan diferencias entre las especies, tanto en términos de los valores medios como de las variabilidades.Veamos ahora</li>
</ul>
<p>Veamos ahora con el otro conjunto de datos.</p>
</section>
<section id="datos-penguins" class="level4" data-number="5.1.1.2">
<h4 data-number="5.1.1.2" class="anchored" data-anchor-id="datos-penguins"><span class="header-section-number">5.1.1.2</span> Datos Penguins</h4>
<p>Como en el caso anterior realizamos un análisis completo de todo el banco de datos. En este caso el target es una variable numérica por lo que no resulta posible distinguir los resultados por dicho valor, aunque en el conjunto de predictoras si tenemos variables de agrupación. Lo habitual en este tipo de situaciones es evaluar como aumenta o disminuye el valor del target en función de las posibles predictoras. En los puntos siguientes veremos como utilizar los otros dos paquetes para analizar esta situación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">skim</span>(data_penguins)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_penguins</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">344</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 16%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">species</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Ade: 152, Gen: 124, Chi: 68</td>
</tr>
<tr class="even">
<td style="text-align: left;">island</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Bis: 168, Dre: 124, Tor: 52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">mal: 168, fem: 165</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 17%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bill_length_mm</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">43.92</td>
<td style="text-align: right;">5.46</td>
<td style="text-align: right;">32.1</td>
<td style="text-align: right;">39.23</td>
<td style="text-align: right;">44.45</td>
<td style="text-align: right;">48.5</td>
<td style="text-align: right;">59.6</td>
<td style="text-align: left;">▃▇▇▆▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">bill_depth_mm</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">17.15</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">13.1</td>
<td style="text-align: right;">15.60</td>
<td style="text-align: right;">17.30</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">21.5</td>
<td style="text-align: left;">▅▅▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flipper_length_mm</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">200.92</td>
<td style="text-align: right;">14.06</td>
<td style="text-align: right;">172.0</td>
<td style="text-align: right;">190.00</td>
<td style="text-align: right;">197.00</td>
<td style="text-align: right;">213.0</td>
<td style="text-align: right;">231.0</td>
<td style="text-align: left;">▂▇▃▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">body_mass_g</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">4201.75</td>
<td style="text-align: right;">801.95</td>
<td style="text-align: right;">2700.0</td>
<td style="text-align: right;">3550.00</td>
<td style="text-align: right;">4050.00</td>
<td style="text-align: right;">4750.0</td>
<td style="text-align: right;">6300.0</td>
<td style="text-align: left;">▃▇▆▃▂</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Además de la interpretación de las frecuencias para las variables factores, y de las medias y desviaciones típicas de las numéricas, lo más relevante es la presencia de observaciones missing. Estas muestras pueden afectar a nuestros modelos de aprendizaje automático, así que además de identificar su existencia hay que decidir que hacer con ellas. Si su número es pequeño en comparación con el tamaño total (número de muestras) de la base de datos una opción es eliminar dichas muestras, pero generalmente lo más habitual es realizar un proceso de imputación (rellenar los valores perdidos con nuevos valores) como los que estudiaremos más adelante.</p>
</section>
</section>
<section id="sec-aeddataexplorer" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="sec-aeddataexplorer"><span class="header-section-number">5.1.2</span> Análisis exploratorio con <code>DataExplorer</code></h3>
<p>Aunque el paquete <code>skimr</code> nos proporciona una primera aproximación numérica a nuestro banco de datos, también es cierto que no esta preparado para visualizar las posibles relaciones entre un target (numérico o factor) y las posibles variables predictoras. Vamos a ver como el paquete <code>DataExplorer</code> nos proporciona visualizaciones gráficas muy interesantes y fáciles de implementar. El paquete nos proporciona una primera toma de contacto con todo el conjunto de datos, de forma que podemos realizar un estudio más exhaustivo utilizando el paquete <code>GGally</code> que veremos en el punto siguiente.</p>
<p>Los gráficos que podemos obtener con este paquete son accesibles mediante las funciones:</p>
<ul>
<li><code>plot_intro()</code>, que nos proporciona la información general de base de datos
<ul>
<li><code>Discrete Columns</code>: Porcentaje de variables de tipo factor.</li>
<li><code>Continuous Columns</code>: Porcentaje de variables de tipo numérico.</li>
<li><code>All Missing Columns</code>: Porcentaje de variables con todos sus valores missing.</li>
<li><code>Complete Rows</code>: Porcentaje de muestras sin valores missing.</li>
<li><code>Missing Observations</code>: Porcentaje de valores missing con respecto al total de datos recogidos.</li>
</ul></li>
<li><code>plot_missing()</code>, que nos proporciona la información del porcentaje de valores missing para cada una de las variables del banco de datos. también proporciona una escala de medida sobre la consideración del porcentaje de valores missing en cada una de las variables. Dicha escala se puede modificar con el parámetro <code>group</code>.</li>
<li><code>plot_bar()</code>, que proporciona gráficos de barras para cada una de las variables de tipo factor de forma individual. Podemos modificar dichos gráficos introduciendo el target de interés mediante los parámetros <code>with</code>, cuando es de tipo numérico, o <code>by</code> cuando es de tipo factor. En al práctica solo tiene sentido usar target factor para este tipo de gráficos.</li>
<li><code>plot_histogram</code> y <code>plot_density</code>, para representar la distribución de variables de tipo numérico. En este caso tenemos el parámetro <code>scale_x</code> que nos permite realizar de forma automática transformacionales sobre la variable de interés para estudiar su comportamiento, sobre todo para tratar de normalizar su comportamiento.</li>
<li><code>plot_qq</code>, para analizar si las variables numéricas se comportan según una distribución normal. En este caso tenemos disponible el parámetro <code>by</code> para analizar la posible normalidad mediante la variable factor identificada con este parámetro.</li>
<li><code>plot_boxplot()</code>, para analizar el comportamiento de las variables numéricas con respecto a un factor identificado mediante el parámetro <code>by</code>. Al igual que en otras funciones resulta posible introducir transformacionales de las variables numéricas mediante el parámetro <code>scale_y</code>.</li>
<li><code>plot_correlation</code>, para obtener una mapa de intensidad con las correlaciones entre las variables del banco de datos. Es necesario especificar <code>type = "c"</code> para tener en cuenta únicamente las variables numéricas, y así poder interpretar de forma adecuada los valores obtenidos.</li>
<li><code>plot_scatterplot()</code>, para representar la nube de puntos entre todas las viables numéricas y la variable de interés. La variable de interés se identifica con el parámetro <code>by</code>, y para una mejor interpretación se deberían utilizar únicamente variables de tipo numérico. Este gráfico permite la introducción de cambios de escala en ambos ejes mediante los parámetros <code>scale_x</code> y <code>scale_y</code>.</li>
</ul>
<section id="datos-iris-1" class="level4" data-number="5.1.2.1">
<h4 data-number="5.1.2.1" class="anchored" data-anchor-id="datos-iris-1"><span class="header-section-number">5.1.2.1</span> Datos Iris</h4>
<p>Comenzamos el análisis de este banco de datos recordando que el target (`species`) es de tipo factor, lo que condiciona parte de nuestras visualizaciones. En primer lugar tenemos una visualización general del banco de datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">plot_intro</span>(data_iris, </span>
<span id="cb16-2"><a href="#cb16-2"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) <span class="co"># Fondo blanco del gráfico</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-010" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-010-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.1: Análisis estructura datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Tenemos un 20% de variables de tipo factor y un 80% de tipo numérico. No tenemos ninguna variable con todos los valores missing. De hecho el 100% de las muestras están completas, es decir, sin valores perdidos. verificamos este hecho con el gráfico de valores missing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">plot_missing</span>(data_iris,</span>
<span id="cb17-2"><a href="#cb17-2"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-011" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-011-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.2: Porcentaje de missings en los datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Comenzamos ahora con los gráficos individuales de cada variable donde podremos analizar su distribución. Comenzamos con las de tipo factor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">plot_bar</span>(data_iris, </span>
<span id="cb18-2"><a href="#cb18-2"></a>         <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-012" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-012-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.3: Gráficos de barras factores datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Podemos ver que todos los niveles del factor tienen el mismo numero de observaciones, es lo que llamamos un diseño equilibrado, pero echamos en falta que no aparezcan los valores observados sobre cada una de las barras. Continuamos con el análisis de las variables numéricas. En este caso utilizamos el histograma para representar su comportamiento. para configurar adecuadamente el gráfico introducimos un elemento lista donde indicamos el tamaño y color de las etiquetas de los gráficos, y donde borramos las etiquetas de los ejes x e y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># lista de configuraciones gráficas</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>lista <span class="ot">=</span> <span class="fu">list</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb19-3"><a href="#cb19-3"></a>     <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="dv">2</span>),</span>
<span id="cb19-4"><a href="#cb19-4"></a>     <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-5"><a href="#cb19-5"></a>     <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># gráfico</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="fu">plot_histogram</span>(data_iris, </span>
<span id="cb19-10"><a href="#cb19-10"></a>               <span class="at">ncol=</span><span class="dv">2</span>,</span>
<span id="cb19-11"><a href="#cb19-11"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb19-12"><a href="#cb19-12"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-013" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-013-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.4: Histogramas variables numéricas datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Apreciamos claramente comportamientos bastante extraños en algunas de las variables. Por ejemplo, en <code>petal_length</code> podemos ver como dos poblaciones diferenciadas para valores inferior y superior a 2. Desde luego en ninguna de las variables se aprecia una distribución Normal en su comportamiento.</p>
<p>Veamos que ocurre cuando queremos estudiar el comportamiento de cada predictora con respecto al target.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># gráfico</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="fu">plot_boxplot</span>(data_iris, <span class="at">by =</span> <span class="st">"species"</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>               <span class="at">ncol=</span><span class="dv">2</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb20-6"><a href="#cb20-6"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-014" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-014-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.5: Gráficos de cajas numéricas vs target datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Claramente se aprecia que los diferentes tipos de flor se diferencian en sus medidas de pétalo (length y width), pero no existen tantas diferencias entre las medidas de sépalo. Dado que nuestro objetivo es la clasificación parece que las medidas de pétalos ayudarán mejor a clasificar entre las tres especies de Iris.</p>
<p>Por último podemos estudiar el nivel de asociación entre las predictoras numéricas mediante el gráfico de correlaciones. En este caso hay que tener en cuenta que si la relación entre numéricas no es lineal la interpretación de los valores obtenidos puede resultar errónea.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># gráfico</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">plot_correlation</span>(data_iris,</span>
<span id="cb21-3"><a href="#cb21-3"></a>                 <span class="at">type =</span> <span class="st">"c"</span>,  </span>
<span id="cb21-4"><a href="#cb21-4"></a>                 <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-015" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-015-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.6: Gráfico de correlación variables numéricas datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Se producen correlaciones positivas muy altas entre las medidas de pétalo, indicando que cuanto mayor es una de ellas la otra también aumenta sus valores, es decir tenemos una relación directa entre ellas. La variable <code>sepal_width</code> tiene correlaciones negativas con el resto indicando que cuando las otras aumentan esta última disminuye, es decir, tenemos una relación inversa entre ellas.</p>
</section>
<section id="datos-penguins-1" class="level4" data-number="5.1.2.2">
<h4 data-number="5.1.2.2" class="anchored" data-anchor-id="datos-penguins-1"><span class="header-section-number">5.1.2.2</span> Datos Penguins</h4>
<p>En este caso nuestro target es una variable numérica y debemos tener en cuenta esto a la hora de definir nuestro gráficos de asociación. Comenzamos con los gráficos general del banco de datos y los individuales de cada variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">plot_intro</span>(data_penguins, </span>
<span id="cb22-2"><a href="#cb22-2"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-016" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-016-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.7: Gráfico de estructura datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este caso tenemos un 0.79% de valores missing en nuestro banco de datos. tratamos de identificar donde se encuentran dichos valores evaluando cada variable por separado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">plot_missing</span>(data_penguins,</span>
<span id="cb23-2"><a href="#cb23-2"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-017" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-017-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.8: Porcentaje missings datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Tenemos valores missing en todas las variables numéricas y en el factor sexo, siendo está última la que presenta un porcentaje mayor (3.2%). Ninguno de los porcentajes es muy relevante, y un proceso de imputación podría proporcionar una buena solución para nuestros modelos de aprendizaje automático.</p>
<p>Analizamos ahora según el tipo de variable comenzando con lo factores:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">plot_bar</span>(data_penguins, </span>
<span id="cb24-2"><a href="#cb24-2"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb24-3"><a href="#cb24-3"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb24-4"><a href="#cb24-4"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-018" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-018-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.9: Gráficos barras factores datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Podemos destacar que la especie más numerosa es <code>Adelie</code>, mientras que la menos es <code>Chinistrap</code>. Por otro lado, la isla de la que tenemos más información es <code>Biscoe</code>, y tenemos un diseño bastante equilibrado por sexo.</p>
<p>Veamos ahora las variables numéricas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">plot_histogram</span>(data_penguins, </span>
<span id="cb25-2"><a href="#cb25-2"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb25-3"><a href="#cb25-3"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb25-4"><a href="#cb25-4"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-019" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-019-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.10: Histogramas variables numéricas datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En la target de este banco de datos (<code>flipper_length_mm</code>) se aprecian como dos poblaciones distintas separadas por un valor algo superior a los 200 mm. En todas las distribuciones se aprecia cierto sesgo hacia un lado (las distribuciones no están centradas) por lo que podríamos probar alguna transformación para tratar de corregir en parte dicho comportamiento. Dejamos esta tarea para más adelante.</p>
<p>Veamos el gráfico de densidades para visualizar de forma más clara los posibles sesgos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">plot_density</span>(data_penguins, </span>
<span id="cb26-2"><a href="#cb26-2"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb26-3"><a href="#cb26-3"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb26-4"><a href="#cb26-4"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-020" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-020-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.11: Densidades variables numéricas datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Comenzamos ahora con los estudios de asociación. en primer lugar analizamos el comportamiento de cada uno de los factores con respecto a la característica de interés.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># gráfico</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="fu">plot_boxplot</span>(data_penguins, <span class="at">by =</span> <span class="st">"species"</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb27-5"><a href="#cb27-5"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb27-6"><a href="#cb27-6"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 8 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-aed-021" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-021-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.12: Gráficos de cajas variables numéricas vs especies. Datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La solución proporciona todos los gráficos para las variables numéricas, pero nos vamos a fijar en el de la variable target. Podemos ver que la especie Gentoo es la que muestra mayores valores de target, mostrando además diferencias con las otras dos especies. Veamos que ocurre con el sexo y la isla.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># gráfico</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">plot_boxplot</span>(data_penguins, <span class="at">by =</span> <span class="st">"sex"</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb29-5"><a href="#cb29-5"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb29-6"><a href="#cb29-6"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 8 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-aed-022" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-022-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.13: Gráficos de cajas variables numéricas vs sexo Datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>No se aprecian diferencias por sexo aunque los machos muestran una valor medio más alto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># gráfico</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">plot_boxplot</span>(data_penguins, <span class="at">by =</span> <span class="st">"island"</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb31-5"><a href="#cb31-5"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb31-6"><a href="#cb31-6"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 8 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-aed-023" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-023-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.14: Gráficos de cajas variables numéricas vs isla Datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este caso las islas <code>Torgensen</code> y <code>Dream</code> muestran valores más pequeños del target que las muestras de la isla <code>Biscoe</code>.</p>
<p>Por último vemos los gráficos de dispersión de las variables numéricas con respecto al target.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># gráfico</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># fijamos ncol = 2 para que aparezcan dos gráficos por fila</span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="fu">plot_scatterplot</span>(<span class="at">data =</span> data_penguins <span class="sc">|&gt;</span> <span class="fu">select_if</span>(is.numeric), </span>
<span id="cb33-4"><a href="#cb33-4"></a>               <span class="at">by =</span> <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb33-5"><a href="#cb33-5"></a>               <span class="at">ncol=</span><span class="dv">2</span>, </span>
<span id="cb33-6"><a href="#cb33-6"></a>               <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb33-7"><a href="#cb33-7"></a>               <span class="at">theme_config =</span> lista) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-aed-024" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-024-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.15: Gráficos de dispersión variables numéricas vs target. Datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En la <a href="#fig-aed-024">Figura&nbsp;<span>5.15</span></a> podemos destacar tres aspectos:</p>
<ul>
<li>No se aprecia una relación entre <code>bill_depth</code> y <code>flipper_length</code> dado que incluso se ven dos nubes de puntos separadas. Parece que existe algún tipo de factor que provoca esa diferencia.</li>
<li>Entre <code>bill_length</code> y <code>flipper_length</code> se aprecia cierta dependencia, ya que conforme aumenta la primera parece que aumenta la segunda. Sin embargo, la nube de puntos es bastante dispersa dando a entender que el nivel de asociación no es muy alto.</li>
<li>Por último, entre <code>body_mass</code> y <code>flipper_length</code> se aprecia una tendencia bastante lineal, indicando que ambas están muy relacionadas, de forma que si estamos interesados en predecir un valor de <code>flipper_length</code> parece factible utilizar el valor de <code>body_mass</code>.</li>
</ul>
<p>Podemos ver como todas las posibles predictoras no tienen la misma relevancia o relación con el target a lo hora de tratar de predecir su comportamiento. Para analizar el grado de asociación podemos hacer el mapa de intensidad de correlación. Dado que tenemos valores missing en nuestras variables debemos indicar a la función que utiliza para los cálculos aquellas muestras sin valores missing en ninguna de las variables numéricas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># gráfico</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">plot_correlation</span>(data_penguins,</span>
<span id="cb35-3"><a href="#cb35-3"></a>                 <span class="at">type =</span> <span class="st">"c"</span>,  </span>
<span id="cb35-4"><a href="#cb35-4"></a>                 <span class="at">cor_args =</span> <span class="fu">list</span>(<span class="st">"use"</span> <span class="ot">=</span> <span class="st">"pairwise.complete.obs"</span>),</span>
<span id="cb35-5"><a href="#cb35-5"></a>                 <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-025" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-025-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.16: Gráfico de correlación variables numéricas datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En los resultados de <a href="#fig-aed-025">Figura&nbsp;<span>5.16</span></a> se aprecia el grado de asociación entre las predictoras y el target (segunda fila de la matriz), tal y como hemos comentado anteriormente. De hecho, para <code>bill_depth</code> proporciona un valor negativo que en este caso solamente indica que no hay asociación lineal entre ellas debido a la separación de las dos nubes de puntos que veíamos en la <a href="#fig-aed-024">Figura&nbsp;<span>5.15</span></a>.</p>
</section>
</section>
<section id="sec-aedggally" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="sec-aedggally"><span class="header-section-number">5.1.3</span> Análisis exploratorio con <code>GGally</code></h3>
<p>Para finalizar este apartado se presentan algunas de las funciones contenidas en el paquete <code>GGally.</code> Para conocer todas las funciones disponibles se recomienda consultar este <a href="https://ggobi.github.io/ggally/index.html">enlace</a>.</p>
<p>En concreto nos vamos a centrar en todas las funciones que nos permiten extraer información del comportamiento del target de nuestro datos frente al conjunto de predictoras. Dichas funciones son:</p>
<ul>
<li><p><code>ggbivariate()</code>, que nos permite representar la información de un target con respecto a un conjunto de predictoras (numéricas o factores). El gráfico de asociación que aparece depende del tipo del target (numérica o factor) y del tipo de cada una de las predictoras.</p></li>
<li><p><code>ggpairs()</code>, que representa de forma bivariada toda la información contenida en una matriz de datos en función del tipo de cada una de las variables allí contenidas.</p></li>
<li><p><code>ggscatmat()</code>, que representa de forma bivariada toda la información contenida en una matriz de datos donde todas las variables son de tipo numérico.</p></li>
<li><p><code>ggduo()</code>, que generaliza los pairs plot representando la información de dos conjuntos de datos distintos. En este caso podemos poner en uno de los grupos el target deseado y en otro grupo todas las posibles predictoras.</p></li>
</ul>
<p>A continuación, vemos diferentes versiones de estos gráficos para los conjuntos de datos que hemos venido trabajando hasta ahora.</p>
<section id="datos-iris-2" class="level4" data-number="5.1.3.1">
<h4 data-number="5.1.3.1" class="anchored" data-anchor-id="datos-iris-2"><span class="header-section-number">5.1.3.1</span> Datos Iris</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># gráfico</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">ggbivariate</span>(data_iris, <span class="st">"species"</span>, <span class="fu">names</span>(data_iris)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-026" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-026-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.17: Gráfico de asociación individual entre predictora y target datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Dado que todas las predictoras son numéricas el gráfico por defecto es un gráfico de cajas donde podemos comparar el comportamiento de cada especie con respecto a cada una de las variables numéricas.</p>
<p>La <a href="#fig-aed-026">Figura&nbsp;<span>5.17</span></a> nos permite ver la contribución individual de cada predictora al problema de clasificación de las tres especies, pero no resulta de utilidad para ver como dos de ellas nos pueden ayudar en dicha tarea. Introducimos ahora un gráfico que nos permite ver la contribución dos a dos de las predictoras en nuestro problema de clasificación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># gráfico</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="fu">ggscatmat</span>(data_iris, <span class="fu">names</span>(data_iris)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">color =</span> <span class="st">"species"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-027" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-027-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.18: Gráfico de asociación bivariante entre predictora y target datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Esta figura nos proporciona tres análisis distintos:</p>
<ul>
<li><p>En la diagonal aparecen los gráficos de densidad individuales de cada predictora en las tres especies. Este gráfico es similar al anterior del gráfico de cajas pero permite una mejor visualización para diferencia entre especies. Por ejemplo, podemos distinguir entre <code>iris-setosa</code> y las otras dos especies tanto para <code>petal_length</code> y <code>petal_width</code>.</p></li>
<li><p>En la parte superior aparecen los coeficientes de correlación entre las predictoras para cada una de las especies. Si tomamos <code>petal_width</code> podemos ver que las correlaciones más latas se producen siempre con las <code>iris-versicolor</code> y las más bajas con la <code>iris-setosa</code>.</p></li>
<li><p>En la parte inferior se presentan las nubes de puntos bivaraintes identificando cada punto de acuerdo a la especie a la que pertenecen. Desde le punto de vista de clasificación las especies se identificarán más fácilmente cuando las nubes de puntos estén más separadas. Por ejemplo, si tomamos <code>petal_length</code> y <code>petal_width</code> se aprecia claramente al separación entre <code>iris-setosa</code> y las otras dos especies. De hecho podemos ver que también hay cierta separación para las otras dos especies (<code>iris-versicolor</code> con valores más bajos) pero no tan claramente. Esto implica directamente que será más fácil clasificar las <code>iris-setosa</code>, y que habrá cierta confusión en la clasificación para las otras dos cuando utilizamos las variables de pétalo.</p></li>
</ul>
</section>
<section id="datos-penguins-2" class="level4" data-number="5.1.3.2">
<h4 data-number="5.1.3.2" class="anchored" data-anchor-id="datos-penguins-2"><span class="header-section-number">5.1.3.2</span> Datos Penguins</h4>
<p>Los gráficos y su interpretación varían un poco con respecto al ejemplo anterior ya que nuestro target en este caso es una variable de tipo numérico. Comenzamos como antes con los gráficos individuales para cada variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># gráfico</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">ggbivariate</span>(data_penguins, <span class="st">"flipper_length_mm"</span>, <span class="fu">names</span>(data_penguins)[<span class="sc">-</span><span class="dv">5</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-028" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-028-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.19: Gráfico asociación individual datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Dado que nuestro target es continuo los gráficos disponibles son diagramas de cajas cuando la predictora es factor, y diagramas de dispersión (con tendencia lineal aproximada) para las numéricas.</p>
<p>Por ejemplo, podemos ver que la especie <code>Gentoo</code> tiene los valores de la predictora más grandes y diferenciados respecto de las otras dos especies. Para la variable body_mass podemos ver una tendencia lineal creciente indicando que cuanto más aumenta dicha variable mayor será el valor de target. Estos gráficos son similares a los que obtuvimos con el paquete <code>DataExplorer</code>.</p>
<p>Como en el caso anterior podemos obtener los gráficos del target con respecto a dos predictoras de forma conjunta para analizar como varían los valores del target. Seleccionamos las predictoras numéricas y añadimos colores de función de cada una de las predictoras factor para estudiar su comportamiento conjunto. Visualizamos también la tendencia lineal entre target y predictora numérica diferenciado por el factor para analizar su comportamiento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">ggduo</span>(</span>
<span id="cb39-2"><a href="#cb39-2"></a>   data_penguins,</span>
<span id="cb39-3"><a href="#cb39-3"></a>   <span class="co"># target</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>   <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>   <span class="co"># predictoras numéricas</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>   <span class="fu">names</span>(data_penguins <span class="sc">|&gt;</span> <span class="fu">select_if</span>(is.numeric))[<span class="sc">-</span><span class="dv">3</span>],</span>
<span id="cb39-7"><a href="#cb39-7"></a>   <span class="co"># Coloreamos por factor y visualizamos tendencia lineal</span></span>
<span id="cb39-8"><a href="#cb39-8"></a>   <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> species),</span>
<span id="cb39-9"><a href="#cb39-9"></a>   <span class="at">types =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"smooth_lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)),</span>
<span id="cb39-10"><a href="#cb39-10"></a>   <span class="at">legend =</span> <span class="dv">1</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>   )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-029" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-029-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.20: Gráfico bivariante datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>¿Qué conclusiones podemos extraer de este gráfico? ¿qué ocurre si asumimos una tendencia no lineal?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">ggduo</span>(</span>
<span id="cb40-2"><a href="#cb40-2"></a>   data_penguins,</span>
<span id="cb40-3"><a href="#cb40-3"></a>   <span class="co"># target</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>   <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>   <span class="co"># predictoras numéricas</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>   <span class="fu">names</span>(data_penguins <span class="sc">|&gt;</span> <span class="fu">select_if</span>(is.numeric))[<span class="sc">-</span><span class="dv">3</span>],</span>
<span id="cb40-7"><a href="#cb40-7"></a>   <span class="co"># Coloreamos por factor y visualizamos tendencia lineal</span></span>
<span id="cb40-8"><a href="#cb40-8"></a>   <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> species),</span>
<span id="cb40-9"><a href="#cb40-9"></a>   <span class="at">types =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"smooth_loess"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)),</span>
<span id="cb40-10"><a href="#cb40-10"></a>   <span class="at">legend =</span> <span class="dv">1</span></span>
<span id="cb40-11"><a href="#cb40-11"></a>   )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-030" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-030-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.21: Gráfico bivariante datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>¿Cambian muchos nuestras conclusiones?</p>
<p>Veamos ahora que ocurre con la isla (probamos únicamente la tendencia no lineal).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">ggduo</span>(</span>
<span id="cb41-2"><a href="#cb41-2"></a>   data_penguins,</span>
<span id="cb41-3"><a href="#cb41-3"></a>   <span class="co"># target</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>   <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb41-5"><a href="#cb41-5"></a>   <span class="co"># predictoras numéricas</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>   <span class="fu">names</span>(data_penguins <span class="sc">|&gt;</span> <span class="fu">select_if</span>(is.numeric))[<span class="sc">-</span><span class="dv">3</span>],</span>
<span id="cb41-7"><a href="#cb41-7"></a>   <span class="co"># Coloreamos por factor y visualizamos tendencia lineal</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>   <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> island),</span>
<span id="cb41-9"><a href="#cb41-9"></a>   <span class="at">types =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"smooth_loess"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)),</span>
<span id="cb41-10"><a href="#cb41-10"></a>   <span class="at">legend =</span> <span class="dv">1</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>   )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-031" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-031-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.22: Gráfico bivariante datos Penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>¿Qué conclusiones podemos extraer en este caso teniendo en cuenta que nuestro objetivo es predecir <code>flipper_length</code>?</p>
<p>La cantidad de gráficos que podemos realizar en nuestro bancos de datos es inmensa y depende como hemos visto del tipo de target y predictoras. Cada vez que introducimos un nuevo banco de datos debemos realizar el análisis descriptivo correspondiente para tener una mejor compresión del comportamiento de nuestros datos.</p>
<p>En el punto siguiente empezamos a introducir el paquete que utilizaremos para nuestros modelos de aprendizaje automático. Por el momento presentaremos dos modelos de aprendizaje básicos para los bancos de datos utilizados, y más adelante iremos detallando los aspectos técnicos de cada uno de los modelos que estudiaremos durante este curso.</p>
</section>
</section>
</section>
<section id="sec-50.2" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sec-50.2"><span class="header-section-number">5.2</span> Librerías para el AA</h2>
<p>Dentro del programa <code>R</code> existen diferentes paquetes para trabajar con modelos de aprendizaje automático, como por ejemplo <a href="https://topepo.github.io/caret/">Caret</a> y <a href="https://docs.h2o.ai/h2o/latest-stable/h2o-r/docs/reference/h2o-package.html">H20</a>, pero en estos materiales nos vamos a centrar en el paquete <a href="https://mlr3.mlr-org.com/">mlr3</a> ya que emplea programación orientada a objetos mediante el uso de la clase <a href="https://r6.r-lib.org/">R6</a>.</p>
<section id="sec-50.2.1" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="sec-50.2.1"><span class="header-section-number">5.2.1</span> Ecosistema mlr3</h3>
<p>El paquete mlr3 <span class="citation" data-cites="mlr3">(<a href="references.html#ref-mlr3" role="doc-biblioref">Lang et al. 2019</a>)</span> y el ecosistema mlr3 más amplio proporcionan un marco genérico, orientado a objetos y extensible para la regresión, la clasificación y otras tareas de aprendizaje automático para la Lenguaje <code>R</code>. En el nivel más básico, la interfaz unificada proporciona funcionalidad para entrenar, probar y evaluar muchos algoritmos de aprendizaje automático. También puede llevar esto un paso más allá con la optimización de hiperparámetros, canalizaciones computacionales, interpretación de modelos y mucho más. mlr3 tiene objetivos generales similares a caret y tidymodels para R, scikit-learn para Python y MLJ para Julia. En general, mlr3 está diseñado para proporcionar más flexibilidad que otros marcos de AA y, al mismo tiempo, ofrecer formas sencillas de usar la funcionalidad avanzada. Si bien tidymodels en particular hace que sea muy fácil realizar tareas simples de AA, mlr3 está más orientado a AA avanzado.</p>
<p>El primer paso es instalar y hacer accesible el paquete <a href="https://mlr3verse.mlr-org.com/reference/mlr3verse-package.html">mlr3verse</a> <span class="citation" data-cites="mlr3verse">(<a href="references.html#ref-mlr3verse" role="doc-biblioref">Lang and Schratz 2023</a>)</span> que nos permite acceder al entorno básico de mlr3. Este paquete está destinado a simplificar tanto la instalación como la carga de paquetes del ecosistema mlr3. En lugar de depender de los paquetes de extensión, las funciones requeridas para el análisis de datos se reexportan, lo que brinda una visión general de la funcionalidad más importante del ecosistema mlr3. A continuación aparece el código para su instalación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">install.packages</span>(<span class="st">"mlr3verse"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos utilizarlo ahora cargando el paquete correspondiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="fu">library</span>(mlr3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Al cargar el paquete <code>mlr3verse</code>,se cargan los modelos básicos de aprendizaje automático para problemas de regresión, clasificación, cluster y supervivencia. Las funciones y objetos de Los importados por este metapaquete son:</p>
<ul>
<li><a href="https://mlr3.mlr-org.com">mlr3</a>, que es el paquete principal con las funcionalidades necesarias para crear los objetos necesarios para el ecosistema mlr3.</li>
<li><a href="https://mlr3cluster.mlr-org.com">mlr3cluster</a>, que es el paquete diseñado para los modelos de aprendizaje no supervisado de agrupación.</li>
<li><a href="https://mlr3data.mlr-org.com">mlr3data</a>, que contiene bancos de datos adicionales.</li>
<li><a href="https://mlr3filters.mlr-org.com">mlr3filters</a>, que es el paquete utilizado para la selección de predictores.</li>
<li><a href="https://mlr3fselect.mlr-org.com">mlr3fselect</a>, que es el paquete para la selección de funciones basada en contenedores. - <a href="https://mlr3learners.mlr-org.com">mlr3learners</a>, que es el paquete de definición de los modelos básicos de aprendizaje automático.</li>
<li><a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a>, que es el paquete para realizar el preprocesado de los datos y modelado en un único objeto.</li>
<li><a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a>, que el paquete utilizado para probar diferentes configuraciones de los modelos de aprendizaje automático.</li>
<li><a href="https://mlr3tuningspaces.mlr-org.com">mlr3tuningspaces</a>, que contiene una colección de espacios de búsqueda para la optimización de hiperparámetros en el ecosistema mlr3.</li>
<li><a href="https://mlr3viz.mlr-org.com">mlr3viz</a>, que el paquete utilizado para visualizar los objetos mlr3.</li>
<li><a href="https://paradox.mlr-org.com">paradox</a>, que es el paquete para crear y manejar el valor de los hiperparámetros de los modelos.</li>
</ul>
<p>Podemos ver todos los paquetes (junto con su versión) integrados mediante el código siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">mlr3verse_info</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             package    version
 1:            bbotk      0.7.2
 2:      mlr3cluster      0.1.8
 3:         mlr3data      0.7.0
 4:      mlr3filters      0.7.1
 5:      mlr3fselect     0.11.0
 6:    mlr3hyperband      0.4.5
 7:     mlr3learners      0.5.6
 8:          mlr3mbo      0.2.1
 9:         mlr3misc     0.13.0
10:    mlr3pipelines    0.5.0.1
11:       mlr3tuning     0.19.0
12: mlr3tuningspaces      0.4.0
13:          mlr3viz 0.6.1.9000
14:          paradox     0.11.1</code></pre>
</div>
</div>
<p>Sin embargo, el ecosistema mlr3 contiene muchos <a href="https://github.com/mlr-org/mlr3/wiki/Extension-Packages">otros paquetes</a> que podemos ver en la imagen siguiente:</p>
<p><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/mlr3verse.svg?sanitize=true"></p>
<p>Algunos de estos paquetes necesitan su propia instalación por lo que se debe consultar la página web de cada uno de ellos para realizar dicha tarea. A lo largo de los materiales se indicara como instalar y utilizar todos aquellos que no están dentro del paquete básico.</p>
</section>
<section id="sec-50.2.2" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="sec-50.2.2"><span class="header-section-number">5.2.2</span> Crear un modelo con mlr3</h3>
<p>Encontrar el mejor modelo de aprendizaje automático capaz de representar los patrones presentes en los datos de entrenamiento y generalizarlos a nuevas observaciones no es fácil, dado que existen multitud de algoritmos para una misma tarea, cada uno con unas características propias y con distintos parámetros que deben ser ajustados. Es a lo largo de todo este proceso donde más destacan las funcionalidades ofrecidas por mlr3, permitiendo emplear la misma sintaxis para ajustar, optimizar, evaluar y predecir un amplio abanico de modelos variando únicamente el nombre del algoritmo. Aunque mlr3 permite todo esto con apenas unas pocas líneas de código, son muchos los argumentos que pueden ser adaptados, cada uno con múltiples posibilidades. De momento en esta unidad mostraremos las funcionalidades básicas para los bancos de datos que hemos venido presentando.</p>
<p>Los desarrolladores de mlr3 han dividido las etapas de la creación de un modelo de machine learning en 6 “bloques”. Dentro cada uno de estos “bloques” se llevan a cabo una o varias acciones (preprocesado, resampling, entrenamiento, evaluación, predicción, etc). Al trabajar de esta forma, se consigue que cada “bloque” transmita al siguiente, no solo los datos, sino también toda la información de lo ha ocurrido hasta el momento. La secuencia de pasos con los que se crea un modelo predictivo en mlr3 puede parecer extraña para aquellos lectores que estén acostumbrados a otros paquetes de aprendizaje automático. En mlr3, sin embargo, primero se crean los objetos en los que se definen cada una las acciones para finalmente ejecutarlas de forma conjunta e interconectada. A continuación se detallan cada uno de los pasos a seguir para construir un modelo predictivo.</p>
<section id="sec-task" class="level4" data-number="5.2.2.1">
<h4 data-number="5.2.2.1" class="anchored" data-anchor-id="sec-task"><span class="header-section-number">5.2.2.1</span> Task</h4>
<p>El objeto <code>task</code> o tarea contiene datos (generalmente tabulares) y metadatos adicionales para definir un problema de aprendizaje automático. Los metadatos son, por ejemplo, el nombre de la variable de destino para problemas de aprendizaje automático supervisado, o el tipo de conjunto de datos (por ejemplo, una tarea espacial o de supervivencia). Esta información es utilizada por operaciones específicas que se pueden realizar en una tarea. Podemos crear un <code>task</code> a partir de un <code>data.frame()</code>, <code>data.table()</code>, o <code>Matrix()</code>.</p>
<p>Una vez creado el objeto podemos realizar todo el preprocesado necesario para pasar al paso siguiente. Los tipos <code>task</code> disponibles son:</p>
<ul>
<li><p><strong>Task de clasificación</strong>: el objetivo es una etiqueta (almacenada como carácter o factor) con solo relativamente pocos valores distintos.</p></li>
<li><p><strong>Task de regresión</strong>: el objetivo es una cantidad numérica (almacenada como número entero o numérico) .</p></li>
<li><p><strong>Task de supervivencia</strong>: el objetivo es el tiempo (censurado por la derecha) hasta un evento. Actualmente se están desarrollando más tipos de censura. Para utilizar esta task debemos instalar el paquete <a href="https://mlr3proba.mlr-org.com/"><code>mlr3proba</code></a>. El código siguiente nos permite esto:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">install.packages</span>(<span class="st">"mlr3proba"</span>, <span class="at">repos =</span> <span class="st">"https://mlr-org.r-universe.dev"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><strong>Task de densidad</strong>: una tarea no supervisada para estimar la densidad . Se encuentra disponible también en el paquete <code>mlr3proba</code>.</p></li>
<li><p><strong>Task de clúster o agrupación</strong>: un tipo de tarea no supervisada; no hay un target y el objetivo es identificar grupos similares en términos de distancia. En este caso utilizamos el paquete <code>mlr3cluster</code>.</p></li>
<li><p><strong>Task espacio-temporal</strong>: las observaciones en la tarea tienen información espacio-temporal (por ejemplo, coordenadas). En este caso es necesario instalar el paquete <a href="https://mlr3spatiotempcv.mlr-org.com/"><code>mlr3spatiotempcv</code></a>. El código siguiente nos permite esto:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">install.packages</span>(<span class="st">"mlr3spatiotempcv"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Un aspecto a tener en cuenta una vez hemos creado una <code>task</code> es la representación gráfica de la información contenida en ella. Se trata de una análisis exploratorio gráfico del target, de cada predictoras vs el target, y el gráfico conjunto de predictoras vs target. Las soluciones obtenidas son similares a los de las librerías gráficas presentadas en la <a href="#sec-50.1"><span>Sección&nbsp;5.1</span></a>. para realizar estos análisis debemos cargar en primer lugar la librería <code>mlr3viz</code>. para conseguir las tres soluciones gráficas para una <code>task</code> debemos utilizar la función <code>autoplot()</code> con los parámetros siguientes:</p>
<ul>
<li><code>autoplot(task, type = "target")</code>, para el gráfico individual de target.</li>
<li><code>autoplot(task, type = "duo")</code>, para el gráfico individual de cada predictora vs target.</li>
<li><code>autoplot(task, type = "pairs")</code>, para el gráfico conjunto bivariante de target y predictoras.</li>
</ul>
<p>A continuación, vemos el código necesario para crear las task correspondientes a los banco de datos iris y penguins, y representamos gráficamente la información contenida en ellos.</p>
<section id="datos-iris-3" class="level5">
<h5 class="anchored" data-anchor-id="datos-iris-3">Datos Iris</h5>
<p>En este caso estamos en un problema de clasificación y vamos a utilizar la función <code>as_task_classif</code> para definir la task de clasificación a partir del dataframe de datos iris. El código necesario se presenta a continuación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># creamos la tarea</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>task_iris <span class="ot">=</span> <span class="fu">as_task_classif</span>(data_iris, <span class="at">target =</span> <span class="st">"species"</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co"># información de la tarea</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="fu">print</span>(task_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:data_iris&gt; (150 x 5)
* Target: species
* Properties: multiclass
* Features (4):
  - dbl (4): petal_length, petal_width, sepal_length, sepal_width</code></pre>
</div>
</div>
<p>La información proporcionada nos indica el target, si tenemos un problema de clasificación binario o multiclase, y el tipo de predictoras contenidas.</p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container" title="Clasificación binaria">
<p><strong>En un problema de clasificación binario otro parámetro de interés de la función <code>as_task_classif()</code> es <code>positive</code> con el que podemos indicar que nivel del factor es el identificado como “exitus”. Por ejemplo, en un problema donde el target es si se tiene o no se tiene cierta enfermedad podríamos identificar como <code>positive="Si"</code> al grupo de interés.</strong></p>
</div>
</div>
</div>
<p>Además, mlr3 incorpora toda una serie de atributos y métodos con los que extraer o modificar información de un objeto <code>task</code>:</p>
<ul>
<li><code>$col_info</code>, que proporciona información de todas las variables.</li>
<li><code>$col_roles</code>, que proporciona los tipos de todas las variables.</li>
<li><code>$missings()</code>, que proporciona los valores perdidos por variable.</li>
<li><code>$levels()</code>, que proporciona los niveles de cada variable de tipo factor.</li>
<li><code>$select()</code>, que nos permite seleccionar un conjunto de variables.</li>
<li><code>filter$()</code>, que nos permite seleccionar un conjunto de muestras.</li>
</ul>
<p>Hay que tener en cuenta que al utilizar los atributos <code>$select()</code>, y <code>filter$()</code> estamos modificamos la task definida.</p>
<div class="callout-caution callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container" title="A tener en cuenta">
<p><strong>Al utilizar los atributos <code>$select()</code>, y <code>filter$()</code> estamos modificamos la task definida. Más adelante veremos como realizar una copia para modificarla sin alterar la task original.</strong></p>
</div>
</div>
</div>
<p>Veamos el código para usar los atributos principales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># información variables</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>task_iris<span class="sc">$</span>col_info</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             id    type                                     levels label
1:     ..row_id integer                                             &lt;NA&gt;
2: petal_length numeric                                             &lt;NA&gt;
3:  petal_width numeric                                             &lt;NA&gt;
4: sepal_length numeric                                             &lt;NA&gt;
5:  sepal_width numeric                                             &lt;NA&gt;
6:      species  factor Iris-setosa,Iris-versicolor,Iris-virginica  &lt;NA&gt;
   fix_factor_levels
1:             FALSE
2:             FALSE
3:             FALSE
4:             FALSE
5:             FALSE
6:             FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># información de roles</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>task_iris<span class="sc">$</span>col_roles</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$feature
[1] "petal_length" "petal_width"  "sepal_length" "sepal_width" 

$target
[1] "species"

$name
character(0)

$order
character(0)

$stratum
character(0)

$group
character(0)

$weight
character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># missings</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>task_iris<span class="sc">$</span><span class="fu">missings</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     species petal_length  petal_width sepal_length  sepal_width 
           0            0            0            0            0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Niveles de los factores</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>task_iris<span class="sc">$</span><span class="fu">levels</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] "Iris-setosa"     "Iris-versicolor" "Iris-virginica" </code></pre>
</div>
</div>
<p>Un rol muy importante dentro de los problemas de clasificación es el de los pesos de las categorías que deseamos clasificar. Las ponderaciones se utilizan para ponderar los puntos de datos de manera diferente y que estos sean tenidos en cuenta en la predicción del modelo de aprendizaje. Un ejemplo de por qué haríamos esto es en tareas de clasificación donde las clases están desequilibradas. Aunque en este ejemplo todas las clases están equilibradas vamos a ver como realizaríamos este proceso en otros ejemplos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># En primer lugar veamos la distribución del target</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>df <span class="ot">=</span> task_iris<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="fu">summary</span>(df<span class="sc">$</span>species)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este caso tenemos una relación 1-1-1 entre las especies, es decir, hay los mismos elementos de las tres especies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Asignamos pesos a las muestras todos iguales</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>df<span class="sc">$</span>weights <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="co"># Creamos nueva tarea e introducimos los pesos </span></span>
<span id="cb59-4"><a href="#cb59-4"></a>task_iris_ponderado <span class="ot">=</span> <span class="fu">as_task_classif</span>(df, <span class="at">target =</span> <span class="st">"species"</span>)</span>
<span id="cb59-5"><a href="#cb59-5"></a>task_iris_ponderado<span class="sc">$</span><span class="fu">set_col_roles</span>(<span class="st">"weights"</span>, <span class="at">roles =</span> <span class="st">"weight"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si por ejemplo tuviéramos dos clases donde en una hay el doble de observaciones que la otra nuestra estructura de pesos debería ser 1-2, asignando el 2 a la clase que tiene la mitad de observaciones que la otra. De esta forma equilibramos los datos en la construcción de nuestro modelo de aprendizaje automático.</p>
<p>Veamos ahora las diferentes opciones gráficas para esta tarea. Comenzamos con el gráfico del target:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Gráfico target</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="fu">autoplot</span>(task_iris, <span class="at">type =</span><span class="st">"target"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-039" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-039-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.23: Autoplot task Iris. Gráfico target</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos un gráfico de barras con los conteos de cada una de las clases del target. Esto nos permite saber si dichas clases están equilibradas o no.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># gráfico predictora vs target</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">autoplot</span>(task_iris, <span class="at">type =</span><span class="st">"duo"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-040" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-040-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.24: Autoplot task Iris. Gráfico duo</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este caso obtenemos un gráfico de cajas para cada variable de tipo numérico respecto del factor respuesta donde podemos ver como se diferencian las clases para cada una de las predictoras. Por último vemos el gráfico conjunto de todas las predictoras y la respuesta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># gráfico predictora vs target</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">autoplot</span>(task_iris, <span class="at">type =</span><span class="st">"pairs"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-041" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-041-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.25: Autoplot task Iris. Gráfico pairs</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La solución en este caso nos aporta gráficos diferentes en función de tipo de las variables involucradas en cada combinación. Tenemos desde histogramas o gráficos de densidad para el análisis individual de las variables numéricas, diagramas de barras para el análisis individual de factores, gráficos de dispersión y análisis de correlación para representar a información de dos variables numéricas, y diagramas de caja para una variable numérica y otra categórica. En este caso todos los gráficos identifican el target en sus soluciones mediante una escala de colores.</p>
</section>
<section id="datos-penguins-3" class="level5">
<h5 class="anchored" data-anchor-id="datos-penguins-3">Datos Penguins</h5>
<p>En este caso estamos en un problema de regresión y vamos a utilizar la función <code>as_task_regr</code>. Sin embargo, dado que como comprobaremos más tarde dicho conjunto contiene valores perdidos en la respuesta realizamos un proceso de limpieza inicial. En concreto se platean dos tareas que no se encuentran de lo que habitualmente se conoce como preprocesado:</p>
<ul>
<li>Detección de muestras con todos los valores perdidos.</li>
<li>Detección de muestras con valores perdidos en la respuesta o target.</li>
</ul>
<p>En ambos casos la solución pasa por eliminar dichas muestras. En el primer caso no tenemos ningún dato y por tanto no tiene sentido utilizar esa muestra. En el segundo eliminamos la muestra porque no podemos imputar valores en la respuesta para evitar posibles sesgos en el modelo. Para este proceso utilizamos funciones habituales para el tratamiento de dataframes, y una vez eliminadas dichas muestras procedemos con la creación del task correspondiente.</p>
<p>Comenzamos detectando todas las muestras donde todos sus valores son missing. Utilizamos la función <code>complete.cases</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># valoramos si las muestras tiene todas sus observaciones pérdidas</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>ids <span class="ot">=</span> <span class="fu">complete.cases</span>(data_penguins)</span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="co"># identificamos dichas muestras</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>pos <span class="ot">=</span> <span class="fu">which</span>(ids<span class="sc">==</span><span class="st">"FALSE"</span>)</span>
<span id="cb63-5"><a href="#cb63-5"></a>pos</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   4   9  10  11  12  48 179 219 257 269 272</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># Eliminamos esas observaciones</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>data_penguins <span class="ot">=</span> data_penguins[<span class="sc">-</span>pos,]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora nos hemos asegurado que no hay muestras con todos los valores perdidos. Veamos si todavía quedan valores perdidos en la respuesta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># valoramos si hay valores perdidos en la repuesta</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_penguins<span class="sc">$</span>flipper_length_mm))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>No quedan valores perdidos y podemos construir la task correspondiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># creamos la tarea</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>task_penguins <span class="ot">=</span> <span class="fu">as_task_regr</span>(data_penguins, <span class="at">target =</span> <span class="st">"flipper_length_mm"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="co"># información de la tarea</span></span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="fu">print</span>(task_penguins)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:data_penguins&gt; (333 x 7)
* Target: flipper_length_mm
* Properties: -
* Features (6):
  - dbl (3): bill_depth_mm, bill_length_mm, body_mass_g
  - fct (3): island, sex, species</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># información variables</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>task_penguins<span class="sc">$</span>col_info</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  id    type                  levels label fix_factor_levels
1:          ..row_id integer                          &lt;NA&gt;             FALSE
2:     bill_depth_mm numeric                          &lt;NA&gt;             FALSE
3:    bill_length_mm numeric                          &lt;NA&gt;             FALSE
4:       body_mass_g numeric                          &lt;NA&gt;             FALSE
5: flipper_length_mm numeric                          &lt;NA&gt;             FALSE
6:            island  factor  Biscoe,Dream,Torgersen  &lt;NA&gt;             FALSE
7:               sex  factor             female,male  &lt;NA&gt;             FALSE
8:           species  factor Adelie,Chinstrap,Gentoo  &lt;NA&gt;             FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># información de roles</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>task_penguins<span class="sc">$</span>col_roles</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$feature
[1] "bill_depth_mm"  "bill_length_mm" "body_mass_g"    "island"        
[5] "sex"            "species"       

$target
[1] "flipper_length_mm"

$name
character(0)

$order
character(0)

$stratum
character(0)

$group
character(0)

$weight
character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># missings</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>task_penguins<span class="sc">$</span><span class="fu">missings</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>flipper_length_mm     bill_depth_mm    bill_length_mm       body_mass_g 
                0                 0                 0                 0 
           island               sex           species 
                0                 0                 0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Niveles de los factores</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>task_penguins<span class="sc">$</span><span class="fu">levels</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$island
[1] "Biscoe"    "Dream"     "Torgersen"

$sex
[1] "female" "male"  

$species
[1] "Adelie"    "Chinstrap" "Gentoo"   </code></pre>
</div>
</div>
<p>Veamos ahora las soluciones gráficas para esta task. Para targets de tipo numérico la opción <code>"duo"</code> no se encuentra disponible. Comenzamos por representar la información del target:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Gráfico target</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="fu">autoplot</span>(task_penguins, <span class="at">type =</span><span class="st">"target"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-044" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-044-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.26: Autoplot task penguins. Gráfico target</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En este caso dado que el target es numérico obtenemos el gráfico de cajas que no da información sobre su distribución.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># gráfico predictora vs target</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="fu">autoplot</span>(task_penguins, <span class="at">type =</span><span class="st">"pairs"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-045" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-045-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.27: Autoplot task penguins. Gráfico pairs</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>¿Cómo interpretamos estos gráficos? ¿cómo nos pueden ayudar estos gráficos en nuestra tarea de predicción?</p>
</section>
</section>
<section id="sec-traintest" class="level4" data-number="5.2.2.2">
<h4 data-number="5.2.2.2" class="anchored" data-anchor-id="sec-traintest"><span class="header-section-number">5.2.2.2</span> Division de muestras</h4>
<p>Como ya vimos anteriormente evaluar la capacidad predictiva de un modelo consiste en comprobar cómo de próximas son sus predicciones a los verdaderos valores de la variable respuesta. Para poder cuantificarlo de forma correcta necesitamos dividir nuestro conjunto de muestras en train y test. Con las muestras train entrenamos el modelo, mientras que con las muestras de test evaluamos la capacidad predictiva del modelo con observaciones que no han participado en la obtención del modelo.</p>
<p>El tamaño adecuado de las particiones depende en gran medida de la cantidad de datos disponibles y la seguridad que se necesite en la estimación del error, 80%-20% suele dar buenos resultados. El reparto debe hacerse de forma aleatoria o aleatoria-estratificada.</p>
<div class="callout-important callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container" title="Estratificación de muestras">
<p><strong>Para asegurar la estratificación y evitar posibles sesgo en el modelo, la muestra de test debe compartir características similares a la muestra de entrenamiento. En mlr3, y siempre que el target sea categórico, esto se puede hacer modificando el task indicando que tenemos una variable como <code>stratum</code>. El código para la <code>task_iris</code> sería el siguiente:</strong></p>
<p><strong><code>task_iris$col_roles$stratum &lt;- "species"</code></strong></p>
</div>
</div>
</div>
<p>El paquete <code>mlr3</code> dispone del objeto <code>resampling = rsmp()</code>, con las parámetros <code>"holdout"</code> y <code>ratio = p</code>, para repartir en los conjuntos train (p%) y test ((1-p)%) los datos contenidos en un <code>task</code>. Una vez creado el objeto de muestreo los atributos <code>train_set()</code> y <code>test_set()</code> nos permiten acceder a los índices de las observaciones que corresponden a cada bloque. Para asegurar la reproducibilidad de nuestros modelos es necesario fijar la semilla de números aleatorios. Cuando se emplea un resampling, si existe una o varias columnas con el role stratum, se realiza un reparto estratificado, garantizando así una distribución aproximada (por el momento, esto solo es válido para variables cualitativas). El reparto estratificado es muy importante cuando hay grupos minoritarios en alguna variable. Por ejemplo, en un set de datos con 100 observaciones, un predictor binario que tenga 90 observaciones de un grupo y solo 10 de otro, tiene un alto riesgo de que, en alguna de las particiones, el grupo minoritario no tenga representantes. Si esto ocurre en el conjunto de entrenamiento, algunos algoritmos darán error al aplicarlos al conjunto de test, ya que no entenderán el valor que se les está pasando. Este problema puede evitarse eliminando variables con varianza próxima a cero.</p>
<p>El código siguiente nos permite establecer de forma genérica el proceso de división de muestras mediante la identificación de las observaciones que asignaremos a la muestra de entrenamiento y test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># Fijamos semilla</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="co"># Creamos el objeto para la separación de muestras</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>rsmp_holdout <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb80-5"><a href="#cb80-5"></a>rsmp_holdout</span>
<span id="cb80-6"><a href="#cb80-6"></a><span class="co"># Estratificación para una task dada</span></span>
<span id="cb80-7"><a href="#cb80-7"></a>task_datos<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"variable"</span></span>
<span id="cb80-8"><a href="#cb80-8"></a><span class="co"># Incicializamos el objeto de división</span></span>
<span id="cb80-9"><a href="#cb80-9"></a>rsmp_holdout<span class="sc">$</span><span class="fu">instantiate</span>(<span class="at">task =</span> task_datos)</span>
<span id="cb80-10"><a href="#cb80-10"></a><span class="co"># Obtenemos índices de muestras</span></span>
<span id="cb80-11"><a href="#cb80-11"></a><span class="co"># Índices train</span></span>
<span id="cb80-12"><a href="#cb80-12"></a>id_train <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">train_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb80-13"><a href="#cb80-13"></a><span class="co"># Índices test</span></span>
<span id="cb80-14"><a href="#cb80-14"></a>id_test <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">test_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb80-15"><a href="#cb80-15"></a><span class="co"># Se crean dos nuevas task, una con los datos de train y otra con los de test.</span></span>
<span id="cb80-16"><a href="#cb80-16"></a><span class="co"># Dado que se va a aplicar un filtrado, y para no alterar task_datos, se emplea</span></span>
<span id="cb80-17"><a href="#cb80-17"></a><span class="co"># antes del filtro el método $clone() para hacer una copia.</span></span>
<span id="cb80-18"><a href="#cb80-18"></a>task_train <span class="ot">&lt;-</span> task_datos<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_train)</span>
<span id="cb80-19"><a href="#cb80-19"></a>task_test  <span class="ot">&lt;-</span> task_datos<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="datos-iris-4" class="level5">
<h5 class="anchored" data-anchor-id="datos-iris-4">Datos Iris</h5>
<p>Vamos a obtener la muestra de entrenamiento y test para la task iris:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Fijamos semilla</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="co"># Objeto de muestreo</span></span>
<span id="cb81-4"><a href="#cb81-4"></a>rsmp_holdout <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb81-5"><a href="#cb81-5"></a><span class="co"># Estratificación</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>task_iris<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"species"</span></span>
<span id="cb81-7"><a href="#cb81-7"></a><span class="co"># inicialización</span></span>
<span id="cb81-8"><a href="#cb81-8"></a>rsmp_holdout<span class="sc">$</span><span class="fu">instantiate</span>(<span class="at">task =</span> task_iris)</span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="co"># Índices de muestras</span></span>
<span id="cb81-10"><a href="#cb81-10"></a>id_train <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">train_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb81-11"><a href="#cb81-11"></a>id_test <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">test_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb81-12"><a href="#cb81-12"></a><span class="co"># Muestras</span></span>
<span id="cb81-13"><a href="#cb81-13"></a>task_iris_train <span class="ot">&lt;-</span> task_iris<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_train)</span>
<span id="cb81-14"><a href="#cb81-14"></a>task_iris_test  <span class="ot">&lt;-</span> task_iris<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dado que todas las predictoras son numéricas nos resulta muy fácil verificar si las muestras de entrenamiento y test son similares sin más que comparar las medianas de las predictoras para el target en cada uno de los grupos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">kable</span>(task_iris_train<span class="sc">$</span><span class="fu">data</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> <span class="fu">summarise_if</span>(is.numeric, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-aed-048" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabla&nbsp;5.1: División muestras datos Iris.Medianas muestra entrenamiento</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: right;">petal_length</th>
<th style="text-align: right;">petal_width</th>
<th style="text-align: right;">sepal_length</th>
<th style="text-align: right;">sepal_width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">3.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">5.95</td>
<td style="text-align: right;">2.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">5.55</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">6.70</td>
<td style="text-align: right;">3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="fu">kable</span>(task_iris_test<span class="sc">$</span><span class="fu">data</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> <span class="fu">summarise_if</span>(is.numeric, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-aed-049" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabla&nbsp;5.2: División muestras datos Penguins. Medianas muestra test</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: right;">petal_length</th>
<th style="text-align: right;">petal_width</th>
<th style="text-align: right;">sepal_length</th>
<th style="text-align: right;">sepal_width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Iris-setosa</td>
<td style="text-align: right;">1.45</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">5.05</td>
<td style="text-align: right;">3.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">Iris-versicolor</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">5.75</td>
<td style="text-align: right;">2.75</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Iris-virginica</td>
<td style="text-align: right;">5.45</td>
<td style="text-align: right;">2.1</td>
<td style="text-align: right;">6.35</td>
<td style="text-align: right;">2.80</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Se puede ver que las medianas para los dos grupos son muy similares indicando que la separación de muestras no parece incurrir en ningún sesgo de partida.</p>
</section>
<section id="datos-penguins-4" class="level5">
<h5 class="anchored" data-anchor-id="datos-penguins-4">Datos Penguins</h5>
<p>Vamos a obtener la muestra de entrenamiento y test para la task penguins:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Fijamos semilla</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="co"># Objeto de muestreo</span></span>
<span id="cb84-4"><a href="#cb84-4"></a>rsmp_holdout <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="co"># inicialización</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>rsmp_holdout<span class="sc">$</span><span class="fu">instantiate</span>(<span class="at">task =</span> task_penguins)</span>
<span id="cb84-7"><a href="#cb84-7"></a><span class="co"># Índices de muestras</span></span>
<span id="cb84-8"><a href="#cb84-8"></a>id_train <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">train_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb84-9"><a href="#cb84-9"></a>id_test <span class="ot">&lt;-</span> rsmp_holdout<span class="sc">$</span><span class="fu">test_set</span>(<span class="at">i =</span> <span class="dv">1</span>)</span>
<span id="cb84-10"><a href="#cb84-10"></a><span class="co"># Muestras</span></span>
<span id="cb84-11"><a href="#cb84-11"></a>task_penguins_train <span class="ot">&lt;-</span> task_penguins<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_train)</span>
<span id="cb84-12"><a href="#cb84-12"></a>task_penguins_test  <span class="ot">&lt;-</span> task_penguins<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(id_test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este caso podemos comparar la división mediante al representación gráfica de cada task:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># gráfico predictora vs target</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">autoplot</span>(task_penguins_train, <span class="at">type =</span><span class="st">"pairs"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-050" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-050-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.28: Autoplot task-train penguins. Gráfico pairs</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co"># gráfico predictora vs target</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="fu">autoplot</span>(task_penguins_test, <span class="at">type =</span><span class="st">"pairs"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-051" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-051-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.29: Autoplot task-test penguins. Gráfico pairs</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-preprocesed" class="level4" data-number="5.2.2.3">
<h4 data-number="5.2.2.3" class="anchored" data-anchor-id="sec-preprocesed"><span class="header-section-number">5.2.2.3</span> Preprocesado de datos</h4>
<p>Como ya vimos en la <a href="20_introAA.html"><span>Unidad&nbsp;5</span></a> el preprocesado de datos engloba todas aquellas transformaciones realizadas sobre los datos con el objetivo que puedan ser interpretados por los algoritmos de aprendizaje automático lo más eficientemente posible. Todo preprocesado de datos debe realizarse con las observaciones de entrenamiento y luego aplicarse al conjunto de entrenamiento y al de test. Esto es muy importante para no incluir sesgos artificiales en los modelos y evitar violar la condición de que ninguna información procedente de las observaciones de test participe o influya en el ajuste del modelo. Este principio debe aplicarse también si se emplea validación cruzada como veremos más adelante. Los pasos principales de cualquier preprocesado se pueden englobar en cinco grandes apartados: limpieza de datos. imputación de valores ausentes, exclusión de variables con varianza próxima a cero, estandarización y/o escalado de variables numéricas, y codificación de factores en variables dummy.</p>
<p>Tan solo la tarea de limpieza de datos no requiere de funciones especiales ya que sus objetivo principales son:</p>
<ul>
<li>Detectar factores con un único nivel (función <code>summary()</code>).</li>
<li>Detectar niveles del factor con nombres distintos pero con los mismos valores (función <code>identical()</code>).</li>
<li>Detectar variables numéricas con los mismos valores en diferentes escalas (función <code>cor()</code>).</li>
</ul>
<p>En esta situación la opción más sencilla es eliminar dichas variables (<code>to_remove()</code>). Sin embargo, existen otros problemas habituales en los que no podemos eliminar variables:</p>
<ul>
<li>Las columnas de ID, es decir, las columnas que son únicas para cada observación deben eliminarse o etiquetarse.</li>
<li>Los NA no están codificados correctamente como “NA” o “”</li>
<li>Errores semánticos en los datos, por ejemplo, una variable que sólo puede tomar valores positivos con valores negativos.</li>
<li>Funciones numéricas codificadas como categóricas para los alumnos que no pueden manejar dichas funciones.</li>
</ul>
<p>En estas situaciones hay que identificar las muestras donde se producen estos errores y corregirlos si es posible.</p>
<p>Para el resto de tarea de preprocesado de los datos dentro del ecosistema <strong>mlr3</strong> es mediante los paquetes <code>mlr3pipelines</code> y <code>mlrfilters</code>. Estos paquetes permite encadenar operadores <code>PipeOp</code> y <code>Filters</code>, donde cada uno aplica una transformación concreta, y ejecutarlos todos de forma secuencial. Una vez que han sido definidos, pueden ser utilizados para entrenar con <code>$train()</code> y luego aplicados a nuevos conjuntos de datos con <code>$pred()</code>. La cantidad de operadores es muy grande y todavía se siguen añadiendo más por lo que es recomendable acudir al <a href="https://mlr3pipelines.mlr-org.com/reference/index.html">manual</a> para ver los detalles de todos ellos. Para una demostración detallada del uso de estos paquetes para el preprocesado de datos se deben consultar los capítulos 7 a 9 de este <a href="https://mlr3book.mlr-org.com/chapters/chapter7/sequential_pipelines.html">libro</a>.</p>
<p>A continuación listamos los operadores disponibles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># Operadores pipeop disponibles </span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="fu">kable</span>(<span class="fu">as.data.table</span>(<span class="fu">po</span>())[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Operadores pipeop disponibles </caption>
<colgroup>
<col style="width: 16%">
<col style="width: 54%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">key</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">packages</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">boxcox</td>
<td style="text-align: left;">Box-Cox Transformation of Numeric Features</td>
<td style="text-align: left;">mlr3pipelines, bestNormalize</td>
</tr>
<tr class="even">
<td style="text-align: left;">branch</td>
<td style="text-align: left;">Path Branching</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chunk</td>
<td style="text-align: left;">Chunk Input into Multiple Outputs</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">classbalancing</td>
<td style="text-align: left;">Class Balancing</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">classifavg</td>
<td style="text-align: left;">Majority Vote Prediction</td>
<td style="text-align: left;">mlr3pipelines, stats</td>
</tr>
<tr class="even">
<td style="text-align: left;">classweights</td>
<td style="text-align: left;">Class Weights for Sample Weighting</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">colapply</td>
<td style="text-align: left;">Apply a Function to each Column of a Task</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">collapsefactors</td>
<td style="text-align: left;">Collapse Factors</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">colroles</td>
<td style="text-align: left;">Change Column Roles of a Task</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">copy</td>
<td style="text-align: left;">Copy Input Multiple Times</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datefeatures</td>
<td style="text-align: left;">Preprocess Date Features</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">encode</td>
<td style="text-align: left;">Factor Encoding</td>
<td style="text-align: left;">mlr3pipelines, stats</td>
</tr>
<tr class="odd">
<td style="text-align: left;">encodeimpact</td>
<td style="text-align: left;">Conditional Target Value Impact Encoding</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">encodelmer</td>
<td style="text-align: left;">Impact Encoding with Random Intercept Models</td>
<td style="text-align: left;">mlr3pipelines, lme4 , nloptr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">featureunion</td>
<td style="text-align: left;">Aggregate Features from Multiple Inputs</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">filter</td>
<td style="text-align: left;">Feature Filtering</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fixfactors</td>
<td style="text-align: left;">Fix Factor Levels</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">histbin</td>
<td style="text-align: left;">Split Numeric Features into Equally Spaced Bins</td>
<td style="text-align: left;">mlr3pipelines, graphics</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ica</td>
<td style="text-align: left;">Independent Component Analysis</td>
<td style="text-align: left;">mlr3pipelines, fastICA</td>
</tr>
<tr class="even">
<td style="text-align: left;">imputeconstant</td>
<td style="text-align: left;">Impute Features by a Constant</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">imputehist</td>
<td style="text-align: left;">Impute Numerical Features by Histogram</td>
<td style="text-align: left;">mlr3pipelines, graphics</td>
</tr>
<tr class="even">
<td style="text-align: left;">imputelearner</td>
<td style="text-align: left;">Impute Features by Fitting a Learner</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">imputemean</td>
<td style="text-align: left;">Impute Numerical Features by their Mean</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">imputemedian</td>
<td style="text-align: left;">Impute Numerical Features by their Median</td>
<td style="text-align: left;">mlr3pipelines, stats</td>
</tr>
<tr class="odd">
<td style="text-align: left;">imputemode</td>
<td style="text-align: left;">Impute Features by their Mode</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">imputeoor</td>
<td style="text-align: left;">Out of Range Imputation</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">imputesample</td>
<td style="text-align: left;">Impute Features by Sampling</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">kernelpca</td>
<td style="text-align: left;">Kernelized Principle Component Analysis</td>
<td style="text-align: left;">mlr3pipelines, kernlab</td>
</tr>
<tr class="odd">
<td style="text-align: left;">learner</td>
<td style="text-align: left;">Wrap a Learner into a PipeOp</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">learner_cv</td>
<td style="text-align: left;">Wrap a Learner into a PipeOp with Cross-validated Predictions as Features</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">missind</td>
<td style="text-align: left;">Add Missing Indicator Columns</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">modelmatrix</td>
<td style="text-align: left;">Transform Columns by Constructing a Model Matrix</td>
<td style="text-align: left;">mlr3pipelines, stats</td>
</tr>
<tr class="odd">
<td style="text-align: left;">multiplicityexply</td>
<td style="text-align: left;">Explicate a Multiplicity</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">multiplicityimply</td>
<td style="text-align: left;">Implicate a Multiplicity</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mutate</td>
<td style="text-align: left;">Add Features According to Expressions</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">nmf</td>
<td style="text-align: left;">Non-negative Matrix Factorization</td>
<td style="text-align: left;">mlr3pipelines, MASS , NMF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nop</td>
<td style="text-align: left;">Simply Push Input Forward</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">ovrsplit</td>
<td style="text-align: left;">Split a Classification Task into Binary Classification Tasks</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ovrunite</td>
<td style="text-align: left;">Unite Binary Classification Tasks</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">pca</td>
<td style="text-align: left;">Principle Component Analysis</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">proxy</td>
<td style="text-align: left;">Wrap another PipeOp or Graph as a Hyperparameter</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">quantilebin</td>
<td style="text-align: left;">Split Numeric Features into Quantile Bins</td>
<td style="text-align: left;">mlr3pipelines, stats</td>
</tr>
<tr class="odd">
<td style="text-align: left;">randomprojection</td>
<td style="text-align: left;">Project Numeric Features onto a Randomly Sampled Subspace</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">randomresponse</td>
<td style="text-align: left;">Generate a Randomized Response Prediction</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">regravg</td>
<td style="text-align: left;">Weighted Prediction Averaging</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">removeconstants</td>
<td style="text-align: left;">Remove Constant Features</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">renamecolumns</td>
<td style="text-align: left;">Rename Columns</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">replicate</td>
<td style="text-align: left;">Replicate the Input as a Multiplicity</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scale</td>
<td style="text-align: left;">Center and Scale Numeric Features</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">scalemaxabs</td>
<td style="text-align: left;">Scale Numeric Features with Respect to their Maximum Absolute Value</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scalerange</td>
<td style="text-align: left;">Linearly Transform Numeric Features to Match Given Boundaries</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">select</td>
<td style="text-align: left;">Remove Features Depending on a Selector</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">smote</td>
<td style="text-align: left;">SMOTE Balancing</td>
<td style="text-align: left;">mlr3pipelines, smotefamily</td>
</tr>
<tr class="even">
<td style="text-align: left;">spatialsign</td>
<td style="text-align: left;">Normalize Data Row-wise</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">subsample</td>
<td style="text-align: left;">Subsampling</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">targetinvert</td>
<td style="text-align: left;">Invert Target Transformations</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">targetmutate</td>
<td style="text-align: left;">Transform a Target by a Function</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="even">
<td style="text-align: left;">targettrafoscalerange</td>
<td style="text-align: left;">Linearly Transform a Numeric Target to Match Given Boundaries</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">textvectorizer</td>
<td style="text-align: left;">Bag-of-word Representation of Character Features</td>
<td style="text-align: left;">mlr3pipelines, quanteda , stopwords</td>
</tr>
<tr class="even">
<td style="text-align: left;">threshold</td>
<td style="text-align: left;">Change the Threshold of a Classification Prediction</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tunethreshold</td>
<td style="text-align: left;">Tune the Threshold of a Classification Prediction</td>
<td style="text-align: left;">mlr3pipelines, bbotk</td>
</tr>
<tr class="even">
<td style="text-align: left;">unbranch</td>
<td style="text-align: left;">Unbranch Different Paths</td>
<td style="text-align: left;">mlr3pipelines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vtreat</td>
<td style="text-align: left;">Interface to the vtreat Package</td>
<td style="text-align: left;">mlr3pipelines, vtreat</td>
</tr>
<tr class="even">
<td style="text-align: left;">yeojohnson</td>
<td style="text-align: left;">Yeo-Johnson Transformation of Numeric Features</td>
<td style="text-align: left;">mlr3pipelines, bestNormalize</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Los filtros nos permiten utilizar diferentes criterios de selección de variables para identificar aquellas con un mayor peso sobre el target, y así poder descartar todas aquellas que tengan poca relevancia para el problema planteado. Podemos conocer todos los filtros disponibles con el código siguiente o acudiendo al <a href="https://mlr3filters.mlr-org.com/reference/index.html">manual</a> directamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># Filtros disponibles </span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">kable</span>(<span class="fu">as.data.table</span>(<span class="fu">flt</span>())[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Operadores filter disponibles </caption>
<colgroup>
<col style="width: 20%">
<col style="width: 64%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">key</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">task_types</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">anova</td>
<td style="text-align: left;">ANOVA F-Test</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="even">
<td style="text-align: left;">auc</td>
<td style="text-align: left;">Area Under the ROC Curve Score</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carscore</td>
<td style="text-align: left;">Correlation-Adjusted coRrelation Score</td>
<td style="text-align: left;">regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">carsurvscore</td>
<td style="text-align: left;">Correlation-Adjusted coRrelation Survival Score</td>
<td style="text-align: left;">surv</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cmim</td>
<td style="text-align: left;">Minimal Conditional Mutual Information Maximization</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">correlation</td>
<td style="text-align: left;">Correlation</td>
<td style="text-align: left;">regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disr</td>
<td style="text-align: left;">Double Input Symmetrical Relevance</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">find_correlation</td>
<td style="text-align: left;">Correlation-based Score</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">importance</td>
<td style="text-align: left;">Importance Score</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="even">
<td style="text-align: left;">information_gain</td>
<td style="text-align: left;">Information Gain</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jmi</td>
<td style="text-align: left;">Joint Mutual Information</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">jmim</td>
<td style="text-align: left;">Minimal Joint Mutual Information Maximization</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kruskal_test</td>
<td style="text-align: left;">Kruskal-Wallis Test</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="even">
<td style="text-align: left;">mim</td>
<td style="text-align: left;">Mutual Information Maximization</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mrmr</td>
<td style="text-align: left;">Minimum Redundancy Maximal Relevancy</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">njmim</td>
<td style="text-align: left;">Minimal Normalised Joint Mutual Information Maximization</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">performance</td>
<td style="text-align: left;">Predictive Performance</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="even">
<td style="text-align: left;">permutation</td>
<td style="text-align: left;">Permutation Score</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="odd">
<td style="text-align: left;">relief</td>
<td style="text-align: left;">RELIEF</td>
<td style="text-align: left;">classif, regr</td>
</tr>
<tr class="even">
<td style="text-align: left;">selected_features</td>
<td style="text-align: left;">Embedded Feature Selection</td>
<td style="text-align: left;">classif</td>
</tr>
<tr class="odd">
<td style="text-align: left;">variance</td>
<td style="text-align: left;">Variance</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>A continuación vamos a aplicar los operadores presentados sobre los bancos de datos que venimos trabajando. La función para pipeops es <code>po()</code>, mientras que para los filtros es <code>flt()</code>.</p>
<p><code>PipeOps</code> representa los pasos computacionales individuales en canalizaciones de aprendizaje automático. Estas canalizaciones en sí mismas están definidas por objetos <code>Graph</code>. Un <code>Graph</code> es una colección de <code>PipeOps</code> con “ejes” que guían el flujo de datos.</p>
<p>La forma más conveniente de construir un <code>Graph</code> es conectar una secuencia de <code>PipeOps</code> usando el operador <code>%&gt;&gt;%</code>. Cuando se le dan dos <code>PipeOps</code>, este operador crea un <code>Graph</code> que primero ejecuta el <code>PipeOps</code> de la izquierda, seguido por el de la derecha. También se puede usar para conectar un <code>Graph</code> con un <code>PipeOps</code> o con otro <code>Graph</code>. En lugar de usar <code>%&gt;&gt;%</code>, también puede crear un gráfico explícitamente usando los métodos <code>$add_pipeop()</code> y <code>$add_edge()</code> para crear <code>PipeOps</code> y los bordes que los conectan. En los ejemplos siguientes presentamos diferentes usos de estos recursos.</p>
<section id="datos-iris-5" class="level5">
<h5 class="anchored" data-anchor-id="datos-iris-5">Datos Iris</h5>
<p>Como ya vimos en la <a href="#sec-task"><span>Sección&nbsp;5.2.2.1</span></a> la task de este conjunto de datos no contiene valores perdidos y todas las predictoras son de tipo numérico. La única tarea de preprocesado es la estandarización de predictoras. Definimos el objeto de preprocesado para este conjunto de datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Objeto preprocesado</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>pp_iris <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los resultados de un operador <code>mlr3pipelines</code> siempre son una lista, en la que el primer elemento (<code>[[1]]</code>) contiene los datos transformados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># Creamos un nuevo objeto con los datos preprocesados</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>task_iris_train_pp <span class="ot">=</span> pp_iris<span class="sc">$</span><span class="fu">train</span>(<span class="fu">list</span>(task_iris_train))[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb90-3"><a href="#cb90-3"></a>task_iris_test_pp <span class="ot">=</span> pp_iris<span class="sc">$</span><span class="fu">train</span>(<span class="fu">list</span>(task_iris_test))[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">clone</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos ver la transformación realizada listando los primeros casos de los nuevos objetos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">head</span>(task_iris_train_pp)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       species petal_length petal_width sepal_length sepal_width
1: Iris-setosa    -1.326694   -1.316694   -1.1298717 -0.14263325
2: Iris-setosa    -1.382712   -1.316694   -1.3622361  0.31996106
3: Iris-setosa    -1.270676   -1.316694   -1.4784183  0.08866391
4: Iris-setosa    -1.326694   -1.316694   -1.0136896  1.24514969
5: Iris-setosa    -1.158640   -1.053355   -0.5489608  1.93904115
6: Iris-setosa    -1.326694   -1.185025   -1.4784183  0.78255538</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">head</span>(task_iris_test_pp)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       species petal_length petal_width sepal_length sepal_width
1: Iris-setosa    -1.358415   -1.256005   -0.9185233  1.07200685
2: Iris-setosa    -1.299863   -1.382448   -1.2116690  0.17242068
3: Iris-setosa    -1.299863   -1.256005   -0.4788047  1.52179994
4: Iris-setosa    -1.358415   -1.382448   -1.3582418 -0.05247586
5: Iris-setosa    -1.416968   -1.003118   -0.4788047  1.97159302
6: Iris-setosa    -1.358415   -1.129561   -0.9185233  1.07200685</code></pre>
</div>
</div>
<p>Valoramos ahora la capacidad de clasificación de cada una de las predictoras mediante el uso de filtros para estudiar la relevancia de cada una de ellas. Comenzamos utilizando el estadístico F para la comparación de los tres grupos de flores en cada una de las predictoras individualmente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Construimos el objeto que define el filtro</span></span>
<span id="cb95-2"><a href="#cb95-2"></a>filter <span class="ot">=</span> <span class="fu">flt</span>(<span class="st">"anova"</span>)</span>
<span id="cb95-3"><a href="#cb95-3"></a></span>
<span id="cb95-4"><a href="#cb95-4"></a><span class="co"># Aplicamos el filtro sobre los datos de entrenamiento</span></span>
<span id="cb95-5"><a href="#cb95-5"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task_iris_train_pp)</span>
<span id="cb95-6"><a href="#cb95-6"></a><span class="co"># Vemos los resultados</span></span>
<span id="cb95-7"><a href="#cb95-7"></a>filter</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FilterAnova:anova&gt;: ANOVA F-Test
Task Types: classif
Properties: -
Task Properties: -
Packages: stats
Feature types: integer, numeric
        feature    score
1: petal_length 72.04517
2:  petal_width 67.43149
3: sepal_length 26.62265
4:  sepal_width 11.58676</code></pre>
</div>
</div>
<p>Podemos ver como los valores más altos aparecen en las predictoras relacionadas con el pétalo, tal y como habíamos visto en el análisis exploratorio inicial. En realidad el score obtenido se puede pasar al p-valor de comparación de los tres grupos con:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span>filter<span class="sc">$</span>scores)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>petal_length  petal_width sepal_length  sepal_width 
9.012243e-73 3.702597e-68 2.384219e-27 2.589643e-12 </code></pre>
</div>
</div>
</section>
<section id="datos-penguins-5" class="level5">
<h5 class="anchored" data-anchor-id="datos-penguins-5">Datos Penguins</h5>
<p>En esta banco de datos hemos observado valores perdidos tanto en las variables numéricas como en los factores, de forma que antes de pasar al preprocesado vamos a ver las opciones posibles de imputación con la función <code>po()</code>:</p>
<ul>
<li><code>imputeconstant</code>: que imputa valores con una valor constante.</li>
<li><code>imputehist</code>: imputa valores en variables numéricas mediante su histograma.</li>
<li><code>imputemean</code>: imputa valores en variables numéricas mediante su media.</li>
<li><code>imputemedian</code>: imputa valores en variables numéricas mediante su mediana.</li>
<li><code>imputemode</code>: imputa valores mediante su moda.</li>
<li><code>imputeoor</code>: imputa valores en factores mediante la creación de un nuevo nivel <code>.MISSING</code>.</li>
<li><code>imputesample</code>: imputa valores muestreando sobre los datos no perdidos de entrenamiento.</li>
</ul>
<p>En este caso seleccionamos <code>imputmedian</code> para las variables numéricas e <code>imputesample</code> para las de tipo categórico.</p>
<p>Además, como tenemos variables categóricas como posibles predictoras es necesario convertirlas a variables numéricas mediante un método de codificación. Las codificaciones posibles son:</p>
<ul>
<li><code>one-hot</code>: que crea variables ficticias con valores 0-1 en función del nivel de la categórica de cada variable. De esta forma se asocian tantas variables numéricas como niveles de un factor.</li>
<li>contr.helmert: devuelve una matriz de variables numéricas con los contrastes de Helmert, que contrastan el segundo nivel con el primero, el tercero con el promedio de los dos primeros, y así sucesivamente.</li>
<li>contr.poly: devuelve una matriz de variables numéricas con los contrastes basados en polinomios ortogonales.</li>
<li>contr.sum: devuelve una matriz de variables con los contrastes ‘sum to zero contrats’.</li>
<li>contr.treatment: contrasta cada nivel con el nivel de referencia (especificado por base): se omite el nivel de referencia.</li>
</ul>
<p>A continuación podemos ver las variables asociadas a cada tipo de contraste para un factor con tres niveles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">contr.helmert</span>(<span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2]
1   -1   -1
2    1   -1
3    0    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="fu">contr.poly</span>(<span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                .L         .Q
[1,] -7.071068e-01  0.4082483
[2,] -7.850462e-17 -0.8164966
[3,]  7.071068e-01  0.4082483</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">contr.sum</span>(<span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2]
1    1    0
2    0    1
3   -1   -1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="fu">contr.treatment</span>(<span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  2 3
1 0 0
2 1 0
3 0 1</code></pre>
</div>
</div>
<p>En nuestro caso utilizaremos la codificación one-hot que es muy habitual dentro del aprendizaje automático. A continuación se muestra el código necesario para llevar a cabo la imputación, estandarización y codificación para el banco de datos penguins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>preprocesado <span class="ot">=</span> </span>
<span id="cb107-2"><a href="#cb107-2"></a>   <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>   <span class="fu">po</span>(<span class="st">"imputemedian"</span>, <span class="at">affect_columns =</span> <span class="fu">selector_type</span>(<span class="st">"numeric"</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4"></a>   <span class="fu">po</span>(<span class="st">"imputeoor"</span>, <span class="at">affect_columns =</span> <span class="fu">selector_type</span>(<span class="st">"factor"</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb107-5"><a href="#cb107-5"></a>   <span class="fu">po</span>(<span class="st">"encode"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"one-hot"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos aplicar el procedimiento de preprocesado haciendo uso del método <code>train</code> sobre dicho objeto aplicado sobre una task específica. Veamos su efecto sobre los datos de entrenamiento penguin:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>preprocesado<span class="sc">$</span><span class="fu">train</span>(task_penguins_train)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$encode.output
&lt;TaskRegr:data_penguins&gt; (266 x 12)
* Target: flipper_length_mm
* Properties: -
* Features (11):
  - dbl (11): bill_depth_mm, bill_length_mm, body_mass_g,
    island.Biscoe, island.Dream, island.Torgersen, sex.female,
    sex.male, species.Adelie, species.Chinstrap, species.Gentoo</code></pre>
</div>
</div>
<p>En el nuevo objeto aparecen definidas las variables obtenidas a partir de la codificación e imputación de los factores.</p>
<p>Los resultados (<code>output</code>) de un operador <code>mlr3pipelines</code> siempre son una lista, en la que el primer elemento (<code>[[1]]</code>) contiene los datos transformados. En este caso vamos a obtener los valores preprocesados tanto para la muestra de entrenamiento como la de test. Creamos nuevas <code>task</code> para no machacar los datos anteriores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>task_penguins_train_pp <span class="ot">&lt;-</span> preprocesado<span class="sc">$</span><span class="fu">predict</span>(task_penguins_train)[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb110-2"><a href="#cb110-2"></a>task_penguins_test_pp  <span class="ot">&lt;-</span> preprocesado<span class="sc">$</span><span class="fu">predict</span>(task_penguins_test)[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">clone</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Veamos como han quedado los datos para la muestra de entrenamiento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="fu">kable</span>(task_penguins_train_pp<span class="sc">$</span><span class="fu">data</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>())</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">flipper_length_mm</th>
<th style="text-align: right;">bill_depth_mm</th>
<th style="text-align: right;">bill_length_mm</th>
<th style="text-align: right;">body_mass_g</th>
<th style="text-align: right;">island.Biscoe</th>
<th style="text-align: right;">island.Dream</th>
<th style="text-align: right;">island.Torgersen</th>
<th style="text-align: right;">sex.female</th>
<th style="text-align: right;">sex.male</th>
<th style="text-align: right;">species.Adelie</th>
<th style="text-align: right;">species.Chinstrap</th>
<th style="text-align: right;">species.Gentoo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">186</td>
<td style="text-align: right;">0.0559552</td>
<td style="text-align: right;">-0.7699838</td>
<td style="text-align: right;">-0.4643987</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">193</td>
<td style="text-align: right;">1.0311198</td>
<td style="text-align: right;">-1.2704497</td>
<td style="text-align: right;">-0.8992543</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">190</td>
<td style="text-align: right;">1.6983376</td>
<td style="text-align: right;">-0.8057313</td>
<td style="text-align: right;">-0.6507654</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">181</td>
<td style="text-align: right;">0.2612530</td>
<td style="text-align: right;">-0.8772265</td>
<td style="text-align: right;">-0.6818265</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">195</td>
<td style="text-align: right;">1.1850931</td>
<td style="text-align: right;">-0.8236051</td>
<td style="text-align: right;">0.6227403</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">191</td>
<td style="text-align: right;">2.0062843</td>
<td style="text-align: right;">-0.9308478</td>
<td style="text-align: right;">-0.4643987</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="sec-learner" class="level4" data-number="5.2.2.4">
<h4 data-number="5.2.2.4" class="anchored" data-anchor-id="sec-learner"><span class="header-section-number">5.2.2.4</span> Modelo (learner)</h4>
<p>El siguiente paso tras definir los datos de entrenamiento, es seleccionar el algoritmo que se va a emplear. En <code>mlr3</code>, esto se hace mediante la creación de un objeto learner. Los objetos de la clase Learner proporcionan una interfaz unificada para muchos algoritmos populares de aprendizaje automático en R. El paquete <code>mlr3learners</code> contiene solo los principales algoritmos empleados para clasificación y regresión (<a href="https://mlr-org.com/learners.html">listado</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># Listado de learners disponibles en mlr3learners</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>mlr_learners<span class="sc">$</span><span class="fu">keys</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "classif.abess"            "classif.AdaBoostM1"      
  [3] "classif.bart"             "classif.C50"             
  [5] "classif.cforest"          "classif.ctree"           
  [7] "classif.cv_glmnet"        "classif.debug"           
  [9] "classif.earth"            "classif.featureless"     
 [11] "classif.fnn"              "classif.gam"             
 [13] "classif.gamboost"         "classif.gausspr"         
 [15] "classif.gbm"              "classif.glmboost"        
 [17] "classif.glmer"            "classif.glmnet"          
 [19] "classif.IBk"              "classif.imbalanced_rfsrc"
 [21] "classif.J48"              "classif.JRip"            
 [23] "classif.kknn"             "classif.ksvm"            
 [25] "classif.lda"              "classif.liblinear"       
 [27] "classif.lightgbm"         "classif.LMT"             
 [29] "classif.log_reg"          "classif.lssvm"           
 [31] "classif.mob"              "classif.multinom"        
 [33] "classif.naive_bayes"      "classif.nnet"            
 [35] "classif.OneR"             "classif.PART"            
 [37] "classif.priority_lasso"   "classif.qda"             
 [39] "classif.randomForest"     "classif.ranger"          
 [41] "classif.rfsrc"            "classif.rpart"           
 [43] "classif.svm"              "classif.xgboost"         
 [45] "clust.agnes"              "clust.ap"                
 [47] "clust.cmeans"             "clust.cobweb"            
 [49] "clust.dbscan"             "clust.diana"             
 [51] "clust.em"                 "clust.fanny"             
 [53] "clust.featureless"        "clust.ff"                
 [55] "clust.hclust"             "clust.kkmeans"           
 [57] "clust.kmeans"             "clust.MBatchKMeans"      
 [59] "clust.mclust"             "clust.meanshift"         
 [61] "clust.pam"                "clust.SimpleKMeans"      
 [63] "clust.xmeans"             "dens.kde_ks"             
 [65] "dens.locfit"              "dens.logspline"          
 [67] "dens.mixed"               "dens.nonpar"             
 [69] "dens.pen"                 "dens.plug"               
 [71] "dens.spline"              "regr.abess"              
 [73] "regr.bart"                "regr.cforest"            
 [75] "regr.ctree"               "regr.cubist"             
 [77] "regr.cv_glmnet"           "regr.debug"              
 [79] "regr.earth"               "regr.featureless"        
 [81] "regr.fnn"                 "regr.gam"                
 [83] "regr.gamboost"            "regr.gausspr"            
 [85] "regr.gbm"                 "regr.glm"                
 [87] "regr.glmboost"            "regr.glmnet"             
 [89] "regr.IBk"                 "regr.kknn"               
 [91] "regr.km"                  "regr.ksvm"               
 [93] "regr.liblinear"           "regr.lightgbm"           
 [95] "regr.lm"                  "regr.lmer"               
 [97] "regr.M5Rules"             "regr.mars"               
 [99] "regr.mob"                 "regr.nnet"               
[101] "regr.priority_lasso"      "regr.randomForest"       
[103] "regr.ranger"              "regr.rfsrc"              
[105] "regr.rpart"               "regr.rsm"                
[107] "regr.rvm"                 "regr.svm"                
[109] "regr.xgboost"             "surv.akritas"            
[111] "surv.aorsf"               "surv.blackboost"         
[113] "surv.cforest"             "surv.coxboost"           
[115] "surv.coxtime"             "surv.ctree"              
[117] "surv.cv_coxboost"         "surv.cv_glmnet"          
[119] "surv.deephit"             "surv.deepsurv"           
[121] "surv.dnnsurv"             "surv.flexible"           
[123] "surv.gamboost"            "surv.gbm"                
[125] "surv.glmboost"            "surv.glmnet"             
[127] "surv.loghaz"              "surv.mboost"             
[129] "surv.nelson"              "surv.obliqueRSF"         
[131] "surv.parametric"          "surv.pchazard"           
[133] "surv.penalized"           "surv.priority_lasso"     
[135] "surv.ranger"              "surv.rfsrc"              
[137] "surv.svm"                 "surv.xgboost"            </code></pre>
</div>
</div>
<p>Podemos identificar el tipo de tarea de cada algoritmo de aprendizaje viendo el prefijo de cada uno de ellos:</p>
<ul>
<li><code>classif</code> para tareas de clasificación.</li>
<li><code>clust</code> para tareas de agrupación.</li>
<li><code>dens</code> para tareas de estimación de densidades.</li>
<li><code>regr</code> para tareas de regresión.</li>
<li><code>surv</code> para tareas de supervivencia.</li>
</ul>
<p>El listado completo de learners disponibles (incluidos en el paquete <code>mlr3extralearners</code>) se pueden consultar en este <a href="https://mlr-org.com/learners.html">enlace</a>. Es necesario instalar y cargar dicho paquete para acceder a todos esos modelos de aprendizaje. Todos los objeto <code>learner</code> incluyen los metadatos siguientes:</p>
<ul>
<li><p><code>feature_types</code>: tipo de variables que el algoritmo es capaz de aceptar (importante para identificar aquellos que no pueden tratar con factores.</p></li>
<li><p><code>packages</code>: el paquete al que pertenece el algoritmo.</p></li>
<li><p><code>properties</code>: propiedades adicionales del algoritmo. Por ejemplo, “missings” significa que puede tratar con valores ausentes, y “importance” significa que el algoritmo es capaz de calcular la importancia de los predictores.</p></li>
<li><p><code>predict_types</code>: tipo de predicción.</p>
<ul>
<li><p>Clasificación: “response” devuelve únicamente la clase con mayor probabilidad y “prob” devuelve además la probabilidad de cada clase.</p></li>
<li><p>Regresión: “response” devuelve el valor predicho y “se” devuelve además el error estándar de la predicción.</p></li>
<li><p>Supervivencia: “response” devuelve una medida de “risk” y “prob” devuelve la probabilidad en función del tiempo.</p></li>
<li><p>Clustering: “response” devuelve el id del <em>cluster</em> al que se ha asignado cada observación y “prob” devuelve la probabilidad de asignación a cada <em>cluster</em> (solo para <em>fuzzy clustering)</em>.</p></li>
</ul></li>
<li><p><code>param_set</code>: conjunto de hiperparámetros disponibles.</p></li>
</ul>
<p>Al igual que con las tareas, podemos acceder a un modelo de aprendizaje específico mediante la función <code>lrn()</code>. Para ejecutar cualquier modelo de aprendizaje debemos pasar por dos fases:</p>
<ul>
<li><p>Entrenamiento: Los datos de entrenamiento (características y objetivo) se pasan a la función <code>$train()</code> del learner que entrena y almacena un modelo, es decir, la relación entre el objetivo y las características.</p></li>
<li><p>Predicción: Los datos de test se pasan al método <code>$predict()</code> del learner para predecir los valores objetivo. Con dichos datos debemos valorar la capacidad predictiva mediante cualquiera de las métricas disponibles. A continuación se muestran las métricas disponibles:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="co"># Métricas disponibles</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>mlr_measures</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DictionaryMeasure&gt; with 66 stored values
Keys: aic, bic, classif.acc, classif.auc, classif.bacc, classif.bbrier,
  classif.ce, classif.costs, classif.dor, classif.fbeta, classif.fdr,
  classif.fn, classif.fnr, classif.fomr, classif.fp, classif.fpr,
  classif.logloss, classif.mauc_au1p, classif.mauc_au1u,
  classif.mauc_aunp, classif.mauc_aunu, classif.mbrier, classif.mcc,
  classif.npv, classif.ppv, classif.prauc, classif.precision,
  classif.recall, classif.sensitivity, classif.specificity, classif.tn,
  classif.tnr, classif.tp, classif.tpr, clust.ch, clust.dunn,
  clust.silhouette, clust.wss, debug_classif, oob_error, regr.bias,
  regr.ktau, regr.mae, regr.mape, regr.maxae, regr.medae, regr.medse,
  regr.mse, regr.msle, regr.pbias, regr.rae, regr.rmse, regr.rmsle,
  regr.rrse, regr.rse, regr.rsq, regr.sae, regr.smape, regr.srho,
  regr.sse, selected_features, sim.jaccard, sim.phi, time_both,
  time_predict, time_train</code></pre>
</div>
</div>
<p>Como ocurre con la <code>task</code> o el <code>learner</code> para poder utilizar una métrica debemos definirla en primer lugar mediante la función <code>msr()</code>. La descripción de cada una de estas medidas de validación se puede consultar en este <a href="https://mlr-org.com/measures.html">enlace</a>.</p>
<p>En la imagen siguiente podemos ver la representación del proceso de aprendizaje básico en un modelo de aprendizaje:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://raw.githubusercontent.com/ia4legos/MachineLearning/main/images/modeloAA.png" width="500" height="250" class="figure-img"></p>
</figure>
</div>
<p>A continuación aplicamos modelos de aprendizaje basal para cada uno de los ejemplos que hemos ido trabajando.</p>
<p>Podemos acceder a todos los modelos de aprendizaje de cierto tipo con el código siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># Lista de algoritmos de clasificación</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>classif_learners <span class="ot">=</span> mlr_learners<span class="sc">$</span><span class="fu">keys</span>()[<span class="fu">startsWith</span>(mlr_learners<span class="sc">$</span><span class="fu">keys</span>(),<span class="st">"classif"</span>)]</span>
<span id="cb116-3"><a href="#cb116-3"></a>classif_learners</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "classif.abess"            "classif.AdaBoostM1"      
 [3] "classif.bart"             "classif.C50"             
 [5] "classif.cforest"          "classif.ctree"           
 [7] "classif.cv_glmnet"        "classif.debug"           
 [9] "classif.earth"            "classif.featureless"     
[11] "classif.fnn"              "classif.gam"             
[13] "classif.gamboost"         "classif.gausspr"         
[15] "classif.gbm"              "classif.glmboost"        
[17] "classif.glmer"            "classif.glmnet"          
[19] "classif.IBk"              "classif.imbalanced_rfsrc"
[21] "classif.J48"              "classif.JRip"            
[23] "classif.kknn"             "classif.ksvm"            
[25] "classif.lda"              "classif.liblinear"       
[27] "classif.lightgbm"         "classif.LMT"             
[29] "classif.log_reg"          "classif.lssvm"           
[31] "classif.mob"              "classif.multinom"        
[33] "classif.naive_bayes"      "classif.nnet"            
[35] "classif.OneR"             "classif.PART"            
[37] "classif.priority_lasso"   "classif.qda"             
[39] "classif.randomForest"     "classif.ranger"          
[41] "classif.rfsrc"            "classif.rpart"           
[43] "classif.svm"              "classif.xgboost"         </code></pre>
</div>
</div>
<p>y a los hiperparámetros de cada algoritmo con:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># Hiperparámetros para árboles de clasificación</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)<span class="sc">$</span>param_set<span class="sc">$</span><span class="fu">ids</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "cp"             "keep_model"     "maxcompete"     "maxdepth"      
 [5] "maxsurrogate"   "minbucket"      "minsplit"       "surrogatestyle"
 [9] "usesurrogate"   "xval"          </code></pre>
</div>
</div>
<section id="datos-iris-6" class="level5">
<h5 class="anchored" data-anchor-id="datos-iris-6">Datos Iris</h5>
<p>En este caso nos planteamos una tarea de clasificación utilizando el learner <code>"classif.featureless"</code> que es el modelo de aprendizaje basal para tareas de clasificación, que solo analiza las etiquetas durante el entrenamiento, ignorando todas las características. El método de hiperparámetro determina el modo de operación durante la predicción:</p>
<ul>
<li><p>modo: Predice la etiqueta más frecuente. Si hay dos o más etiquetas empatadas, selecciona aleatoriamente una por predicción. Las probabilidades corresponden a la frecuencia relativa de las etiquetas de clase en el conjunto de entrenamiento.</p></li>
<li><p>muestra: Predice aleatoriamente una etiqueta de manera uniforme. Las probabilidades corresponden a una distribución uniforme de etiquetas de clases, es decir, 1 dividido por el número de clases.</p></li>
<li><p>muestra.ponderada: Predice aleatoriamente una etiqueta, con la probabilidad estimada a partir de la distribución de entrenamiento. Para mantener la coherencia, las probabilidades son 1 para la etiqueta muestreada y 0 para todas las demás etiquetas.</p></li>
</ul>
<p>Cargamos el modelo y vemos los metadatos que contiene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># learner</span></span>
<span id="cb120-2"><a href="#cb120-2"></a>learner_iris <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>)</span>
<span id="cb120-3"><a href="#cb120-3"></a><span class="co"># metadatos</span></span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="fu">print</span>(learner_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifFeatureless:classif.featureless&gt;: Featureless Classification Learner
* Model: -
* Parameters: method=mode
* Packages: mlr3
* Predict Types:  [response], prob
* Feature Types: logical, integer, numeric, character, factor, ordered,
  POSIXct
* Properties: featureless, importance, missings, multiclass,
  selected_features, twoclass</code></pre>
</div>
</div>
<p>Podemos ver que:</p>
<ul>
<li><p>El método utilizado es “mode” (<code>Parameters</code>).</p></li>
<li><p>Los tipos de predicción (<code>Predict Types</code>) disponibles son “response” (para obtener la clase predicha) y “prob” (para obtener la probabilidad de cada clase).</p></li>
<li><p>Este modelo nos permite cualquier tipo de variable predictora (<code>Feature Types</code>).</p></li>
</ul>
<p>Comenzamos el proceso de aprendizaje aplicando el modelo sobre la muestra de entrenamiento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>learner_iris<span class="sc">$</span><span class="fu">train</span>(task_iris_train_pp)</span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="co"># Descripción del modelo</span></span>
<span id="cb122-4"><a href="#cb122-4"></a>learner_iris<span class="sc">$</span>model</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$tab

    Iris-setosa Iris-versicolor  Iris-virginica 
             40              40              40 

$features
[1] "petal_length" "petal_width"  "sepal_length" "sepal_width" 

attr(,"class")
[1] "classif.featureless_model"</code></pre>
</div>
</div>
<p>Estudiamos ahora la capacidad de predicción del modelo, es decir, si el modelo es capaz de indicar correctamente la clase de cada una de las muestras a partir del modelo construido. para este proceso utilizamos dos procedimientos:</p>
<ul>
<li><p>La matriz de confusión, que nos proporciona una tabla donde se representan los valores observados frente a los valores predichos por le modelo. Cuanto menores sean los valores fuera de la diagonal de dicha matriz mayor será la capacidad predictiva del modelo.</p></li>
<li><p>Las medidas de valoración o scores. En este caso utilizamos el porcentaje de clasificación correcta (<code>classif.acc</code>), que nos proporciona el porcentaje de muestras clasificadas correctamente, y el error de clasificación (<code>classif.ce</code>), que nos proporciona el porcentaje de observaciones clasificadas incorrectamente. Ambas medidas son complementarias y cuando mayor es el porcentaje de clasificación correcta mejor es la capacidad predictiva del modelo.</p></li>
</ul>
<p>Para valorar el modelo es necesario extraer en primer lugar la predicción tanto de la muestra de entrenamiento como de validación para el modelo considerado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># Predicción de la muestra de entrenamiento</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>pred_train <span class="ot">=</span> learner_iris<span class="sc">$</span><span class="fu">predict</span>(task_iris_train_pp)</span>
<span id="cb124-3"><a href="#cb124-3"></a><span class="co"># Predicción de la muestra de validación</span></span>
<span id="cb124-4"><a href="#cb124-4"></a>pred_test <span class="ot">=</span> learner_iris<span class="sc">$</span><span class="fu">predict</span>(task_iris_test_pp)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Obtenemos la matriz de confusión para los datos de validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># Matriz de confusión para la muestra de validación</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>pred_test<span class="sc">$</span>confusion</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 truth
response          Iris-setosa Iris-versicolor Iris-virginica
  Iris-setosa               4               2              5
  Iris-versicolor           0               5              2
  Iris-virginica            6               3              3</code></pre>
</div>
</div>
<p>Claramente se puede ver que el modelo de clasificación basal considerado no funciona muy bien dado que los valores obtenidos fuera de la diagonal son muy elevados. Valoramos ahora los porcentajes de clasificación correcta y de error asociados con la matriz de confusión. Para ello es necesario definir en primer lugar la medidas que vamos a utilizar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># Definimos los scores de validación. En este caso utilizamos la función msrs ya que utilizamos múltiples scores. </span></span>
<span id="cb127-2"><a href="#cb127-2"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">'classif.acc'</span>, <span class="st">'classif.ce'</span>))</span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="co"># Evaluamos los scores en la muestra de entrenamiento</span></span>
<span id="cb127-4"><a href="#cb127-4"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc  classif.ce 
  0.3666667   0.6333333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># Evaluamos los scores en la muestra de validación</span></span>
<span id="cb129-2"><a href="#cb129-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc  classif.ce 
        0.4         0.6 </code></pre>
</div>
</div>
<p>Podemos ver como el porcentaje de clasificación correcta pasa del 28.3% para la muestra de entrenamiento al 20% para la muestra de test. Por supuesto el modelo tiene un poder de clasificación muy bajo como corresponde con un modelo basal que no tiene en cuenta las características o posibles predictoras de la muestras para dicho este conjunto de datos. De hecho ya habíamos visto antes que las predictoras relacionadas tanto con la longitud como la anchura de pétalo.</p>
<p>A pesar de que todavía no hemos presentado los aspectos teóricos de otros algoritmos de clasificación vamos a utilizar uno de ellos para comparar los resultados de clasificación. En concreto utilizamos <code>classif.rpart</code> que nos proporciona los árboles de clasificación. más adelante entraremos en el detalle de este algoritmo. Comenzamos estableciendo el modelo de aprendizaje:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="co"># Librerías gráficas para modelos de árboles</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="fu">library</span>(partykit)</span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="fu">library</span>(ggparty)</span>
<span id="cb131-4"><a href="#cb131-4"></a><span class="co"># learner</span></span>
<span id="cb131-5"><a href="#cb131-5"></a>learner2_iris <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">keep_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb131-6"><a href="#cb131-6"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb131-7"><a href="#cb131-7"></a>learner2_iris<span class="sc">$</span><span class="fu">train</span>(task_iris_train_pp)</span>
<span id="cb131-8"><a href="#cb131-8"></a><span class="co"># Solución gráfica del modelo</span></span>
<span id="cb131-9"><a href="#cb131-9"></a><span class="fu">autoplot</span>(learner2_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="50_AED_files/figure-html/aed-071-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Autoplot algoritmo aprendizaje datos Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Los modelos de árbol producen grupos donde se organizan las observaciones de acurdo al modelo construido. En este caso tenemos como resultado tres grupos. Podemos ver también cuales son las variables más relevantes en el proceso de clasificación, que en este caso se corresponde únicamente con la longitud de pétalo. Como resultado tenemos que en el último grupo podemos ver como se mezclan observaciones tanto de iris versicolor como iris virginica. Veamos los resultados de la clasificación para este modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># Predicción de la muestra de entrenamiento</span></span>
<span id="cb132-2"><a href="#cb132-2"></a>pred_train <span class="ot">=</span> learner2_iris<span class="sc">$</span><span class="fu">predict</span>(task_iris_train_pp)</span>
<span id="cb132-3"><a href="#cb132-3"></a><span class="co"># Predicción de la muestra de validación</span></span>
<span id="cb132-4"><a href="#cb132-4"></a>pred_test <span class="ot">=</span> learner2_iris<span class="sc">$</span><span class="fu">predict</span>(task_iris_test_pp)</span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="co"># Evaluamos los scores en la muestra de entrenamiento</span></span>
<span id="cb132-6"><a href="#cb132-6"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc  classif.ce 
 0.96666667  0.03333333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># Evaluamos los scores en la muestra de validación</span></span>
<span id="cb134-2"><a href="#cb134-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc  classif.ce 
  0.8333333   0.1666667 </code></pre>
</div>
</div>
<p>Podemos ver que el porcentaje de clasificación correcta es del 96.67% para la muestra de entrenamiento y del 83.33% para la muestra de validación. Dado que entrenamos el modelo con los mismos datos con los que lo hemos construido es esperable que el porcentaje para el entrenamiento sea superior que en la validación. También podemos ver como mejoramos ostensiblemente los resultados frente al modelo basal que no consideraba ninguna predictora. De hecho el modelo obtenido es bastante bueno al alcanzar un porcentaje de clasificación correcta bastante alto para la muestra de validación. Por último vemos la matriz de confusión asociada:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># Matriz de confusión para la muestra de validación</span></span>
<span id="cb136-2"><a href="#cb136-2"></a>pred_test<span class="sc">$</span>confusion</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 truth
response          Iris-setosa Iris-versicolor Iris-virginica
  Iris-setosa              10               0              0
  Iris-versicolor           0               6              1
  Iris-virginica            0               4              9</code></pre>
</div>
</div>
<p>Para la muestra de validación tenemos una clasificación perfecta en las iris-setosa, y casi perfecta en las iris versicolor. La clasificación de las iris virginica es la que peor funciona, con un mayor error de clasificación (4/13 = 30.7%).</p>
</section>
<section id="datos-penguins-6" class="level5">
<h5 class="anchored" data-anchor-id="datos-penguins-6">Datos Penguins</h5>
<p>En este conjunto de datos estamos interesados en predecir la característica numérica <code>flipper_length</code> en función del conjunto de predictoras, de forma que nos enfrentamos a un problema de regresión. Utilizamos de nuevo un modelo basal para mostrar el proceso de aprendizaje: <code>regr.featureless</code>. Se trata de un modelo simple que solo analiza la respuesta durante el entrenamiento, ignorando todas las predictoras Si el hiperparámetro robusto es FALSO (predeterminado), predice constantemente la <code>media(y)</code> como respuesta y <code>sd(y)</code> como error estándar. Si robusto es VERDADERO, se utilizan <code>mediana(y)</code> y <code>mad(y)</code> en su lugar respectivamente.</p>
<p>Los metadatos y el proceso de aprendizaje de este tipo de modelos es similar al de los modelos de clasificación. Comenzamos definiendo el modelo de aprendizaje:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co"># learner</span></span>
<span id="cb138-2"><a href="#cb138-2"></a>learner_penguins <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.featureless"</span>)</span>
<span id="cb138-3"><a href="#cb138-3"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb138-4"><a href="#cb138-4"></a>learner_penguins<span class="sc">$</span><span class="fu">train</span>(task_penguins_train_pp)</span>
<span id="cb138-5"><a href="#cb138-5"></a><span class="co"># Descripción del modelo</span></span>
<span id="cb138-6"><a href="#cb138-6"></a>learner_penguins<span class="sc">$</span>model</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$location
[1] 200.3459

$dispersion
[1] 13.94385

$features
 [1] "bill_depth_mm"     "bill_length_mm"    "body_mass_g"      
 [4] "island.Biscoe"     "island.Dream"      "island.Torgersen" 
 [7] "sex.female"        "sex.male"          "species.Adelie"   
[10] "species.Chinstrap" "species.Gentoo"   

attr(,"class")
[1] "regr.featureless_model"</code></pre>
</div>
</div>
<p>El modelo proporciona una estimación de 200.34 para la variable de interés con una dispersión de 13.94. Aunque en temas posteriores estudiaremos con detalle le proceso de validación de los modelos de regresión, es este apartado vamos a realizar una pequeña aproximación a los aspectos fundamentales. Los procesos de validación más sencillos pasan por:</p>
<ul>
<li>Valoración numérica, donde utilizamos criterios como el <span class="math inline">\(R^2\)</span>, <span class="math inline">\(MSE\)</span> o <span class="math inline">\(MAPE\)</span> para valorar la capacidad predictiva del modelo.</li>
<li>Valoración gráfica, donde se representan las predicciones del modelo frente a los valores observados realmente para ver lo cerca que están las predicciones de nuestro modelo frente a los valores reales.</li>
</ul>
<p>Para poder realizar dichas valoraciones debemos obtener en primer lugar las predicciones de nuestro modelo tanto en la muestra de entrenamiento como de validación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="co"># Predicción de la muestra de entrenamiento</span></span>
<span id="cb140-2"><a href="#cb140-2"></a>pred_train <span class="ot">=</span> learner_penguins<span class="sc">$</span><span class="fu">predict</span>(task_penguins_train_pp)</span>
<span id="cb140-3"><a href="#cb140-3"></a><span class="co"># Predicción de la muestra de validación</span></span>
<span id="cb140-4"><a href="#cb140-4"></a>pred_test <span class="ot">=</span> learner_penguins<span class="sc">$</span><span class="fu">predict</span>(task_penguins_test_pp)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Definimos ahora el conjunto de medidas numéricas que vamos a utilizar para valorar nuestro modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># Definimos los scores de validación.</span></span>
<span id="cb141-2"><a href="#cb141-2"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">'regr.rsq'</span>, <span class="st">'regr.mse'</span>, <span class="st">'regr.mape'</span>))</span>
<span id="cb141-3"><a href="#cb141-3"></a><span class="co"># Evaluamos los scores en la muestra de entrenamiento</span></span>
<span id="cb141-4"><a href="#cb141-4"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    regr.rsq     regr.mse    regr.mape 
  0.00000000 193.69992651   0.05955929 </code></pre>
</div>
</div>
<p>Los scores de valoración proporcionan valores muy bajos para el <span class="math inline">\(R^2\)</span> y muy altos para el <span class="math inline">\(MSE\)</span> y <span class="math inline">\(MAPE\)</span> indicando que el moldeo basal propuesto es bastante deficiente, como era de esperar. Veamos que ocurre con la muestra de validación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="co"># Evaluamos los scores en la muestra de entrenamiento</span></span>
<span id="cb143-2"><a href="#cb143-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    regr.rsq     regr.mse    regr.mape 
 -0.04842593 206.31219334   0.06021553 </code></pre>
</div>
</div>
<p>Podemos ver como los resultados empeoran con la muestra de validación. Analizamos ahora la solución gráfica del modelo propuesto. Para ello tenemos dos gráficos:</p>
<ul>
<li>valores predichos frente a valores observados. Si el moldeo es adecuado la nube de puntos debería situarse sobre la diagonal del gráfico. En otro caso el modelo tiene poco poder predictivo.</li>
<li>Residuos del modelo (predicción menos valor observado) frente a cada una de las muestras. En este caso la nube de puntos debería ser dispersa sin ningún tipo de tendencia</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="co"># Representación gráfica de observados frente a predichos</span></span>
<span id="cb145-3"><a href="#cb145-3"></a><span class="fu">ggplot</span>(pred_train, <span class="fu">aes</span>(<span class="at">x =</span> truth, <span class="at">y =</span> response)) <span class="sc">+</span></span>
<span id="cb145-4"><a href="#cb145-4"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb145-5"><a href="#cb145-5"></a>       <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb145-6"><a href="#cb145-6"></a>       <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Valor predicho vs valor real"</span>) <span class="sc">+</span></span>
<span id="cb145-7"><a href="#cb145-7"></a>       <span class="fu">theme_bw</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-078" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-078-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.30: Valores reales vs predichos. Modelo Penguins.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Como se puede ver el modelo es bastante malo ya que predice todas las observaciones con un único valor. Veamos ahora el gráfico de residuos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="co"># Representación ids vs errores</span></span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="fu">ggplot</span>(pred_train, <span class="fu">aes</span>(<span class="at">x =</span> row_ids, <span class="at">y =</span> response <span class="sc">-</span> truth)) <span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span>  <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb146-5"><a href="#cb146-5"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos del modelo"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-079" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-079-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.31: Residuos. Modelo Penguins.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>De nuevo podemos ver que el modelo es bastante malo, ya que los residuos observados no tiene un comportamiento aleatorio. De hecho, se aprecia cierta tendencia en el comportamiento de los residuos.</p>
<p>Como hicimos con la tarea de clasificación vamos a proponer un modelo de regresión más avanzado para mostrar la mejora con respecto al modelo basal. En concreto utilizamos el algoritmo del modelo de regresión lineal que es accesible con el learner <code>regr.lm</code>. Comenzamos definiendo el proceso de aprendizaje.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># learner</span></span>
<span id="cb147-2"><a href="#cb147-2"></a>learner2_penguins <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.lm"</span>)</span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb147-4"><a href="#cb147-4"></a>learner2_penguins<span class="sc">$</span><span class="fu">train</span>(task_penguins_train_pp)</span>
<span id="cb147-5"><a href="#cb147-5"></a><span class="co"># Descripción del modelo</span></span>
<span id="cb147-6"><a href="#cb147-6"></a>learner2_penguins<span class="sc">$</span>model</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::lm(formula = task$formula(), data = task$data())

Coefficients:
      (Intercept)      bill_depth_mm     bill_length_mm        body_mass_g  
          214.917              1.561              2.675              4.040  
    island.Biscoe       island.Dream   island.Torgersen         sex.female  
           -1.955             -1.114                 NA             -0.214  
         sex.male     species.Adelie  species.Chinstrap     species.Gentoo  
               NA            -19.839            -18.703                 NA  </code></pre>
</div>
</div>
<p>En este caso el algoritmo de aprendizaje nos proporcionan los coeficientes del modelo (los estudiaremos más adelante). Utilizando los filtros de características podemos establecer una primer valoración de las variables más relevantes para el modelo planteado. En este caso utilizamos <code>correlation</code> como medida para dicha valoración. El listado completo de filtro se pueden consultar en este <a href="https://mlr-org.com/filters.html">enlace</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="co"># Construimos el objeto que define el filtro</span></span>
<span id="cb149-2"><a href="#cb149-2"></a>filter <span class="ot">=</span> <span class="fu">flt</span>(<span class="st">"correlation"</span>)</span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="co"># Aplicamos el filtro sobre los datos de entrenamiento</span></span>
<span id="cb149-4"><a href="#cb149-4"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task_penguins_train_pp)</span>
<span id="cb149-5"><a href="#cb149-5"></a><span class="co"># Vemos los resultados</span></span>
<span id="cb149-6"><a href="#cb149-6"></a>filter</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FilterCorrelation:correlation&gt;: Correlation
Task Types: regr
Properties: missings
Task Properties: -
Packages: stats
Feature types: integer, numeric
              feature     score
 1:       body_mass_g 0.8755042
 2:    species.Gentoo 0.8705125
 3:    species.Adelie 0.6986344
 4:    bill_length_mm 0.6816958
 5:     island.Biscoe 0.5913543
 6:     bill_depth_mm 0.5495039
 7:      island.Dream 0.4180206
 8:        sex.female 0.2782721
 9:          sex.male 0.2782721
10:  island.Torgersen 0.2640905
11: species.Chinstrap 0.1473346</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="co"># o los representamos gráficamente</span></span>
<span id="cb151-2"><a href="#cb151-2"></a><span class="fu">autoplot</span>(filter)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="50_AED_files/figure-html/aed-081-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Filtro de correlación. Datos penguins</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>El modelo indica que la variable más relevante para obtener la predicción de la respuesta es <code>body_mass_g</code> seguida de las variables codificadas que identifican las especies <code>Gentoo</code> y <code>Adelie</code>. La isla y el sexo el pingüino parecen estar menos relacionados con la respuesta.</p>
<p>Valoramos ahora la capacidad predictiva de este nuevo modelo utilizando los mismos scores que en el modelo anterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="co"># Predicción de la muestra de entrenamiento</span></span>
<span id="cb152-2"><a href="#cb152-2"></a>pred_train <span class="ot">=</span> learner2_penguins<span class="sc">$</span><span class="fu">predict</span>(task_penguins_train_pp)</span>
<span id="cb152-3"><a href="#cb152-3"></a><span class="co"># Predicción de la muestra de validación</span></span>
<span id="cb152-4"><a href="#cb152-4"></a>pred_test <span class="ot">=</span> learner2_penguins<span class="sc">$</span><span class="fu">predict</span>(task_penguins_test_pp)</span>
<span id="cb152-5"><a href="#cb152-5"></a><span class="co"># Evaluamos los scores en la muestra de entrenamiento</span></span>
<span id="cb152-6"><a href="#cb152-6"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   regr.rsq    regr.mse   regr.mape 
 0.87724404 23.77781960  0.01885683 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a><span class="co"># Evaluamos los scores en la muestra de validación</span></span>
<span id="cb154-2"><a href="#cb154-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   regr.rsq    regr.mse   regr.mape 
 0.81102066 37.18788329  0.02339544 </code></pre>
</div>
</div>
<p>Claramente este modelo mejora el anterior. Aumentamos claramente el valor de <span class="math inline">\(R^2\)</span> y reducimos las medidas del error. Como siempre los valores para la muestra de validación son algo peores que los de la muestra de entrenamiento. El valor de <span class="math inline">\(R^2\)</span> del 81.1% indica que las variables predictoras contribuyen a explicar un 81% de la variabilidad de la respuesta lo que es un valor bastante alto. Veamos ahora la solución gráfica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="co"># Representación gráfica de observados frente a predichos</span></span>
<span id="cb156-3"><a href="#cb156-3"></a>g1 <span class="ot">=</span> <span class="fu">ggplot</span>(pred_train, <span class="fu">aes</span>(<span class="at">x =</span> truth, <span class="at">y =</span> response)) <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb156-5"><a href="#cb156-5"></a>       <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb156-6"><a href="#cb156-6"></a>       <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Valor predicho vs valor real"</span>) <span class="sc">+</span></span>
<span id="cb156-7"><a href="#cb156-7"></a>       <span class="fu">theme_bw</span>()</span>
<span id="cb156-8"><a href="#cb156-8"></a><span class="co"># Representación ids vs errores</span></span>
<span id="cb156-9"><a href="#cb156-9"></a>g2 <span class="ot">=</span> <span class="fu">ggplot</span>(pred_train, <span class="fu">aes</span>(<span class="at">x =</span> row_ids, <span class="at">y =</span> response <span class="sc">-</span> truth)) <span class="sc">+</span></span>
<span id="cb156-10"><a href="#cb156-10"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb156-11"><a href="#cb156-11"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span>  <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb156-12"><a href="#cb156-12"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuos del modelo"</span>)</span>
<span id="cb156-13"><a href="#cb156-13"></a><span class="fu">ggarrange</span>(g1,g2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-083" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-083-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.32: Análisis gráfico del modelo. Datos Penguins.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Se puede ver gráficamente como el modelo plateado tiene un comportamiento mucho mejor que el basal para predecir el comportamiento de la respuesta. En el caso de los residuos observamos un comportamiento bastante aleatorio sin ningún tipo de tendencia.</p>
</section>
</section>
<section id="sec-validation" class="level4" data-number="5.2.2.5">
<h4 data-number="5.2.2.5" class="anchored" data-anchor-id="sec-validation"><span class="header-section-number">5.2.2.5</span> Validación</h4>
<p>La finalidad última de un modelo es predecir la variable respuesta en observaciones futuras o en observaciones que el modelo no ha “visto” antes. El error mostrado por defecto tras entrenar un modelo suele ser el error de entrenamiento, el error que comete el modelo al predecir las observaciones que ya ha “visto”. Si estos errores son útiles para entender cómo está aprendiendo el modelo (estudio de residuos), no es una estimación realista de cómo se comporta el modelo ante nuevas observaciones (el error de entrenamiento suele ser demasiado optimista). Para conseguir una estimación más certera, y antes de recurrir al conjunto de test, se pueden emplear estrategias de validación basadas en resampling o remuestreo.</p>
<p>Las estrategias de remuestreo dividen repetidamente todos los datos disponibles en múltiples conjuntos de entrenamiento y prueba, y una repetición corresponde a lo que se llama una “iteración de remuestreo” en mlr3. Luego se entrena un modelo intermedio en cada conjunto de entrenamiento y el conjunto de prueba se utiliza para medir el rendimiento en cada iteración de remuestreo. El rendimiento de la generalización finalmente se estima agregando las puntuaciones de rendimiento en múltiples iteraciones de remuestreo (ver figura siguiente). Al repetir el proceso de división de datos, los datos se utilizan repetidamente tanto para el entrenamiento como para las pruebas, lo que permite un uso más eficiente de todos los datos disponibles para la evaluación del modelo en referencia a su capacidad predictiva. Además, una gran cantidad de iteraciones de remuestreo puede reducir la varianza en nuestras medidas de evaluación (scores) y, por lo tanto, dar como resultado una estimación más confiable. Esto significa que es menos probable que la evaluación del modelo de aprendizaje se vea afectada por una única división “desafortunada”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://raw.githubusercontent.com/ia4legos/MachineLearning/main/images/resampling01.png" width="650" height="400" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Esquema de resampling para un modelo de AA</figcaption><p></p>
</figure>
</div>
<p>Existe una variedad de estrategias de remuestreo, cada una con sus ventajas y desventajas, que dependen del número de muestras disponibles, la complejidad de la tarea y el tipo de modelo.</p>
<p>Una estrategia muy común es la validación cruzada (CV) k veces, que divide aleatoriamente los datos en subconjuntos que no se superponen, llamados pliegues o folds. En la imagen siguiente podemos ver el esquema de remuestreo con k=3.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://raw.githubusercontent.com/ia4legos/MachineLearning/main/images/resampling02.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Remuestreo 3-fold</figcaption><p></p>
</figure>
</div>
<p>En esta situación los modelos siempre son entrenados en cada fold, utilizándose el fold restante como datos de validación, repitiendo este proceso hasta que cada fold haya actuado exactamente una vez como conjunto de validación. Finalmente, lo scores de cada fold se agregan, generalmente mediante un promedio, para dar un score global del modelo. La validación cruzada garantiza que cada observación se utilizará exactamente una vez en un conjunto de validación, haciendo un uso eficiente de los datos disponibles para la valoración de la capacidad predictora del modelo. Valores comunes para k son 5 y 10, lo que significa que cada conjunto de entrenamiento constará de 4/5 o 9/10 de los datos originales, respectivamente. Existen varias variaciones de CV, incluida la validación cruzada repetida de k veces, donde el proceso de k veces se repite varias veces, y la validación cruzada de dejar uno fuera (LOO-CV), donde el número de fold es igual al número de observaciones, lo que lleva al conjunto de pruebas en cada fold que consta de una sola observación.</p>
<p>El submuestreo y el bootstrapping son dos estrategias de remuestreo relacionadas. El submuestreo selecciona aleatoriamente una proporción determinada (4/5 y 9/10 son comunes) de los datos para el conjunto de datos de entrenamiento donde cada observación en el conjunto de datos se extrae sin reemplazo del conjunto de datos original. El modelo se entrena con estos datos y luego se prueba con los datos restantes, y este proceso se repite k veces. Bootstrapping sigue el mismo proceso que el submuestreo, pero los datos se extraen y se reemplazan del conjunto de datos original. Por lo general, el número de muestras de bootstrapping es igual al tamaño del conjunto de datos original. Esto significa que una observación podría seleccionarse varias veces (y, por lo tanto, duplicarse) en los datos de entrenamiento (pero nunca más de una vez por conjunto de datos de validación). De media, el 63.2% de los datos estarán contenidos en el conjunto de entrenamiento durante el bootstrapping, denominados muestras “in-bag” (el otro 36,8% se conocen como muestras “out-of-bag”).</p>
<p>Hay que tener en cuenta que la terminología relativa a las estrategias de remuestreo no es consistente en toda la literatura; por ejemplo, el submuestreo a veces se denomina “repeat holdout” o “Monte Carlo cross-validation”.</p>
<p>La elección de la estrategia de remuestreo generalmente depende de la tarea específica en cuestión y de los objetivos de la evaluación del desempeño, pero existen algunas reglas generales. Si los datos disponibles son bastante pequeños ($N \leq 500$), se puede utilizar una validación cruzada repetida con una gran cantidad de repeticiones para mantener baja la varianza de los scores de evaluación (10 folds y 10 repeticiones es un buen lugar para comenzar). Tradicionalmente, también se ha recomendado LOO-CV para estos regímenes de tamaño de muestra pequeño, pero este esquema de estimación es bastante costoso (excepto en casos especiales donde existen atajos computacionales) y sufre de una varianza bastante alta. Además, LOO-CV también es problemático en tareas de clasificación binaria desequilibradas, ya que no se pueden aplicar conceptos como la estratificación. Para tamaños $500 \leq N \leq 50000$ se recomienda un CV de 5 a 10 veces mayor. En general, cuanto mayor es el conjunto de datos, menos divisiones se requieren; sin embargo, aún pueden ocurrir problemas con el tamaño de la muestra, por ejemplo, debido a datos desequilibrados.</p>
<p>El paquete <code>mlr3</code> incorpora las siguientes estrategias: <em>Bootstrap</em> (<code>mlr_resamplings_bootstrap</code>), <em>V-Fold Cross-Validation</em> (<code>mlr_resamplings_cv</code>), <em>Repeated V-Fold Cross-Validation</em> (<code>mlr_resamplings_repeated_cv</code>) y <em>Monte Carlo Cross-Validation</em> (<code>mlr_resamplings_subsampling</code>). Para crear un objeto de remuestreo utilizamos la función <code>rsmp().</code> En la tabla siguiente se muestran todos los métodos de remuestreo disponibles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="fu">as.data.table</span>(mlr_resamplings)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           key                         label        params iters
1:   bootstrap                     Bootstrap ratio,repeats    30
2:      custom                 Custom Splits                  NA
3:   custom_cv Custom Split Cross-Validation                  NA
4:          cv              Cross-Validation         folds    10
5:     holdout                       Holdout         ratio     1
6:    insample           Insample Resampling                   1
7:         loo                 Leave-One-Out                  NA
8: repeated_cv     Repeated Cross-Validation folds,repeats   100
9: subsampling                   Subsampling ratio,repeats    30</code></pre>
</div>
</div>
<p>A continuación se muestran diferentes ejemplos de estrategias de validación cruzada:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="co"># three-fold CV</span></span>
<span id="cb159-2"><a href="#cb159-2"></a>cv3 <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">3</span>)</span>
<span id="cb159-3"><a href="#cb159-3"></a><span class="co"># Subsampling with 3 repeats and 9/10 ratio</span></span>
<span id="cb159-4"><a href="#cb159-4"></a>ss390 <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"subsampling"</span>, <span class="at">repeats =</span> <span class="dv">3</span>, <span class="at">ratio =</span> <span class="fl">0.9</span>)</span>
<span id="cb159-5"><a href="#cb159-5"></a><span class="co"># 2-repeats 5-fold CV</span></span>
<span id="cb159-6"><a href="#cb159-6"></a>rcv25 <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"repeated_cv"</span>, <span class="at">repeats =</span> <span class="dv">2</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>un aspecto a tener muy en cuenta es que las tareas de preprocesado del banco de datos deben estar incluidas dentro de cada iteración del remuestreo. Para realizar esta tarea se emplea el objeto <code>GraphLearner</code>, que permite combinar un <code>mlr3pipeline</code> de preprocesado con un <code>learner</code>. Una vez creado el objeto <code>GraphLearner</code>, este puede emplearse para como si de un learner se tratase (entrenamiento, predicción, validación…).</p>
<p>En las subsecciones siguientes vemos como funcionan los métodos de remuestreo sobre los bancos de datos que hemos venido trabajando. Para mostrar resultados razonables vamos a utilizar los modelos de aprendizaje más avanzados que presentamos en el punto anterior. Se ajusta de nuevo el modelo, esta vez con validación cruzada repetida para estimar su error. En primer lugar, se crea un objeto Resampling en el que se define el tipo de validación y el número de repeticiones. Con la función <code>resample()</code> se combinan un task, un learner y la estrategia de Resampling. De esta forma el modelo se ajusta y evalúa con cada una de las particiones de forma automática, calculando y almacenando en cada iteración la métrica o score de interés.</p>
<section id="datos-iris-7" class="level5">
<h5 class="anchored" data-anchor-id="datos-iris-7">Datos Iris</h5>
<p>Comenzamos con los datos iris para la tarea de clasificación de flores. En primer lugar definimos el objeto de remuestreo. En este caso consideramos la validación cruzada k-fold con <span class="math inline">\(k = 5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb160-2"><a href="#cb160-2"></a>resampling_cv <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb160-3"><a href="#cb160-3"></a>resampling_cv</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ResamplingCV&gt;: Cross-Validation
* Iterations: 5
* Instantiated: FALSE
* Parameters: folds=5</code></pre>
</div>
</div>
<p>Definimos la métrica que vamos a utilizar, que en este caso es el porcentaje de clasificación correcta para cada fold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a>metrica <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generamos el objeto <code>GraphLearner</code> uniendo el objeto de preprocesado y el algoritmo de aprendizaje automático.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a><span class="co"># Unión pipeline procesado y learner</span></span>
<span id="cb163-2"><a href="#cb163-2"></a>graph <span class="ot">=</span> pp_iris <span class="sc">%&gt;&gt;%</span> learner2_iris</span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="co"># Representamos el proceso de aprendizaje</span></span>
<span id="cb163-4"><a href="#cb163-4"></a>graph<span class="sc">$</span><span class="fu">plot</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="50_AED_files/figure-html/aed-088-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="co"># Generamos el modelo de aprendizaje </span></span>
<span id="cb164-2"><a href="#cb164-2"></a>graph_learner <span class="ot">&lt;-</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(graph)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos definir ahora el objeto de remuestreo a partir del modelo de aprendizaje y de los datos originales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb165-2"><a href="#cb165-2"></a>rr <span class="ot">=</span> <span class="fu">resample</span>(task_iris, graph_learner, resampling_cv, <span class="at">store_models=</span><span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:50:01.803] [mlr3] Applying learner 'scale.classif.rpart' on task 'data_iris' (iter 1/5)
INFO  [17:50:01.960] [mlr3] Applying learner 'scale.classif.rpart' on task 'data_iris' (iter 2/5)
INFO  [17:50:02.177] [mlr3] Applying learner 'scale.classif.rpart' on task 'data_iris' (iter 3/5)
INFO  [17:50:02.313] [mlr3] Applying learner 'scale.classif.rpart' on task 'data_iris' (iter 4/5)
INFO  [17:50:02.433] [mlr3] Applying learner 'scale.classif.rpart' on task 'data_iris' (iter 5/5)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>rr</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ResampleResult&gt; with 5 resampling iterations
   task_id          learner_id resampling_id iteration warnings errors
 data_iris scale.classif.rpart            cv         1        0      0
 data_iris scale.classif.rpart            cv         2        0      0
 data_iris scale.classif.rpart            cv         3        0      0
 data_iris scale.classif.rpart            cv         4        0      0
 data_iris scale.classif.rpart            cv         5        0      0</code></pre>
</div>
</div>
<p>Cada fila de la tabla anterior corresponde con una de las iteraciones de la estrategia de remuestreo considerada. Ahora podemos obtener la información correspondiente a cada uno de los remuestreos, y más concretamente el score asociado con cada una de ellas para la muestra de validación correspondiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb169-2"><a href="#cb169-2"></a>acc <span class="ot">=</span> rr<span class="sc">$</span><span class="fu">score</span>(metrica)</span>
<span id="cb169-3"><a href="#cb169-3"></a>acc[, .(iteration, classif.acc)]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   iteration classif.acc
1:         1   0.9333333
2:         2   0.9666667
3:         3   0.9000000
4:         4   0.9333333
5:         5   1.0000000</code></pre>
</div>
</div>
<p>Podemos ver que en todas las iteraciones el porcentaje de clasificación correcta es superior al 90%. De hecho se observa una gran estabilidad en los resultados independientemente de la iteración. Obtenemos ahora el valor agregado para las cinco iteraciones para dar una medida global del porcentaje de clasificación correcta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="co"># valor agregado</span></span>
<span id="cb171-2"><a href="#cb171-2"></a>rr<span class="sc">$</span><span class="fu">aggregate</span>(metrica)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.9466667 </code></pre>
</div>
</div>
<p>El valor agregado del porcentaje de clasificación correcta se sitúa casi en el 95% indicando que le modelo clasifica muy bien los diferentes tipos de flores.</p>
<p>Continuando con el análisis individual de cada fold vamos a representar gráficamente la matriz de confusión asociada a cada uno de ellos. Para ello necesitamos instalar la librería <code>cvms</code> y definir una pequeña función que tome los datos de un fold específico y nos permita representar gráficamente la matriz de confusión.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a><span class="co"># Cargamos la librería para representar la matriz de confusión</span></span>
<span id="cb173-2"><a href="#cb173-2"></a><span class="fu">library</span>(cvms)</span>
<span id="cb173-3"><a href="#cb173-3"></a><span class="co"># Definimos la función necesaria para la representación gráfica</span></span>
<span id="cb173-4"><a href="#cb173-4"></a>cm_plot_resampling <span class="ot">=</span> <span class="cf">function</span>(data)</span>
<span id="cb173-5"><a href="#cb173-5"></a>{</span>
<span id="cb173-6"><a href="#cb173-6"></a>  cm <span class="ot">=</span> <span class="fu">confusion_matrix</span>(data<span class="sc">$</span>truth, data<span class="sc">$</span>response)</span>
<span id="cb173-7"><a href="#cb173-7"></a>   <span class="fu">plot_confusion_matrix</span>(cm<span class="sc">$</span><span class="st">`</span><span class="at">Confusion Matrix</span><span class="st">`</span>[[<span class="dv">1</span>]]) </span>
<span id="cb173-8"><a href="#cb173-8"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Representamos ahora la matriz de confusión para un fold específico. En este caso tomamos el fold 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="co"># Plot para cada fold</span></span>
<span id="cb174-2"><a href="#cb174-2"></a><span class="fu">cm_plot_resampling</span>(rr<span class="sc">$</span><span class="fu">predictions</span>()[[<span class="dv">2</span>]])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aed-093" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="50_AED_files/figure-html/fig-aed-093-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;5.33: Matriz de confusión para el el remuestreo. Datos Iris.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>El gráfico proporciona los conteos de cada combinación y diferentes porcentajes que pasamos a explicar. Para la combinación Iris-virginica vs Iris-virginica tenemos que:</p>
<ul>
<li>Hay 9 casos en la combinación y los clasificamos todos correctamente.</li>
<li>El porcentaje de casos dentro de esta combinación frente al total de casos evaluados es del 30% (porcentaje central).</li>
<li>Tenemos un porcentaje marginal por columnas de clasificación correcta del 90% (porcentaje pequeño en horizontal) indicando que todas de las flores iris-virgnica originales son clasificadas correctamente el 90% con nuestro modelo.</li>
<li>Tenemos un porcentaje marginal por filas del 100% indicando que todas las predicciones como Iris virginica que proporciona nuestro modelo son originalmente Iris virginica.</li>
<li>Si sumamos todos los porcentajes centrales tendríamos el porcentaje global de clasificación correcta para este fold. En este caso es del 30 + 33.3 + 33.3 = 96.6%.</li>
</ul>
</section>
<section id="datos-penguins-7" class="level5">
<h5 class="anchored" data-anchor-id="datos-penguins-7">Datos Penguins</h5>
<p>Proponemos ahora un método de resampling para el banco de datos penguins. Como en el caso anterior definimos el proceso de resampling, la métrica que utilizaremos y el <code>graphlearner</code> que combina el preprocesado con le moldeo de aprendizaje utilizado.</p>
<p>Comenzamos con el proceso de remuestreo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb175-2"><a href="#cb175-2"></a>resampling_cv <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb175-3"><a href="#cb175-3"></a>resampling_cv</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ResamplingCV&gt;: Cross-Validation
* Iterations: 5
* Instantiated: FALSE
* Parameters: folds=5</code></pre>
</div>
</div>
<p>Ahora la métrica a utilizar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a>metrica <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.mse"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recargamos el objeto de preprocesado para este banco de datos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a>pp_penguins <span class="ot">=</span> </span>
<span id="cb178-2"><a href="#cb178-2"></a>   <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb178-3"><a href="#cb178-3"></a>   <span class="fu">po</span>(<span class="st">"imputemedian"</span>, <span class="at">affect_columns =</span> <span class="fu">selector_type</span>(<span class="st">"numeric"</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4"></a>   <span class="fu">po</span>(<span class="st">"imputeoor"</span>, <span class="at">affect_columns =</span> <span class="fu">selector_type</span>(<span class="st">"factor"</span>)) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb178-5"><a href="#cb178-5"></a>   <span class="fu">po</span>(<span class="st">"encode"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"one-hot"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Definimos el <code>Grpahlearner</code> asociado a este modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="co"># Unión pipeline procesado y learner</span></span>
<span id="cb179-2"><a href="#cb179-2"></a>graph <span class="ot">=</span> pp_penguins <span class="sc">%&gt;&gt;%</span> learner2_penguins</span>
<span id="cb179-3"><a href="#cb179-3"></a><span class="co"># Representamos el proceso de aprendizaje</span></span>
<span id="cb179-4"><a href="#cb179-4"></a>graph<span class="sc">$</span><span class="fu">plot</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="50_AED_files/figure-html/aed-097-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="co"># Generamos el modelo de aprendizaje </span></span>
<span id="cb180-2"><a href="#cb180-2"></a>graph_learner <span class="ot">&lt;-</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(graph)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos definir ahora el objeto de remuestreo a partir del modelo de aprendizaje y de los datos originales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb181-2"><a href="#cb181-2"></a>rr <span class="ot">=</span> <span class="fu">resample</span>(task_penguins, graph_learner, resampling_cv, <span class="at">store_models=</span><span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:50:03.883] [mlr3] Applying learner 'scale.imputemedian.imputeoor.encode.regr.lm' on task 'data_penguins' (iter 1/5)
INFO  [17:50:04.263] [mlr3] Applying learner 'scale.imputemedian.imputeoor.encode.regr.lm' on task 'data_penguins' (iter 2/5)
INFO  [17:50:04.617] [mlr3] Applying learner 'scale.imputemedian.imputeoor.encode.regr.lm' on task 'data_penguins' (iter 3/5)
INFO  [17:50:05.339] [mlr3] Applying learner 'scale.imputemedian.imputeoor.encode.regr.lm' on task 'data_penguins' (iter 4/5)
INFO  [17:50:05.703] [mlr3] Applying learner 'scale.imputemedian.imputeoor.encode.regr.lm' on task 'data_penguins' (iter 5/5)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a>rr</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ResampleResult&gt; with 5 resampling iterations
       task_id                                  learner_id resampling_id
 data_penguins scale.imputemedian.imputeoor.encode.regr.lm            cv
 data_penguins scale.imputemedian.imputeoor.encode.regr.lm            cv
 data_penguins scale.imputemedian.imputeoor.encode.regr.lm            cv
 data_penguins scale.imputemedian.imputeoor.encode.regr.lm            cv
 data_penguins scale.imputemedian.imputeoor.encode.regr.lm            cv
 iteration warnings errors
         1        0      0
         2        0      0
         3        0      0
         4        0      0
         5        0      0</code></pre>
</div>
</div>
<p>Ahora podemos obtener la información correspondiente a cada uno de los remuestreos, y más concretamente el score asociado con cada una de ellas para la muestra de validación correspondiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a><span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb185-2"><a href="#cb185-2"></a>mse <span class="ot">=</span> rr<span class="sc">$</span><span class="fu">score</span>(metrica)</span>
<span id="cb185-3"><a href="#cb185-3"></a>mse[, .(iteration, regr.mse)]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   iteration regr.mse
1:         1 33.68020
2:         2 23.40316
3:         3 27.71888
4:         4 21.59297
5:         5 34.29915</code></pre>
</div>
</div>
<p>Todas las muestras producen errores cuadráticos medios muy similares. Evaluamos ahora el valor agregado para todas las submuestras.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a><span class="co"># valor agregado</span></span>
<span id="cb187-2"><a href="#cb187-2"></a>rr<span class="sc">$</span><span class="fu">aggregate</span>(metrica)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mse 
28.13887 </code></pre>
</div>
</div>
<p>El valor agregado es muy inferior al del modelo basal que estudiamos en puntos anteriores. Podemos utilizar otra métrica (como <span class="math inline">\(R^2\)</span>) para evaluar cada uno de los reumuestreos sin mucha dificultad, ya que tan solo debemos cambiar el score que deseamos utilizar sin necesidad de ejecutar todo el código.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a><span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb189-2"><a href="#cb189-2"></a>rsquared <span class="ot">=</span> rr<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"regr.rsq"</span>))</span>
<span id="cb189-3"><a href="#cb189-3"></a>rsquared[, .(iteration, regr.rsq)]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   iteration  regr.rsq
1:         1 0.8065669
2:         2 0.8911105
3:         3 0.8747264
4:         4 0.8694097
5:         5 0.8283350</code></pre>
</div>
</div>
<p>Todos los <span class="math inline">\(R^2\)</span> son superiores al 80% indicando que el modelo tiene un buen comportamiento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a><span class="co"># valor agregado</span></span>
<span id="cb191-2"><a href="#cb191-2"></a>rr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msr</span>(<span class="st">"regr.rsq"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> regr.rsq 
0.8540297 </code></pre>
</div>
</div>
<p>La variabilidad explicada de la respuesta de forma global para el modelo propuesto alcanza el 85%, lo que indica su buen comportamiento.</p>
</section>
</section>
<section id="sec-benchmarking" class="level4" data-number="5.2.2.6">
<h4 data-number="5.2.2.6" class="anchored" data-anchor-id="sec-benchmarking"><span class="header-section-number">5.2.2.6</span> Benchmarking</h4>
<p>El benchmarking o evaluación comparativa en el aprendizaje automático supervisado se refiere a la comparación de diferentes learners o modelos de aprendizaje en una o más tareas. Cuando se comparan varios learners en una sola tarea o en un dominio que consta de varias tareas similares, el objetivo principal suele ser clasificar a los learners según una medida de desempeño predefinida e identificar al mejor para la tarea o dominio considerado. Cuando se comparan varios learners en múltiples tareas, el objetivo principal suele ser más de naturaleza científica, por ejemplo, obtener información sobre cómo se comportan los diferentes modelos de aprendizaje en diferentes situaciones o si existen ciertas propiedades de los datos que afectan en gran medida a su comportamiento.</p>
<p>Es una práctica habitual que los científicos de datos analicen el rendimiento a la hora de generalizar el funcionamiento de un algoritmo o el tiempo de ejecución del mismo frente a otros propuestos en la literatura con el objeto de mejorar y/o agilizar el aprendizaje propuesto en comparación con los alumnos existentes en un experimento de referencia.</p>
<p>Los experimentos de benchmarking en <code>mlr3</code> se llevan a cabo con <code>benchmark()</code>, que simplemente ejecuta <code>resample()</code> en cada tarea y learner por separado, y luego recopila los resultados. La estrategia de remuestreo proporcionada se crea automáticamente en cada tarea para garantizar que todos los learner se comparen con los mismos datos de entrenamiento y prueba.</p>
<p>Para utilizar la función <code>benchmark()</code> primero llamamos a <code>benchmark_grid()</code>, que construye un diseño exhaustivo para describir todas las combinaciones de learner, tareas y resampling que se utilizarán en un experimento de referencia. A modo de ejemplo, a continuación configuramos un diseño con un bosque aleatorio, un árbol de decisión o un modelo basal sin características funcionan para comparar su comportamiento en dos tareas de clasificación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a><span class="co"># Tareas</span></span>
<span id="cb193-2"><a href="#cb193-2"></a>tasks <span class="ot">=</span> <span class="fu">tsks</span>(<span class="fu">c</span>(<span class="st">"german_credit"</span>, <span class="st">"sonar"</span>))</span>
<span id="cb193-3"><a href="#cb193-3"></a><span class="co"># Learners</span></span>
<span id="cb193-4"><a href="#cb193-4"></a>learners <span class="ot">=</span> <span class="fu">lrns</span>(<span class="fu">c</span>(<span class="st">"classif.rpart"</span>, <span class="st">"classif.ranger"</span>,</span>
<span id="cb193-5"><a href="#cb193-5"></a>  <span class="st">"classif.featureless"</span>), <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb193-6"><a href="#cb193-6"></a><span class="co"># Resampling</span></span>
<span id="cb193-7"><a href="#cb193-7"></a>rsmp_cv5 <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb193-8"><a href="#cb193-8"></a></span>
<span id="cb193-9"><a href="#cb193-9"></a><span class="co"># Grid de combinaciones</span></span>
<span id="cb193-10"><a href="#cb193-10"></a>design <span class="ot">=</span> <span class="fu">benchmark_grid</span>(tasks, learners, rsmp_cv5)</span>
<span id="cb193-11"><a href="#cb193-11"></a><span class="fu">head</span>(design)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            task             learner resampling
1: german_credit       classif.rpart         cv
2: german_credit      classif.ranger         cv
3: german_credit classif.featureless         cv
4:         sonar       classif.rpart         cv
5:         sonar      classif.ranger         cv
6:         sonar classif.featureless         cv</code></pre>
</div>
</div>
<p>Más adelante veremos el uso de estos procedimientos para determinar el mejor modelo en diferentes para un banco de datos dado.</p>
</section>
<section id="sec-tunnig" class="level4" data-number="5.2.2.7">
<h4 data-number="5.2.2.7" class="anchored" data-anchor-id="sec-tunnig"><span class="header-section-number">5.2.2.7</span> Optimización de hiperparámetros</h4>
<p>Los algoritmos de aprendizaje automático suelen incluir parámetros e hiperparámetros. Los parámetros son los coeficientes o pesos del modelo u otra información que determina el algoritmo de aprendizaje en función de los datos de entrenamiento. Por el contrario, los hiperparámetros los configura el usuario y determinan cómo el modelo se ajustará a sus parámetros, es decir, cómo se construye el modelo.</p>
<p>El objetivo de la optimización de hiperparámetros (HPO) o ajuste de modelo es encontrar la configuración óptima de hiperparámetros de un algoritmo de aprendizaje automático para una tarea determinada. Para este proceso se sigue un enfoque de optimización de caja negra: se configura un algoritmo de aprendizaje automático con valores elegidos para uno o más hiperparámetros, luego se evalúa este algoritmo (utilizando un método de remuestreo) y se mide su rendimiento. Este proceso se repite con múltiples configuraciones y finalmente se selecciona la configuración con mejor rendimiento. En la figura siguiente se presenta un esquema de dicho proceso:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://raw.githubusercontent.com/ia4legos/MachineLearning/main/images/Optim01.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Oprimización hiperparámetros</figcaption><p></p>
</figure>
</div>
<p>HPO se relaciona estrechamente con la evaluación del modelo ya que el objetivo es encontrar una configuración de hiperparámetro que optimice el rendimiento. En términos generales, podríamos pensar en encontrar la configuración óptima del modelo de la misma manera que seleccionar un modelo de un experimento de referencia, donde en este caso cada modelo del experimento es el mismo algoritmo pero con diferentes configuraciones de hiperparámetros. Sin embargo, el método de prueba y error humano requiere mucho tiempo, es subjetivo y a menudo sesgado, propenso a errores y computacionalmente ineficiente. En cambio, en las últimas décadas se han desarrollado muchos métodos sofisticados de optimización de hiperparámetros (o “tuners”) para lograr HPO robusto y eficiente. Además de enfoques simples como una búsqueda aleatoria o una búsqueda en cuadrícula, la mayoría de los métodos de optimización de hiperparámetros emplean técnicas iterativas que proponen diferentes configuraciones a lo largo del tiempo, mostrando a menudo un comportamiento adaptativo guiado hacia configuraciones de hiperparámetros potencialmente óptimas. Estos métodos proponen continuamente nuevas configuraciones hasta que se cumple un criterio de finalización, momento en el cual se devuelve la mejor configuración hasta el momento.</p>
<p><code>mlr3tuning</code> es el paquete de optimización de hiperparámetros del ecosistema <code>mlr3</code>. En el corazón del paquete están las clases R6:</p>
<ul>
<li><p><code>TuningInstanceSingleCrit</code>, una “instancia” de ajuste que describe el problema de optimización y almacena los resultados; y</p></li>
<li><p><code>Tuner</code> que se utiliza para configurar y ejecutar algoritmos de optimización.</p></li>
</ul>
<p>En temas posteriores veremos como utilizar la optimización de hiperparámetros para cada uno de los algoritmos que iremos presentando. A modo de ejemplo vamos a ver los hiperparámetros configurables en los learner de clasificación y regresión vistos en este capítulo. Ignoramos los modelos basales pues no tienen hiperparámetros. Vamos as obtener un listado con los hiperparámetros disponibles indicando su nombre, clase valor más pequeño y más grande que puede tomar y número de niveles si se tratan de parámetros discretos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a><span class="co"># Parámetros para el algoritmo de clasificación</span></span>
<span id="cb195-2"><a href="#cb195-2"></a><span class="fu">as.data.table</span>(<span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>)<span class="sc">$</span>param_set)[,</span>
<span id="cb195-3"><a href="#cb195-3"></a>  .(id, class, lower, upper, nlevels)]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id    class lower upper nlevels
 1:             cp ParamDbl     0     1     Inf
 2:     keep_model ParamLgl    NA    NA       2
 3:     maxcompete ParamInt     0   Inf     Inf
 4:       maxdepth ParamInt     1    30      30
 5:   maxsurrogate ParamInt     0   Inf     Inf
 6:      minbucket ParamInt     1   Inf     Inf
 7:       minsplit ParamInt     1   Inf     Inf
 8: surrogatestyle ParamInt     0     1       2
 9:   usesurrogate ParamInt     0     2       3
10:           xval ParamInt     0   Inf     Inf</code></pre>
</div>
</div>
<p>Ahora con el modelo para la tarea de regresión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a><span class="co"># Parámetros para el algoritmo de clasificación</span></span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="fu">as.data.table</span>(<span class="fu">lrn</span>(<span class="st">"regr.lm"</span>)<span class="sc">$</span>param_set)[,</span>
<span id="cb197-3"><a href="#cb197-3"></a>  .(id, class, lower, upper, nlevels)]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             id    class lower upper nlevels
 1:          df ParamDbl  -Inf   Inf     Inf
 2:    interval ParamFct    NA    NA       3
 3:       level ParamDbl  -Inf   Inf     Inf
 4:       model ParamLgl    NA    NA       2
 5:      offset ParamLgl    NA    NA       2
 6:    pred.var ParamUty    NA    NA     Inf
 7:          qr ParamLgl    NA    NA       2
 8:       scale ParamDbl  -Inf   Inf     Inf
 9: singular.ok ParamLgl    NA    NA       2
10:           x ParamLgl    NA    NA       2
11:           y ParamLgl    NA    NA       2</code></pre>
</div>
</div>
<p>Más adelante estudiaremos con detalle cada uno de los hiperparámetros vinculados con un modelo de aprendizaje y veremos cuales de ellos es necesario optimizar y cuales no. Estos últimos proporcionan información sobre el ajuste del modelo pero no controlan el proceso de entrenamiento en si. Hay que tener en cuenta que el número de hiperparámetros suele ser elevado y no resulta práctico llevar una búsqueda óptima sobre todos ellos a la vez.</p>
</section>
</section>
</section>
<section id="sec-50.3" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sec-50.3"><span class="header-section-number">5.3</span> Consideraciones finales</h2>
<p>una vez hemos visto los pasos a seguir en el establecimiento de un modelo de aprendizaje automático ha llegado el momento de pasar a describir los algoritmos más habituales tanto en el aprendizaje supervisado como el no supervisado.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-dataexplorer" class="csl-entry" role="doc-biblioentry">
Cui, Boxuan. 2020. <em>DataExplorer: Automate Data Exploration and Treatment</em>. <a href="https://CRAN.R-project.org/package=DataExplorer">https://CRAN.R-project.org/package=DataExplorer</a>.
</div>
<div id="ref-mlr3" class="csl-entry" role="doc-biblioentry">
Lang, Michel, Martin Binder, Jakob Richter, Patrick Schratz, Florian Pfisterer, Stefan Coors, Quay Au, Giuseppe Casalicchio, Lars Kotthoff, and Bernd Bischl. 2019. <span>“<span class="nocase">mlr3</span>: A Modern Object-Oriented Machine Learning Framework in <span>R</span>.”</span> <em>Journal of Open Source Software</em>, December. <a href="https://doi.org/10.21105/joss.01903">https://doi.org/10.21105/joss.01903</a>.
</div>
<div id="ref-mlr3verse" class="csl-entry" role="doc-biblioentry">
Lang, Michel, and Patrick Schratz. 2023. <em>Mlr3verse: Easily Install and Load the ’Mlr3’ Package Family</em>.
</div>
<div id="ref-ggally" class="csl-entry" role="doc-biblioentry">
Schloerke, Barret, Di Cook, Joseph Larmarange, Francois Briatte, Moritz Marbach, Edwin Thoen, Amos Elberg, and Jason Crowley. 2021. <em>GGally: Extension to ’Ggplot2’</em>. <a href="https://CRAN.R-project.org/package=GGally">https://CRAN.R-project.org/package=GGally</a>.
</div>
<div id="ref-skimr" class="csl-entry" role="doc-biblioentry">
Waring, Elin, Michael Quinn, Amelia McNamara, Eduardo Arino de la Rubia, Hao Zhu, and Shannon Ellis. 2022. <em>Skimr: Compact and Flexible Summaries of Data</em>. <a href="https://CRAN.R-project.org/package=skimr">https://CRAN.R-project.org/package=skimr</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "¡Copiado!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "¡Copiado!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02_FirstStepsAA.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Parte 2. Primeros pasos</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_SupervisedAA.html" class="pagination-link">
        <span class="nav-page-text">Parte 3. Aprendizaje supervisado</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, IA4LEGOS. Universidad Miguel Hernández de Elche</div>   
  </div>
</footer>



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MachineLearning - 7&nbsp; Modelos de Regresión Logística</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./80_SurvivalModels.html" rel="next">
<link href="./60_RegressionModels.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos coincidentes",
    "search-copy-link-title": "Copiar enlace para buscar",
    "search-hide-matches-text": "Ocultar coincidencias adicionales",
    "search-more-match-text": "más coincidencia en este documento",
    "search-more-matches-text": "más coincidencias en este documento",
    "search-clear-button-title": "Limpiar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Entregar"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de Regresión Logística</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MachineLearning</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Prefacio</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./01_IntroCourse.html" class="sidebar-item-text sidebar-link">Parte 1. Introducción</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_introAD.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_introAA.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introducción al Aprendizaje Automático (AA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_RandRstudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducción a R y RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./40_DataBases.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bases de datos</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_FirstStepsAA.html" class="sidebar-item-text sidebar-link">Parte 2. Primeros pasos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./50_AED.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introducción al análisis de datos</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_SupervisedAA.html" class="sidebar-item-text sidebar-link">Parte 3. Aprendizaje supervisado</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./60_RegressionModels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos de Regresión</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./70_LogisticModels.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de Regresión Logística</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./80_SurvivalModels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modelos de supervivencia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./90_BayesianClassif.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modelos de clasificación Naïve Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100_kNNmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Modelo de los k vecinos más cercanos (kNN)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110_SVMmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Máquinas de Vector Soporte (SVM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120_DTmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Árboles de decisiónn (DT)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130_Ensemblemodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Modelos de conjunto (Ensemble models)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140_Boostingmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modelos Boosting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./04_NonSupervisedAA.html" class="sidebar-item-text sidebar-link">Parte 4. Aprendizaje no supervisado</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./150_Discriminantmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Análisis discriminante (AD)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./160_PrinCompmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Componentes principales (CP)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./170_MDSmodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Métodos de escalado multidimensional (MDS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./180_Clustermodels.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Análisis cluster</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referencias</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#sec-70.1" id="toc-sec-70.1" class="nav-link active" data-scroll-target="#sec-70.1"><span class="toc-section-number">7.1</span>  Bancos de datos</a>
  <ul>
  <li><a href="#breast-cancer-wisconsin" id="toc-breast-cancer-wisconsin" class="nav-link" data-scroll-target="#breast-cancer-wisconsin"><span class="toc-section-number">7.1.1</span>  Breast Cancer Wisconsin</a></li>
  <li><a href="#iris" id="toc-iris" class="nav-link" data-scroll-target="#iris"><span class="toc-section-number">7.1.2</span>  Iris</a></li>
  </ul></li>
  <li><a href="#sec-70.2" id="toc-sec-70.2" class="nav-link" data-scroll-target="#sec-70.2"><span class="toc-section-number">7.2</span>  Modelos de Regresión Logística Binaria</a>
  <ul>
  <li><a href="#sec-70.2.1" id="toc-sec-70.2.1" class="nav-link" data-scroll-target="#sec-70.2.1"><span class="toc-section-number">7.2.1</span>  El modelo</a></li>
  <li><a href="#sec-70.2.2" id="toc-sec-70.2.2" class="nav-link" data-scroll-target="#sec-70.2.2"><span class="toc-section-number">7.2.2</span>  Evaluación del modelo</a></li>
  <li><a href="#sec-70.2.3" id="toc-sec-70.2.3" class="nav-link" data-scroll-target="#sec-70.2.3"><span class="toc-section-number">7.2.3</span>  Validación del modelo</a></li>
  </ul></li>
  <li><a href="#sec-70.3" id="toc-sec-70.3" class="nav-link" data-scroll-target="#sec-70.3"><span class="toc-section-number">7.3</span>  Modelos de Regresión Logística Multinomial</a>
  <ul>
  <li><a href="#sec-70.3.1" id="toc-sec-70.3.1" class="nav-link" data-scroll-target="#sec-70.3.1"><span class="toc-section-number">7.3.1</span>  El modelo</a></li>
  <li><a href="#sec-70.3.2" id="toc-sec-70.3.2" class="nav-link" data-scroll-target="#sec-70.3.2"><span class="toc-section-number">7.3.2</span>  Evaluación del modelo</a></li>
  </ul></li>
  <li><a href="#sec-70.4" id="toc-sec-70.4" class="nav-link" data-scroll-target="#sec-70.4"><span class="toc-section-number">7.4</span>  Regresión logística en mlr3</a>
  <ul>
  <li><a href="#sec-70.4.1" id="toc-sec-70.4.1" class="nav-link" data-scroll-target="#sec-70.4.1"><span class="toc-section-number">7.4.1</span>  Datos Breast Cancer</a></li>
  <li><a href="#sec-70.4.2" id="toc-sec-70.4.2" class="nav-link" data-scroll-target="#sec-70.4.2"><span class="toc-section-number">7.4.2</span>  Datos iris</a></li>
  <li><a href="#sec-70.4.3" id="toc-sec-70.4.3" class="nav-link" data-scroll-target="#sec-70.4.3"><span class="toc-section-number">7.4.3</span>  Actualizando los modelos</a>
  <ul class="collapse">
  <li><a href="#datos-breast-cancer" id="toc-datos-breast-cancer" class="nav-link" data-scroll-target="#datos-breast-cancer"><span class="toc-section-number">7.4.3.1</span>  Datos Breast Cancer</a></li>
  <li><a href="#datos-iris" id="toc-datos-iris" class="nav-link" data-scroll-target="#datos-iris"><span class="toc-section-number">7.4.3.2</span>  Datos iris</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-70.5" id="toc-sec-70.5" class="nav-link" data-scroll-target="#sec-70.5"><span class="toc-section-number">7.5</span>  Ejercicios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-70" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modelos de Regresión Logística</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Los modelos de regresión logística son aquellos donde el target es de tipo categórico. En función del tipo de categorías del target hablamos de un modelo de regresión logística binario o multinomial.</p>
<p>En los modelos de regresión logística binaria el target que deseamos analizar sólo puede tomar dos valores posibles (0 o 1, Sí y No, Comprar o No comprar, etc…) de forma que el modelo de aprendizaje automático trata de predecir la probabilidad de que una muestra proporcione una respuesta específica entre las dos posibles en función de un conjunto de posibles variables predictoras (de tipo cuantitativo o cualitativo). De forma automática, una vez que determinamos la probabilidad de cada categoría tenemos disponible una herramienta de clasificación de las muestras en cada una de las dos categorías. Se trata pues de un método combinado entre un método de regresión y de clasificación. Dadas las características especiales de este tipo de modelos veremos que las métricas de evaluación utilizadas son las habituales de los modelos de clasificación en lugar de los de regresión.</p>
<p>En los modelos de regresión logística multinomial el target categórico tiene más de dos categorías de respuesta. En estas situaciones no podemos aplicar los modelos de regresión logística binomial, ya que es necesario hacer una clasificación para más de dos clases, y necesitamos una modificación de dicho modelo que se conoce como regresión logística multinomial, o también regresión softmax. En este tipo de regresión la variable respuesta tiene un rango de valores posibles en un conjunto de K clases. El objetivo aquí será determinar cuál es la probabilidad de que el valor de la respuesta sea cada una de las clases potenciales, <span class="math inline">\(P(y=k|x), k \in K\)</span>.</p>
<p>Existen dos variantes para este tipo de modelos:</p>
<ul>
<li><p>Regresión logística multinomial con respuesta nominal, es decir, las categorías de la respuesta no siguen ningún orden específico. Por ejemplo el color del pelo de un conjunto de sujetos.</p></li>
<li><p>Regresión logística multinomial con respuesta ordinal, es decir, las categorías de la respuesta siguen un orden específico. Por ejemplo el grado de una enfermedad.</p></li>
</ul>
<p>En el código siguiente se cargan los paquetes y la configuración básica para este tipo de modelos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Paquetes anteriores</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(knitr) <span class="co"># para formatos de tablas</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(cvms)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">theme_set</span>(<span class="fu">theme_sjplot2</span>())</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># Paquetes AA</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(mlr3tuning)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(mlr3tuningspaces)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-70.1" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-70.1"><span class="header-section-number">7.1</span> Bancos de datos</h2>
<p>A continuación presentamos los bancos de datos con los que trabajaremos en este tema. En concreto usaremos los bancos de datos Breast Cancer Wisconsin ([-sec-brestcancer]), e Iris (<a href="40_DataBases.html#sec-iris"><span>4.3.3</span></a>) que presentamos en el capítulo <a href="40_DataBases.html"><span>4</span></a>.</p>
<p>A continuación se muestra el código para la carga de los diferentes bancos de datos y la creación de la correspondiente task de regresión para cada uno de ellos.</p>
<p>Para crear una tarea de clasificación utilizamos la función <code>as_task_classif</code>. En el caso de un target binario debemos identificar además la categoría de mayor interés identificada con el parámetro <code>positive</code>.</p>
<section id="breast-cancer-wisconsin" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="breast-cancer-wisconsin"><span class="header-section-number">7.1.1</span> Breast Cancer Wisconsin</h3>
<p>En esta base de datos se recoge información sobre los cánceres de mama en la ciudad de Wisconsin. Las características de la base de datos se calculan a partir de una imagen digitalizada de un aspiración de aguja fina (FNA) de una masa mamaria. Describen las características de los núcleos celulares presentes en la imagen y el objetivo que se persigue es clasificar un tumor como benigno o maligno en función de las variables predictoras. Como en este caso estamos interesados en saber que predictoras influyen más en el carácter maligno del cáncer, utilizaremos esa categoría como la de interés.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Cargamos datos</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>breastcancer <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"breastcancer.rds"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># Creación de task eliminado la columna que identifica os sujetos</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>tsk_cancer <span class="ot">=</span> <span class="fu">as_task_classif</span>(breastcancer[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">target =</span> <span class="st">"diagnosis"</span>, <span class="at">positive =</span> <span class="st">"M"</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># información de la tarea</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">print</span>(tsk_cancer)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:breastcancer[, -1]&gt; (569 x 31)
* Target: diagnosis
* Properties: twoclass
* Features (30):
  - dbl (30): area_mean, area_se, area_worst, compactness_mean,
    compactness_se, compactness_worst, concave_points_mean,
    concave_points_se, concave_points_worst, concavity_mean,
    concavity_se, concavity_worst, fractal_dimension_mean,
    fractal_dimension_se, fractal_dimension_worst, perimeter_mean,
    perimeter_se, perimeter_worst, radius_mean, radius_se,
    radius_worst, smoothness_mean, smoothness_se, smoothness_worst,
    symmetry_mean, symmetry_se, symmetry_worst, texture_mean,
    texture_se, texture_worst</code></pre>
</div>
</div>
<p>Todas la variables son de tipo numérico. En primer lugar evaluamos la existencia de missings</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Missings</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>tsk_cancer<span class="sc">$</span><span class="fu">missings</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              diagnosis               area_mean                 area_se 
                      0                       0                       0 
             area_worst        compactness_mean          compactness_se 
                      0                       0                       0 
      compactness_worst     concave_points_mean       concave_points_se 
                      0                       0                       0 
   concave_points_worst          concavity_mean            concavity_se 
                      0                       0                       0 
        concavity_worst  fractal_dimension_mean    fractal_dimension_se 
                      0                       0                       0 
fractal_dimension_worst          perimeter_mean            perimeter_se 
                      0                       0                       0 
        perimeter_worst             radius_mean               radius_se 
                      0                       0                       0 
           radius_worst         smoothness_mean           smoothness_se 
                      0                       0                       0 
       smoothness_worst           symmetry_mean             symmetry_se 
                      0                       0                       0 
         symmetry_worst            texture_mean              texture_se 
                      0                       0                       0 
          texture_worst 
                      0 </code></pre>
</div>
</div>
<p>No hay valores perdidos en ninguna de las variables el conjunto de datos.</p>
<p>Como el conjunto de predictoras es tan grande no resulta útil representar todos los datos de la tarea en un único gráfico. vamos a utilizar un filtro de las características para determinar a priori las más relevantes, y poder representarlas gráficamente. En este caso utilizamos el filtro <code>anova</code> que nos permite realizar el test F de comparación de medias de las predictoras numéricas con respecto al target categórico.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Construimos el objeto que define el filtro</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>filter <span class="ot">=</span> <span class="fu">flt</span>(<span class="st">"anova"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># Aplicamos el filtro sobre los datos de entrenamiento</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(tsk_cancer)</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># Vemos los resultados</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>filter</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FilterAnova:anova&gt;: ANOVA F-Test
Task Types: classif
Properties: -
Task Properties: -
Packages: stats
Feature types: integer, numeric
                   feature        score
 1:   concave_points_worst 123.70573229
 2:        perimeter_worst 118.23871904
 3:    concave_points_mean 115.14867130
 4:           radius_worst 115.07148679
 5:         perimeter_mean 100.07385051
---                                    
26:   fractal_dimension_se   1.20015272
27:          smoothness_se   0.95743784
28: fractal_dimension_mean   0.11922252
29:             texture_se   0.07400141
30:            symmetry_se   0.05717782</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># o los representamos gráficamente</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">autoplot</span>(filter)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reglog-004" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/fig-reglog-004-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;7.1: Autoplot filter. Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En la tabla aparecen ordenados las variables con mayores diferencias entre las muestras clasificadas como benignas o malignas. A continuación vemos el gráfico para las cuatro variables más relevantes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tsk_cancer<span class="sc">$</span><span class="fu">data</span>(), <span class="fu">aes</span>(<span class="at">x =</span> concave_points_worst, <span class="at">y=</span> diagnosis)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() </span>
<span id="cb9-2"><a href="#cb9-2"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tsk_cancer<span class="sc">$</span><span class="fu">data</span>(), <span class="fu">aes</span>(<span class="at">x =</span> perimeter_worst, <span class="at">y=</span> diagnosis)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb9-3"><a href="#cb9-3"></a>g3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tsk_cancer<span class="sc">$</span><span class="fu">data</span>(), <span class="fu">aes</span>(<span class="at">x =</span> concave_points_mean, <span class="at">y=</span> diagnosis)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() </span>
<span id="cb9-4"><a href="#cb9-4"></a>g4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tsk_cancer<span class="sc">$</span><span class="fu">data</span>(), <span class="fu">aes</span>(<span class="at">x =</span> radius_worst, <span class="at">y=</span> diagnosis)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">ggarrange</span>(g1, g2, g3, g4, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reglog-005" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/fig-reglog-005-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;7.2: Gráficos de cajas predictoras más relevantes. Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Como se puede ver en los cuatro gráficos hay diferencias entre las cajas correspondientes a cada grupo, indicando que todas ellas pueden ser utilizadas para clasificar el tipo de tumor como benigno o maligno. De hecho en todas ellas se aprecia el mismo efecto. Cuanto mayor es el valor de la predictora más seguros podemos estar de que el cáncer es maligno.</p>
</section>
<section id="iris" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="iris"><span class="header-section-number">7.1.2</span> Iris</h3>
<p>El banco de datos iris ya los presentamos en temas anteriores y aquí solo se presenta el código para crear la tarea de clasificación correspondiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Cargamos datos</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>iris <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"iris.rds"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co"># creamos la tarea</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>tsk_iris <span class="ot">=</span> <span class="fu">as_task_classif</span>(iris, <span class="at">target =</span> <span class="st">"species"</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># información de la tarea</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="fu">print</span>(tsk_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:iris&gt; (150 x 5)
* Target: species
* Properties: multiclass
* Features (4):
  - dbl (4): petal_length, petal_width, sepal_length, sepal_width</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-70.2" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-70.2"><span class="header-section-number">7.2</span> Modelos de Regresión Logística Binaria</h2>
<p>A continuación se detallan los aspectos teóricos más importantes de este tipo de modelos.</p>
<section id="sec-70.2.1" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="sec-70.2.1"><span class="header-section-number">7.2.1</span> El modelo</h3>
<p>En este tipo de modelos disponemos de una variable respuesta (<span class="math inline">\(y\)</span>) de tipo cualitativo con dos posibles respuestas que se codifican habitualmente con 0-1, donde el 0 indica “fracaso” y el 1 indica “éxito”. Además disponemos de una matriz de variables predictoras de tipo numérico y/o categórico, a partir de las cuales podemos obtener la matriz <span class="math inline">\(X\)</span>. La definición de “éxito” o “fracaso” depende de cada problema específico.</p>
<p>Imaginemos que disponemos de <span class="math inline">\(p\)</span> posibles predictoras de forma que el conjunto de muestras viene dado por:</p>
<p><span id="eq-rl001"><span class="math display">\[\{(y_i, x_{1i},...x_{pi})\}_{i=1}^n \tag{7.1}\]</span></span></p>
<p>donde <span class="math inline">\(x_{ji}\)</span> es el valor de la muestra <span class="math inline">\(i\)</span> en la predictora <span class="math inline">\(j\)</span> e <span class="math inline">\(y_i\)</span> nos da el valor de la categoría de la muestra <span class="math inline">\(i\)</span> (codificada como 0 o 1). En esta situación construimos el predictor lineal:</p>
<p><span id="eq-rl002"><span class="math display">\[z = w_0 + w_1X_1+...+w_pX_p \tag{7.2}\]</span></span></p>
<p>donde cada <span class="math inline">\(w_j\)</span> representa la pendiente o variación del predictor lineal con respecto a cada predictora, y <span class="math inline">\(w_0\)</span> representa el sesgo del modelo. Dado que el valor del predictor lineal no necesariamente se encuentra restringido al intervalo <span class="math inline">\([0, 1]\)</span>, resulta necesario convertir dicho valor en una probabilidad para determinar la solución del modelo. Para realizar esta operación utilizamos la función logística:</p>
<p><span id="eq-rl003"><span class="math display">\[\phi(z) = \frac{1}{1+e^{-z}}, \tag{7.3}\]</span></span></p>
<p>que permite pasar cualquier valor del intervalo <span class="math inline">\([-∞,∞]\)</span> al intervalo <span class="math inline">\([0,1]\)</span>, es decir, pasamos cualquier valor numérico a una probabilidad. En la figura siguiente podemos ver la representación gráfica de la función logística para diferentes valores de z:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>z <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>, <span class="fl">0.001</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a>y <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>z))</span>
<span id="cb12-3"><a href="#cb12-3"></a>res <span class="ot">=</span> <span class="fu">data.frame</span>(z , y)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> z, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reglog-007" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/fig-reglog-007-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;7.3: Función logística</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La función logit se define entonces como:</p>
<p><span id="eq-rl004"><span class="math display">\[logit(P(y=1 | X) = z, \tag{7.4}\]</span></span></p>
<p>donde <span class="math inline">\(P(y=1 | X)\)</span> es la probabilidad condicional de que una muestra concreta pertenezca a la clase 1 dadas sus predictoras <span class="math inline">\(X\)</span>. La función logit toma entradas en el rango <span class="math inline">\([0, 1]\)</span> y las transforma en valores en todo el rango de números reales. En cambio, la función logística toma valores de entrada en todo el rango de números reales y los transforma en valores en el rango <span class="math inline">\([0, 1]\)</span>. En otras palabras, la función logística es la inversa de la función logit, y nos permite predecir la probabilidad condicional de que una determinada muestra pertenezca a la clase 1 (o a la clase 0). En realidad a partir de ambas expresiones podemos escribir:</p>
<p><span id="eq-rl005"><span class="math display">\[P(y=1 | X) = \frac{e^{w_0 + w_1X_1+...+w_pX_p}}{1+e^{w_0 + w_1X_1+...+w_pX_p}} \tag{7.5}\]</span></span></p>
<p>y podemos relacionar las probabilidades condicionadas de ambas respuestas mediante el log-odds:</p>
<p><span id="eq-rl006"><span class="math display">\[log(\frac{P(y=1 | X)}{P(y=0 | X)}) = w_0 + w_1X_1+...+w_pX_p \tag{7.6}\]</span></span></p>
<p>que podemos utilizar para representar el ratio entre la probabilidad de evento verdadero y la probabilidad de evento falso (<em>odds ratio</em>):</p>
<p><span id="eq-rl007"><span class="math display">\[\frac{P(y=1 | X)}{P(y=0 | X)} = exp(w_0 + w_1X_1+...+w_pX_p) \tag{7.7}\]</span></span></p>
<p>Los principales elementos que hay que interpretar en un modelo de regresión logística son los siguientes coeficientes de los predictores:</p>
<ul>
<li><p><span class="math inline">\(w_0\)</span> es la ordenada en el origen o <em>intercept</em>. Se corresponde con el valor esperado del logaritmo de <em>odds</em> cuando todos los predictores son cero.</p></li>
<li><p><span class="math inline">\(w_p\)</span> son los coeficientes de regresión parcial de cada predictor e indican el cambio promedio del logaritmo de <em>odds</em> al incrementar en una unidad la variable predictora, manteniéndose constantes el resto de variables. Esto equivale a decir que, por cada unidad que se incrementa la predictora, se multiplican los <em>odds</em> por <span class="math inline">\(e^{w_p}\)</span>, es decir, aumenta el riesgo en esa cantidad.</p></li>
</ul>
<p>Dado que la relación entre la probabilidad condicional y las predictoras no es lineal, los coeficientes de regresión no se corresponden con el cambio en la probabilidad de la respuesta asociada con el incremento en una unidad de la predictora, sino con el cambio en el log-odds.</p>
</section>
<section id="sec-70.2.2" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="sec-70.2.2"><span class="header-section-number">7.2.2</span> Evaluación del modelo</h3>
<p>Para la evaluación del modelo se utilizan diferentes métricas obtenidas a partir de la clasificación con las probabilidades proporcionadas por el modelo de regresión logística, entre las que podemos destacar:</p>
<ul>
<li>El porcentaje de clasificación correcta/incorrecta.</li>
<li>La matriz de confusión, que nos permite obtener todos los porcentajes de interés para la clasificación.</li>
<li>La curva ROC, que se utilizan a menudo para obtener una visión del resultado de un clasificador en términos de sus verdaderos frente a los falsos positivos. Suelen presentar la tasa de verdaderos positivos en el eje Y, y la tasa de falsos positivos en el eje X. Por tanto, la inclinación de la curva y el espacio entre la diagonal y la curva son importantes ya que cuanto más alejada esté la curva y más hacia arriba mejor será nuestro modelo.</li>
<li>El área bajo la curva (AUC), que nos proporciona el área bajo la curva ROC de forma que valores próximos a 1 indican un buen ajuste (clasificación perfecta), mientras que valores próximos a 0.5 indican un ajuste malo (clasificación incorrecta).</li>
<li>El score de Brier, que mide la precisión de las predicciones probabilísticas. Para situaciones unidimensionales su comportamiento es igual al del <code>MSE</code>.</li>
</ul>
</section>
<section id="sec-70.2.3" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="sec-70.2.3"><span class="header-section-number">7.2.3</span> Validación del modelo</h3>
<p>Las técnicas de validación para este tipo de modelos son las mismas que las de los modelos de regresión lineal: validación cruzada y curva de aprendizaje.</p>
</section>
</section>
<section id="sec-70.3" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-70.3"><span class="header-section-number">7.3</span> Modelos de Regresión Logística Multinomial</h2>
<p>A continuación se presentan brevemente los conceptos teóricos más relevantes de los modelos de regresión logística para respuesta multinomial.</p>
<section id="sec-70.3.1" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-70.3.1"><span class="header-section-number">7.3.1</span> El modelo</h3>
<p>Imaginemos que disponemos de <span class="math inline">\(p\)</span> posibles predictoras de forma que el conjunto de muestras viene dado por:</p>
<p><span class="math display">\[\{(y_i, x_{1i},...x_{pi})\}_{i=1}^n\]</span></p>
<p>donde <span class="math inline">\(x_{ji}\)</span> es el valor de la muestra <span class="math inline">\(i\)</span> en la predictora <span class="math inline">\(j\)</span> e <span class="math inline">\(y_i\)</span> nos da el valor de la categoría de la muestra <span class="math inline">\(i\)</span>, codificada de 1 a k . En esta situación construimos el predictor lineal para una clase k de la respuesta:</p>
<p><span class="math display">\[z_k = w_{0k} + w_{1k}X_1+...+w_{pk}X_p\]</span></p>
<p>donde cada <span class="math inline">\(w_{jk}\)</span> representa la pendiente o variación del predictor lineal con respecto a cada predictora para la clase k, y <span class="math inline">\(w_{0k}\)</span> representa el sesgo del modelo para la clase k.</p>
<p>La regresión logística multinomial clasifica usando una generalización de la función sigmoide, conocida como la función softmax, para calcular la probabilidad <span class="math inline">\(P(y=k|x)\)</span>. La función softmax toma un vector <span class="math inline">\(z=[z_1,z_2,…,z_k]'\)</span> de k valores obtenidos a partir de los predictores lineales correspondientes, y los transforma en una distribución de probabilidades.</p>
<p>Para un vector <span class="math inline">\(z\)</span> de dimensionalidad <span class="math inline">\(k\)</span> la función softmax se define a partir de los elementos individuales:</p>
<p><span class="math display">\[\phi(z_i) = \frac{e^{z_i}}{\sum_{j=1}^k e^{z_j}}, \quad 1\leq i\leq k\]</span></p>
<p>como:</p>
<p><span class="math display">\[\phi(z)=\left[\frac{e^{z_1}}{\sum_{j=1}^k e^{z_j}},\frac{e^{z_2}}{\sum_{j=1}^k e^{z_j}},...,\frac{e^{z_k}}{\sum_{j=1}^k e^{z_j}} \right],\]</span></p>
<p>donde queda claro que todos los elementos están restringidos al intervalo <span class="math inline">\([0,1]\)</span> y la suma de todas las componentes es 1. Tenemos una distribución de probabilidad para la respuesta en función de las predictoras consideradas.</p>
<p>Como ocurría en el modelo de regresión logística binomial:</p>
<ul>
<li><p><span class="math inline">\(w_{0k}\)</span> es la ordenada en el origen o <em>intercept</em>. Se corresponde con el valor esperado del logaritmo de <em>odds</em> cuando todos los predictores son cero para la clase k.</p></li>
<li><p><span class="math inline">\(w_{pk}\)</span> los coeficientes de regresión parcial de cada predictor que indican el cambio promedio del logaritmo de <em>odds</em> al incrementar en una unidad la variable predictora, manteniéndose constantes el resto de variables para una clase dada. Esto equivale a decir que, por cada unidad que se incrementa la predictora, se multiplican los odds por <span class="math inline">\(e^{w_{pk}}\)</span>.</p></li>
</ul>
<p>Dado que la relación entre la probabilidad condicional y las predictoras no es lineal, los coeficientes de regresión no se corresponden con el cambio en la probabilidad de la respuesta asociada con el incremento en una unidad de la predictora, sino con el cambio en el log-odds.</p>
<p>Como ocurría en los modelos lineales la magnitud de cada coeficiente parcial de regresión depende de las unidades en las que se mida la variable predictora a la que corresponde, por lo que su magnitud no está asociada con la importancia de cada predictor. Para poder determinar qué impacto tienen en el modelo cada una de las variables, se emplean los coeficientes parciales estandarizados, que se obtienen al estandarizar las predictoras.</p>
</section>
<section id="sec-70.3.2" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-70.3.2"><span class="header-section-number">7.3.2</span> Evaluación del modelo</h3>
<p>Para la evaluación del modelo se utilizan diferentes métricas obtenidas a partir de la clasificación con las probabilidades proporcionadas por el modelo de regresión logística multinomial, entre las que podemos destacar:</p>
<ul>
<li>El porcentaje de clasificación correcta/incorrecta.</li>
<li>La matriz de confusión, que nos permite obtener todos los porcentajes de interés para la clasificación.</li>
<li>El score de Brier para clasificaciones múltiples que mide la precisión de las predicciones probabilísticas.</li>
</ul>
</section>
</section>
<section id="sec-70.4" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="sec-70.4"><span class="header-section-number">7.4</span> Regresión logística en mlr3</h2>
<p>Para realizar el proceso de aprendizaje de un modelo de regresión logística podemos usar dos learner en la librería <code>mlr3</code>:</p>
<ul>
<li><code>classif.log_reg</code>, que esta enfocado en la tarea de clasificación pero que nos permite predecir las probabilidades de cada categoría de la respuesta.</li>
<li><code>classif.multinom</code>, que esta enfocado en la tarea de clasificación cuando hay más de dos categorías en la respuesta. En este caso se fija una categoría como referencia y se obtienen los modelos que proporcionan la probabilidad de clasificación para las otras dos. La probabilidad de la referencia se calcula como 1 menos las otras dos.</li>
<li><code>regr.glm</code>, que esta enfocado en al tarea de regresión para predecir las probabilidades de cada categoría (cuando la respuesta tiene dos o más categorías).</li>
</ul>
<p>Usar cualquiera de ellos implica que el proceso de evaluación y validación (scores) debe estar adaptado a ellos. Sin embargo, en la práctica ambos algoritmos utilizan la misma función y producen el miso resultado</p>
<section id="sec-70.4.1" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="sec-70.4.1"><span class="header-section-number">7.4.1</span> Datos Breast Cancer</h3>
<p>En este caso utilizamos el learner <code>classif.log_reg</code>. Antes de comenzar definimos el preprocesado vinculado a este conjunto de datos (estandarización de predictoras numéricas), y preparamos la muestra de entrenamiento y validación.</p>
<p>Herramienta de preprocesado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># preprocesado</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>pp_cancer <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Antes de realizar la división de muestras es necesario saber si el reparto de las categorías maligno-benigno es equitativo en al respuesta. Para ello evaluamos la variable de interés:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">table</span>(tsk_cancer<span class="sc">$</span><span class="fu">data</span>()[,<span class="st">"diagnosis"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>diagnosis
  M   B 
212 357 </code></pre>
</div>
</div>
<p>Dado que el reparto esta algo desequilibrado vamos a introducir un estrato de agrupación basado en la variable de interés. A continuación consideramos un reparto 80-20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Generamos variable de estrato</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>tsk_cancer<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"diagnosis"</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co"># Fijamos semilla para asegurar la reproducibilidad del modelo</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co"># Creamos la partición</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>splits <span class="ot">=</span> mlr3<span class="sc">::</span><span class="fu">partition</span>(tsk_cancer, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co"># Muestras de entrenamiento y validación</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>tsk_train_cancer <span class="ot">=</span> tsk_cancer<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>train)</span>
<span id="cb16-9"><a href="#cb16-9"></a>tsk_test_cancer  <span class="ot">=</span> tsk_cancer<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vemos en primer lugar si el reparto realizado respeta el estrato establecido</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">table</span>(tsk_train_cancer<span class="sc">$</span><span class="fu">data</span>()[,<span class="st">"diagnosis"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>diagnosis
  M   B 
170 286 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">table</span>(tsk_test_cancer<span class="sc">$</span><span class="fu">data</span>()[,<span class="st">"diagnosis"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>diagnosis
 M  B 
42 71 </code></pre>
</div>
</div>
<p>El ratio entre ambas categorías se mantiene en ambas muestras. Ahora podemos comenzar el proceso de aprendizaje asociado con este modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Definimos learner para predecir la probabilidad</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># Graphlearner: Preprocesado y learner</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>gr <span class="ot">=</span> pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb21-5"><a href="#cb21-5"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos comenzar ahora con el entrenamiento del modelo y su interpretación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Entrenamiento</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_cancer)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># Resumen del modelo</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>modelo <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.log_reg<span class="sc">$</span>model</span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="fu">summary</span>(modelo)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::glm(formula = task$formula(), family = "binomial", data = data, 
    model = FALSE)

Coefficients:
                         Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)               -122.67   16932.81  -0.007    0.994
area_mean                 2341.84  209910.76   0.011    0.991
area_se                   1486.08   69511.26   0.021    0.983
area_worst               -4921.17  184349.14  -0.027    0.979
compactness_mean          -925.12   34344.47  -0.027    0.979
compactness_se             537.52   22005.83   0.024    0.981
compactness_worst         -130.88   34031.57  -0.004    0.997
concave_points_mean        538.98   34397.58   0.016    0.987
concave_points_se          347.88   16817.30   0.021    0.983
concave_points_worst       -32.41   29127.43  -0.001    0.999
concavity_mean             452.60   34364.21   0.013    0.989
concavity_se              -464.10   21009.29  -0.022    0.982
concavity_worst            461.56   29012.29   0.016    0.987
fractal_dimension_mean     441.67   22878.54   0.019    0.985
fractal_dimension_se      -803.44   35348.09  -0.023    0.982
fractal_dimension_worst     36.81   22706.77   0.002    0.999
perimeter_mean             577.41  125345.81   0.005    0.996
perimeter_se              -628.13   31167.33  -0.020    0.984
perimeter_worst            -53.22   85923.85  -0.001    1.000
radius_mean              -3287.17  184474.29  -0.018    0.986
radius_se                  158.98   40696.27   0.004    0.997
radius_worst              5105.11  197081.97   0.026    0.979
smoothness_mean             77.36   12740.55   0.006    0.995
smoothness_se               17.27    7127.00   0.002    0.998
smoothness_worst           -53.56   13280.63  -0.004    0.997
symmetry_mean              -78.23    8201.80  -0.010    0.992
symmetry_se               -245.52   10115.26  -0.024    0.981
symmetry_worst             239.48   13681.56   0.018    0.986
texture_mean               223.12   12884.20   0.017    0.986
texture_se                 -25.41    6898.48  -0.004    0.997
texture_worst               33.00   10877.41   0.003    0.998

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6.0231e+02  on 455  degrees of freedom
Residual deviance: 2.9881e-06  on 425  degrees of freedom
AIC: 62

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
<p>En el resumen del modelo podemos ver el valor del estadístico AIC (62) y los coeficientes asociados a cada una de las predictoras consideradas. Para su interpretación debemos atender a las siguientes indicaciones:</p>
<ul>
<li>los coeficientes negativos reducen la probabilidad de ocurrencia de la categoría de interés (en este caso tumor maligno), mientras que los positivos aumentan la probabilidad de ocurrencia.</li>
<li>Cuanto mayor es el valor negativo o positivo asociado con el coeficiente mayor es la influencia de la predictora sobre la probabilidad de ocurrencia.</li>
</ul>
<p>En este caso tenemos coeficientes muy grandes tanto en signo negativo como positivo pero todos ellos resultan no significativos, debido seguramente a un efecto de confusión entre las predictoras. Esto suele ocurrir cuando consideramos un número muy elevado de predictoras y estas están relacionadas entre si. Como veremos más adelante existen diferentes formas de solucionar este problemas entre las que se encuentran: i) trabajar con un número de predictoras reducido, 2) reducir la información contenida en las predictoras mediante un algoritmo de reducción de la dimensión, 3) platear un algoritmo de clasificación distinto, 4) introducir penalización en los coeficientes para obtener un modelo más adecuado. Por el momento, vamos a analizar con más detalle esta solución y dejamos para más adelante cada una de las posibles soluciones.</p>
<p>En el gráfico siguiente podemos apreciar mejor el efecto de las diferentes predictoras sobre la respuesta. Para ello vamos a definir una función que nos permite representar los coeficientes, reutilizando el código del tema anterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Función para representar los coeficientes</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>plot_coef <span class="ot">=</span> <span class="cf">function</span>(mod)</span>
<span id="cb24-3"><a href="#cb24-3"></a>{</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="co"># mod: modelo utilizado</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="co"># Data frame con los coeficientes obtenidos y su codificación) positivo-negativo</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  coeficientes <span class="ot">=</span> <span class="fu">na.omit</span>(<span class="fu">as.data.frame</span>(mod<span class="sc">$</span>coefficients))</span>
<span id="cb24-7"><a href="#cb24-7"></a>  coeficientes <span class="ot">=</span> <span class="fu">rownames_to_column</span>(coeficientes)</span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="fu">colnames</span>(coeficientes) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Coef"</span>, <span class="st">"Estimate"</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a>  coeficientes<span class="sc">$</span>Value <span class="ot">=</span> <span class="fu">ifelse</span>(coeficientes<span class="sc">$</span>Estimate <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Positivo"</span>, <span class="st">"Negativo"</span>)</span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="co"># Gráfico de coeficientes</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">ggplot</span>(coeficientes, <span class="fu">aes</span>(Estimate, Coef, <span class="at">color =</span> Value)) <span class="sc">+</span> </span>
<span id="cb24-12"><a href="#cb24-12"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb24-15"><a href="#cb24-15"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Representamos la solución para nuestro modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">plot_coef</span>(modelo)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reglog-015" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/fig-reglog-015-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;7.4: Coeficientes del modelo de regresión logística. Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Pasamos a evaluar la capacidad predictiva de nuestro modelo a través de diferentes scores como son el porcentaje de clasificación correcto, el score de brier, las curvas ROC y el AUC. En primer lugar obtenemos los valores de la predicción tanto para la muestra de entrenamiento como de validación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Predicción de la muestra de entrenamiento y validación</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>pred_train <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_train_cancer)</span>
<span id="cb26-3"><a href="#cb26-3"></a>pred_test <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_test_cancer)</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co"># Visualizamos las primeras predicciones de la muestra de validación</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>pred_test</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 113 observations:
    row_ids truth response       prob.M       prob.B
         12     M        M 1.000000e+00 2.220446e-16
         21     B        B 2.220446e-16 1.000000e+00
         26     M        M 1.000000e+00 2.220446e-16
---                                                 
        550     B        B 2.220446e-16 1.000000e+00
        565     M        M 1.000000e+00 2.220446e-16
        567     M        M 1.000000e+00 2.220446e-16</code></pre>
</div>
</div>
<p>En la tabla anterior tenemos tanto la respuesta predicha según el modelo, como las probabilidades asociadas a cada una de las categorías. Podemos ver como la categoría que proporciona el modelo está asociada directamente con la probabilidad de ocurrencia de cada nivel del factor.</p>
<p>Evaluamos la capacidad de clasificación del modelo con diferentes scores:</p>
<ul>
<li><code>classif.acc</code> (porcentaje de clasificación correcta),</li>
<li><code>classif.bacc</code> (porcentaje de clasificación correcta ponderado para muestras no balanceadas),</li>
<li><code>classif.bbrier</code> (score de Brier para clasificaciones binarias),</li>
<li><code>classif.auc</code> (área bajo la curva ROC).</li>
</ul>
<p>Comenzamos obteniendo la matriz de confusión para la muestra de validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># matriz de confusión</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>pred_test<span class="sc">$</span>confusion</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response  M  B
       M 41  2
       B  1 69</code></pre>
</div>
</div>
<p>Podemos ver el alto grado de clasificación correcta que proporciona el modelo con solo 3 errores sobre todas las muestras de validación. Representamos gráficamente la matriz de confusión con todos los porcentajes involucrados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Cargamos la librería para representar la matriz de confusión</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>cm <span class="ot">=</span> <span class="fu">confusion_matrix</span>(pred_test<span class="sc">$</span>truth, pred_test<span class="sc">$</span>response)</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="fu">plot_confusion_matrix</span>(cm<span class="sc">$</span><span class="st">`</span><span class="at">Confusion Matrix</span><span class="st">`</span>[[<span class="dv">1</span>]]) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="70_LogisticModels_files/figure-html/reglog-0172-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Calculamos ahora los scores para ambas muestras.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># scores de validación</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.bacc"</span>, <span class="st">"classif.bbrier"</span>, <span class="st">"classif.auc"</span>))</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co"># Muestra de entrenamiento</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc   classif.bacc classif.bbrier    classif.auc 
  1.000000e+00   1.000000e+00   2.970536e-16   1.000000e+00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Muestra de validación</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc   classif.bacc classif.bbrier    classif.auc 
    0.97345133     0.97401073     0.02654867     0.97401073 </code></pre>
</div>
</div>
<p>Podemos ver que tenemos una clasificación perfecta en la muestra de entrenamiento, lo que puede ser debido a un problema de sobre estimación al considerar todas las predictoras sin eliminar las no relevantes. En cuanto a la muestra de validación tenemos valores similares con una pequeña disminución en el porcentaje de clasificación correcta.</p>
<p>Antes de continuar nos planteamos la posibilidad de seleccionar el conjunto de predictoras que están relacionadas más directamente con la respuesta. Para ello utilizamos un procedimiento de selección de características que identifica el mejor conjunto de ellas con respecto a un score de validación mediante un proceso iterativo. En concreto utilizamos el procedimiento <code>fselect()</code> y utilizamos el selector <code>fs</code> con las opciones <code>sequential</code> y estrategia de búsqueda hacia adelante (<code>sfs</code>). Se pueden consultar todas las opciones en este <a href="https://mlr-org.com/fselectors.html">enlace</a>.</p>
<p>A continuación se muestra el proceso de selección para este conjunto de datos donde utilizamos el porcentaje de clasificación correcta ponderado como criterio de selección. Para la validación utilizamos un objeto de remuestreo con división 80-20. El código se muestra a continuación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>instance <span class="ot">=</span> <span class="fu">fselect</span>(</span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="at">fselector =</span> <span class="fu">fs</span>(<span class="st">"sequential"</span>, <span class="at">strategy =</span> <span class="st">"sfs"</span>),</span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="at">task =</span> tsk_cancer,</span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="at">learner =</span> gr,</span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>),</span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.bacc"</span>),</span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="at">term_evals =</span> <span class="dv">10</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:54:27.911] [bbotk] Starting to optimize 30 parameter(s) with '&lt;FSelectorSequential&gt;' and '&lt;TerminatorEvals&gt; [n_evals=10, k=0]'
INFO  [17:54:27.956] [bbotk] Evaluating 30 configuration(s)
INFO  [17:54:28.113] [mlr3] Running benchmark with 30 resampling iterations
INFO  [17:54:28.170] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:28.318] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:28.541] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:28.675] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:28.818] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:28.982] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.132] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.269] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.387] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.526] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.647] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.766] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:29.897] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.063] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.209] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.339] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.495] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.629] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.762] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:30.906] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.060] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.201] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.330] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.471] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.598] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.725] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:31.882] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:32.011] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:32.144] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:32.260] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:32.396] [mlr3] Finished benchmark
INFO  [17:54:32.780] [bbotk] Result of batch 1:
INFO  [17:54:32.786] [bbotk]  area_mean area_se area_worst compactness_mean compactness_se compactness_worst
INFO  [17:54:32.786] [bbotk]       TRUE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE    TRUE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE       TRUE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE             TRUE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE           TRUE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE              TRUE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.786] [bbotk]  area_mean area_se area_worst compactness_mean compactness_se compactness_worst
INFO  [17:54:32.786] [bbotk]  concave_points_mean concave_points_se concave_points_worst concavity_mean
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                 TRUE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE              TRUE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                 TRUE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE           TRUE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.786] [bbotk]  concave_points_mean concave_points_se concave_points_worst concavity_mean
INFO  [17:54:32.786] [bbotk]  concavity_se concavity_worst fractal_dimension_mean fractal_dimension_se
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]          TRUE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE            TRUE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                   TRUE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                 TRUE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.786] [bbotk]  concavity_se concavity_worst fractal_dimension_mean fractal_dimension_se
INFO  [17:54:32.786] [bbotk]  fractal_dimension_worst perimeter_mean perimeter_se perimeter_worst
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                     TRUE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE           TRUE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE         TRUE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE            TRUE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]                    FALSE          FALSE        FALSE           FALSE
INFO  [17:54:32.786] [bbotk]  fractal_dimension_worst perimeter_mean perimeter_se perimeter_worst
INFO  [17:54:32.786] [bbotk]  radius_mean radius_se radius_worst smoothness_mean smoothness_se
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]         TRUE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE      TRUE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE         TRUE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE            TRUE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE          TRUE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.786] [bbotk]  radius_mean radius_se radius_worst smoothness_mean smoothness_se
INFO  [17:54:32.786] [bbotk]  smoothness_worst symmetry_mean symmetry_se symmetry_worst texture_mean
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]              TRUE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE          TRUE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE        TRUE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE           TRUE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE         TRUE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.786] [bbotk]  smoothness_worst symmetry_mean symmetry_se symmetry_worst texture_mean
INFO  [17:54:32.786] [bbotk]  texture_se texture_worst classif.bacc warnings errors runtime_learners
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9453387        0      0            0.135
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9502012        0      0            0.205
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9572435        0      0            0.120
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8246144        0      0            0.128
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5432596        0      0            0.146
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8527834        0      0            0.134
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9220322        0      0            0.112
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6130114        0      0            0.105
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9101274        0      0            0.126
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8933602        0      0            0.108
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5362173        0      0            0.107
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8884977        0      0            0.119
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5000000        0      0            0.151
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5000000        0      0            0.121
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6292757        0      0            0.115
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9263917        0      0            0.142
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8673709        0      0            0.119
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9691482        0      0            0.117
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9263917        0      0            0.131
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.8765929        0      0            0.139
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.9572435        0      0            0.129
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6562710        0      0            0.115
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5000000        0      0            0.128
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6514085        0      0            0.113
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6839370        0      0            0.113
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.5000000        0      0            0.142
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.7174715        0      0            0.116
INFO  [17:54:32.786] [bbotk]       FALSE         FALSE    0.6265929        0      0            0.121
INFO  [17:54:32.786] [bbotk]        TRUE         FALSE    0.5000000        0      0            0.103
INFO  [17:54:32.786] [bbotk]       FALSE          TRUE    0.7147887        0      0            0.115
INFO  [17:54:32.786] [bbotk]  texture_se texture_worst classif.bacc warnings errors runtime_learners
INFO  [17:54:32.786] [bbotk]                                 uhash
INFO  [17:54:32.786] [bbotk]  35ab26fd-e9b1-47f5-ab32-6a8d756ee4cb
INFO  [17:54:32.786] [bbotk]  f35c71ce-8eaa-4037-8886-99a3e7234305
INFO  [17:54:32.786] [bbotk]  f9fb4ca1-a8d7-4fe9-8e2b-6da1fa6f2f84
INFO  [17:54:32.786] [bbotk]  aab9ae2f-3693-47be-a07e-c9b6823ac0bb
INFO  [17:54:32.786] [bbotk]  9c5f719a-5f04-46d3-8334-8b72fdc3f2b7
INFO  [17:54:32.786] [bbotk]  65ca9aaa-7236-41ab-8bb9-941b3a12fb74
INFO  [17:54:32.786] [bbotk]  072ed682-2fb2-4eea-9f13-8d45a67d2391
INFO  [17:54:32.786] [bbotk]  b2aec738-649f-4f60-9c8a-9db15eb488b6
INFO  [17:54:32.786] [bbotk]  644e3a7f-b1c9-4477-bb1b-8f0345d1d02e
INFO  [17:54:32.786] [bbotk]  f8b9efb2-7dc3-42d7-9c5d-7f0a24ed1e87
INFO  [17:54:32.786] [bbotk]  f016bf16-e6d1-4b92-88ec-a8c879ae90d5
INFO  [17:54:32.786] [bbotk]  773b1639-59f8-4fb4-bd08-261b30dd81b0
INFO  [17:54:32.786] [bbotk]  c8cd53d6-9719-4ba5-b285-855aee7bfc18
INFO  [17:54:32.786] [bbotk]  12b0041a-346b-4d8a-a304-a134bf66d774
INFO  [17:54:32.786] [bbotk]  caf36a16-8d2d-4ac4-8065-580bc4986a28
INFO  [17:54:32.786] [bbotk]  4aae4d57-d3bb-45f1-8031-80ce58ab0254
INFO  [17:54:32.786] [bbotk]  8f1ab785-fc39-45ec-bc60-1ced01008fe2
INFO  [17:54:32.786] [bbotk]  cf2bcddb-a342-4dc3-8903-9efe321679dd
INFO  [17:54:32.786] [bbotk]  8f04cc21-1ccf-4046-a972-a64428040aa8
INFO  [17:54:32.786] [bbotk]  3f802c65-8c74-496b-b9bc-b24f9beb23de
INFO  [17:54:32.786] [bbotk]  15dabc6e-4ffd-41d9-a551-2fe4913928cc
INFO  [17:54:32.786] [bbotk]  e3cb6b1b-7dd9-4c9e-bd8a-db3dbbbbf1d9
INFO  [17:54:32.786] [bbotk]  d03c132c-a9ed-4b59-8d72-de5cc67ceb64
INFO  [17:54:32.786] [bbotk]  32257951-15b1-4a11-bf60-46a01ec822e7
INFO  [17:54:32.786] [bbotk]  48726633-4529-4ff4-928e-1c0e84657158
INFO  [17:54:32.786] [bbotk]  e1ed5ece-c65b-46db-a737-ffd2cacce2bf
INFO  [17:54:32.786] [bbotk]  3a877730-db6b-4639-9d0b-2fa5b7546d0e
INFO  [17:54:32.786] [bbotk]  b6c48f51-4708-41ee-a684-18f171274757
INFO  [17:54:32.786] [bbotk]  afa35c02-e63b-4083-8134-2dabde09f78d
INFO  [17:54:32.786] [bbotk]  83729b8f-3ef2-4d21-9bfd-62468bc15d5f
INFO  [17:54:32.786] [bbotk]                                 uhash
INFO  [17:54:32.795] [bbotk] Finished optimizing after 30 evaluation(s)
INFO  [17:54:32.796] [bbotk] Result:
INFO  [17:54:32.798] [bbotk]  area_mean area_se area_worst compactness_mean compactness_se compactness_worst
INFO  [17:54:32.798] [bbotk]      FALSE   FALSE      FALSE            FALSE          FALSE             FALSE
INFO  [17:54:32.798] [bbotk]  concave_points_mean concave_points_se concave_points_worst concavity_mean
INFO  [17:54:32.798] [bbotk]                FALSE             FALSE                FALSE          FALSE
INFO  [17:54:32.798] [bbotk]  concavity_se concavity_worst fractal_dimension_mean fractal_dimension_se
INFO  [17:54:32.798] [bbotk]         FALSE           FALSE                  FALSE                FALSE
INFO  [17:54:32.798] [bbotk]  fractal_dimension_worst perimeter_mean perimeter_se perimeter_worst
INFO  [17:54:32.798] [bbotk]                    FALSE          FALSE        FALSE            TRUE
INFO  [17:54:32.798] [bbotk]  radius_mean radius_se radius_worst smoothness_mean smoothness_se
INFO  [17:54:32.798] [bbotk]        FALSE     FALSE        FALSE           FALSE         FALSE
INFO  [17:54:32.798] [bbotk]  smoothness_worst symmetry_mean symmetry_se symmetry_worst texture_mean
INFO  [17:54:32.798] [bbotk]             FALSE         FALSE       FALSE          FALSE        FALSE
INFO  [17:54:32.798] [bbotk]  texture_se texture_worst        features classif.bacc
INFO  [17:54:32.798] [bbotk]       FALSE         FALSE perimeter_worst    0.9691482</code></pre>
</div>
</div>
<p>Podemos ver las variables seleccionadas y el score asociado con:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Variables seleccionas</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>instance<span class="sc">$</span>result_feature_set</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "perimeter_worst"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Score</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>instance<span class="sc">$</span>result_y</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.bacc 
   0.9691482 </code></pre>
</div>
</div>
<p>El proceso selecciona únicamente la variable <code>perimeter_worst</code> con un porcentaje de clasificación correcta ponderado del 96.91%. Ajustamos el nuevo modelo con esa única variable para lo que es necesario modificar la tarea. El código siguiente muestra todo ese proceso:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Creación de task seleccionando la predictora de interés</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>tsk_cancer2 <span class="ot">=</span> <span class="fu">as_task_classif</span>(breastcancer[<span class="fu">c</span>(<span class="st">"diagnosis"</span>, <span class="st">"perimeter_worst"</span>)], <span class="at">target =</span> <span class="st">"diagnosis"</span>, <span class="at">positive =</span> <span class="st">"M"</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="co"># Generamos variable de estrato</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>tsk_cancer2<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"diagnosis"</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co"># Fijamos semilla para asegurar la reproducibilidad del modelo</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co"># Creamos la partición</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>splits <span class="ot">=</span> mlr3<span class="sc">::</span><span class="fu">partition</span>(tsk_cancer2, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a><span class="co"># Muestras de entrenamiento y validación</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>tsk_train_cancer2 <span class="ot">=</span> tsk_cancer2<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>train)</span>
<span id="cb41-11"><a href="#cb41-11"></a>tsk_test_cancer2  <span class="ot">=</span> tsk_cancer2<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>test)</span>
<span id="cb41-12"><a href="#cb41-12"></a><span class="co"># Graphlearner: Preprocesado y learner</span></span>
<span id="cb41-13"><a href="#cb41-13"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb41-14"><a href="#cb41-14"></a>gr <span class="ot">=</span> pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb41-15"><a href="#cb41-15"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb41-16"><a href="#cb41-16"></a><span class="co"># Entrenamiento</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_cancer2)</span>
<span id="cb41-18"><a href="#cb41-18"></a><span class="co"># Resumen del modelo</span></span>
<span id="cb41-19"><a href="#cb41-19"></a>modelo <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.log_reg<span class="sc">$</span>model</span>
<span id="cb41-20"><a href="#cb41-20"></a><span class="fu">summary</span>(modelo)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::glm(formula = task$formula(), family = "binomial", data = data, 
    model = FALSE)

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -0.5693     0.1874  -3.038  0.00238 ** 
perimeter_worst   5.4145     0.5971   9.068  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 602.31  on 455  degrees of freedom
Residual deviance: 187.07  on 454  degrees of freedom
AIC: 191.07

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<p>Podemos ver como el modelo resulta significativo para la predictora de interés, mostrando además u efecto positivo, es decir, cuanto mayor es el valor de la predictora mayor es la probabilidad de que el tumor sea maligno. De hecho si <span class="math inline">\(p_i\)</span> es la probabilidad de que el tumor sea clasificado como maligno la ecuación del modelo viene dada por la expresión:</p>
<p><span class="math display">\[log\left(\frac{p_i}{1-p_i}\right) = -0.5693 + 5.4145 * \text{perimeter_worst}_{estandarizada}\]</span> donde <span class="math inline">\(\text{perimeter_worst}_{estandarizada}\)</span> es la variable estandarizada. Evaluamos ahora el modelo obteniendo los scores asociados a las muestras de entrenamiento y validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Predicción de la muestra de entrenamiento y validación</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>pred_train <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_train_cancer2)</span>
<span id="cb43-3"><a href="#cb43-3"></a>pred_test <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_test_cancer2)</span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co"># Scores</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc   classif.bacc classif.bbrier    classif.auc 
    0.90789474     0.89555738     0.06304534     0.96980666 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc   classif.bacc classif.bbrier    classif.auc 
    0.96460177     0.96210597     0.02695919     0.99362844 </code></pre>
</div>
</div>
<p>Comparando los resultados con los del modelo con todas las predictoras tenemos unos resultados bastante sorprendentes, ya que con un única predictora alcanzamos un porcentaje de clasificación correcta del 90% para la muestra de entrenamiento y del 96% para la muestra de validación. Esto nos da un indicativo de que le modelo anterior estaba sobreajustado. Si embargo, reducir el conjunto de predictoras a una única puede resultar excesivo y más adelante veremos otro tipo de técnicas para no perder la información de todas las posibles predictoras. Pasamos a validar el modelo mediante un proceso de validación cruzada similar a los del tema anterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Fijamos semilla</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co"># Definimos proceso de validación cruzada kfold con k=10</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>resamp <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">10</span>)</span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co"># Remuestreo</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>rr <span class="ot">=</span> <span class="fu">resample</span>(tsk_cancer2, gr, resamp, <span class="at">store_models=</span><span class="cn">TRUE</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:54:33.273] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:33.429] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:33.564] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:33.713] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:33.860] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:34.070] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:34.187] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:34.315] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:34.430] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:34.559] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Análisis de los valores obtenidos con los scores definidos anteriormente</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="fu">skim</span>(rr<span class="sc">$</span><span class="fu">score</span>(measures))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">rr$score(measures)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Key</td>
<td style="text-align: left;">NULL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">character</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">list</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">task_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">learner_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">resampling_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: list</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">min_length</th>
<th style="text-align: right;">max_length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">task</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: left;">learner</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">resampling</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">prediction</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">iteration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.50</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">5.50</td>
<td style="text-align: right;">7.75</td>
<td style="text-align: right;">10.00</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">classif.acc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: left;">▂▂▂▇▆</td>
</tr>
<tr class="odd">
<td style="text-align: left;">classif.bacc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: left;">▅▁▇▇▅</td>
</tr>
<tr class="even">
<td style="text-align: left;">classif.bbrier</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">▇▃▃▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">classif.auc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">▃▃▁▂▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>En todos los scores considerados hay poca variabilidad mostrado que la solución propuesta es bastante estable. De hecho, podemos ver que el porcentaje de clasificación correcta promedio se sitúa en el 91%. Podemos representar gráficamente la curva ROC asociada a nuestra tarea de clasificación con el objeto de analizar la estabilidad de la solución.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">autoplot</span>(rr, <span class="at">type =</span> <span class="st">"roc"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reglog-024" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/fig-reglog-024-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figura&nbsp;7.5: Estimación por remuestreo de la curva ROC . Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La curva se acerca al extremo superior alejándose de la diagonal indicando que el clasificador obtenido resulta muy adecuado. Para finalizar vamos a obtener la curva de aprendizaje asociada con este modelo. Para ello debemos cargar las funciones que definimos en el tema anterior.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">plot_learningcurve</span>(tsk_cancer2, gr, <span class="st">"classif.bacc"</span>, <span class="at">ptr =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>), <span class="at">rpeats =</span> <span class="dv">10</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:54:35.757] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:35.927] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:36.155] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:36.379] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:36.958] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:37.174] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:37.364] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:37.555] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:37.738] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:37.934] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:38.237] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:38.435] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:38.665] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:38.871] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:39.085] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:39.278] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:39.473] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:39.660] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:39.866] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:40.066] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:40.368] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:40.557] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:40.740] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:40.912] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:41.101] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:41.262] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:41.438] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:41.597] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:41.789] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:41.963] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:42.272] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:42.434] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:42.620] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:42.790] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:42.976] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:43.143] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:43.322] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:43.482] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:43.660] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:43.826] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:44.097] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:44.272] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:44.434] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:44.609] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:44.773] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:45.306] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:45.467] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:45.631] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:45.895] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:46.216] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:46.555] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:46.739] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:46.911] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:47.075] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:47.242] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:47.452] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:47.613] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:47.811] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:48.040] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:48.201] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:48.465] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:48.656] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:48.844] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:49.025] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:49.189] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:49.363] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:49.548] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:49.711] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:49.885] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:50.070] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:50.319] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:50.488] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:50.723] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:50.900] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:51.066] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:51.248] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:51.411] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:51.575] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:51.754] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:51.924] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)
INFO  [17:54:52.191] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 1/10)
INFO  [17:54:52.368] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 2/10)
INFO  [17:54:52.531] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 3/10)
INFO  [17:54:52.699] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 4/10)
INFO  [17:54:52.886] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 5/10)
INFO  [17:54:53.050] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 6/10)
INFO  [17:54:53.234] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 7/10)
INFO  [17:54:53.398] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 8/10)
INFO  [17:54:53.562] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 9/10)
INFO  [17:54:53.744] [mlr3] Applying learner 'scale.classif.log_reg' on task 'breastcancer[c("diagnosis", "perimeter_worst")]' (iter 10/10)</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/reglog-026-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Curva de aprendizaje. Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Como se puede ver el tamaño óptimo para la muestra de entrenamiento se podría situar entre el 60% y el 70%.</p>
</section>
<section id="sec-70.4.2" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="sec-70.4.2"><span class="header-section-number">7.4.2</span> Datos iris</h3>
<p>Definimos el preprocesado vinculado a este conjunto de datos (estandarización de predictoras numéricas), y preparamos la muestra de entrenamiento y validación.</p>
<p>Herramienta de preprocesado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># preprocesado</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>pp_iris <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">param_vals =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Establecemos el estrato en función de la respuesta antes de realizar las divisiones de muestra de entrenamiento y validación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Generamos variable de estrato</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>tsk_iris<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"species"</span></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="co"># Fijamos semilla para asegurar la reproducibilidad del modelo</span></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb54-5"><a href="#cb54-5"></a><span class="co"># Creamos la partición</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>splits <span class="ot">=</span> mlr3<span class="sc">::</span><span class="fu">partition</span>(tsk_iris, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="co"># Muestras de entrenamiento y validación</span></span>
<span id="cb54-8"><a href="#cb54-8"></a>tsk_train_iris <span class="ot">=</span> tsk_iris<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>train)</span>
<span id="cb54-9"><a href="#cb54-9"></a>tsk_test_iris  <span class="ot">=</span> tsk_iris<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>test)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora podemos comenzar el proceso de aprendizaje asociado con este modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Definimos learner para predecir la probabilidad</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.multinom"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># Graphlearner: Preprocesado y learner</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>gr <span class="ot">=</span> pp_iris <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb55-5"><a href="#cb55-5"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos comenzar ahora con el entrenamiento del modelo y su interpretación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Entrenamiento</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_iris)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  18 (10 variable)
initial  value 131.833475 
iter  10 value 10.994243
iter  20 value 1.458573
iter  30 value 0.260241
iter  40 value 0.155686
iter  50 value 0.131700
iter  60 value 0.106444
iter  70 value 0.104300
iter  80 value 0.101794
iter  90 value 0.094495
iter 100 value 0.092939
final  value 0.092939 
stopped after 100 iterations</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Resumen del modelo</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>modelo <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.multinom<span class="sc">$</span>model</span>
<span id="cb58-3"><a href="#cb58-3"></a>modelo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
nnet::multinom(formula = species ~ ., data = task$data())

Coefficients:
                (Intercept) petal_length petal_width sepal_length sepal_width
Iris-versicolor    61.34338      51.0178    44.87509    -21.33789   -3.784367
Iris-virginica   -121.31870     257.5752   137.67151    -46.55536  -23.152353

Residual Deviance: 0.1858771 
AIC: 20.18588 </code></pre>
</div>
</div>
<p>Como era de esperar los coeficientes asociados con <code>petal_length</code> y <code>petal_width</code> so los que presentan valores más grandes. Podemos ver además que cuanto mayores son esos valores más fácil es que clasifiquemos la muestra como <code>Iris-virginica</code>. Antes de proceder con un modelo más sencillo vamos a estudiar la capacidad de clasificación de este modelo. Para ello obtenemos las predicciones de la muestra de entrenamiento y validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Predicción de la muestra de entrenamiento y validación</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>pred_train <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_train_iris)</span>
<span id="cb60-3"><a href="#cb60-3"></a>pred_test <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_test_iris)</span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co"># Visualizamos las primeras predicciones de la muestra de validación</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>pred_test</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 30 observations:
    row_ids          truth       response prob.Iris-setosa prob.Iris-versicolor
         15    Iris-setosa    Iris-setosa     1.000000e+00         1.830158e-35
         16    Iris-setosa    Iris-setosa     1.000000e+00         2.482010e-27
         18    Iris-setosa    Iris-setosa     1.000000e+00         1.065164e-20
---                                                                            
        147 Iris-virginica Iris-virginica     1.696644e-81         6.989337e-25
        148 Iris-virginica Iris-virginica     7.623387e-84         1.510832e-26
        150 Iris-virginica Iris-virginica     2.901361e-76         9.370432e-19
    prob.Iris-virginica
          7.954259e-319
          1.048209e-292
          1.090171e-268
---                    
           1.000000e+00
           1.000000e+00
           1.000000e+00</code></pre>
</div>
</div>
<p>En la tabla anterior podemos ver la categoría en la que clasifica cada muestra el modelo y las probabilidades asociadas a cada uno de los niveles de la respuesta. Veamos la matriz de confusión para la muestra de validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># matriz de confusión</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>pred_test<span class="sc">$</span>confusion</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 truth
response          Iris-setosa Iris-versicolor Iris-virginica
  Iris-setosa              10               0              0
  Iris-versicolor           0               9              0
  Iris-virginica            0               1             10</code></pre>
</div>
</div>
<p>Podemos ver el alto grado de clasificación correcta que proporciona el modelo con solo 1 error sobre todas las muestras de validación. Calculamos los scores para ambas muestras. En este caso utilizamos el porcentaje de clasificación correcta y el score de brier para problemas con múltiples categorías.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># scores de validación</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.mbrier"</span>))</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co"># Muestra de entrenamiento</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc classif.mbrier 
  1.000000e+00   3.351533e-05 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Muestra de validación</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc classif.mbrier 
    0.96666667     0.06666667 </code></pre>
</div>
</div>
<p>Obtenemos un porcentaje de clasificación correcta para la muestra de validación del 96.67% lo que demuestra que el modelo de aprendizaje propuesto funciona adecuadamente. Aunque podríamos plantear un proceso de selección de variables, con toda la información hasta ahora vamos a plantear un modelo con las variables de pétalo y estudiar su capacidad de clasificación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Creación de task seleccionando la predictora de interés</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>tsk_iris2 <span class="ot">=</span> <span class="fu">as_task_classif</span>(iris[<span class="fu">c</span>(<span class="st">"species"</span>, <span class="st">"petal_length"</span>, <span class="st">"petal_width"</span>)], <span class="at">target =</span> <span class="st">"species"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="co"># Generamos variable de estrato</span></span>
<span id="cb68-4"><a href="#cb68-4"></a>tsk_iris2<span class="sc">$</span>col_roles<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="st">"species"</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="co"># Fijamos semilla para asegurar la reproducibilidad del modelo</span></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="fu">set.seed</span>(<span class="dv">135</span>)</span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="co"># Creamos la partición</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>splits <span class="ot">=</span> mlr3<span class="sc">::</span><span class="fu">partition</span>(tsk_iris2, <span class="at">ratio =</span> <span class="fl">0.8</span>)</span>
<span id="cb68-9"><a href="#cb68-9"></a><span class="co"># Muestras de entrenamiento y validación</span></span>
<span id="cb68-10"><a href="#cb68-10"></a>tsk_train_iris2 <span class="ot">=</span> tsk_iris2<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>train)</span>
<span id="cb68-11"><a href="#cb68-11"></a>tsk_test_iris2  <span class="ot">=</span> tsk_iris2<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(splits<span class="sc">$</span>test)</span>
<span id="cb68-12"><a href="#cb68-12"></a><span class="co"># Graphlearner: Preprocesado y learner</span></span>
<span id="cb68-13"><a href="#cb68-13"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.multinom"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb68-14"><a href="#cb68-14"></a>gr <span class="ot">=</span> pp_iris <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb68-15"><a href="#cb68-15"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb68-16"><a href="#cb68-16"></a><span class="co"># Entrenamiento</span></span>
<span id="cb68-17"><a href="#cb68-17"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_iris2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  12 (6 variable)
initial  value 131.833475 
iter  10 value 8.469047
iter  20 value 7.352470
iter  30 value 7.290925
iter  40 value 7.282925
iter  50 value 7.273208
iter  60 value 7.271514
iter  70 value 7.271445
iter  80 value 7.271434
iter  90 value 7.271408
final  value 7.271313 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Resumen del modelo</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>modelo <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.multinom<span class="sc">$</span>model</span>
<span id="cb70-3"><a href="#cb70-3"></a>modelo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
nnet::multinom(formula = species ~ ., data = task$data())

Coefficients:
                (Intercept) petal_length petal_width
Iris-versicolor   16.813857     18.18722     6.66505
Iris-virginica     6.453382     26.24143    15.86914

Residual Deviance: 14.54263 
AIC: 26.54263 </code></pre>
</div>
</div>
<p>Evaluamos la capacidad de clasificación de este modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Predicción de la muestra de entrenamiento y validación</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>pred_train <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_train_iris2)</span>
<span id="cb72-3"><a href="#cb72-3"></a>pred_test <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(tsk_test_iris2)</span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="co"># scores de validación</span></span>
<span id="cb72-5"><a href="#cb72-5"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.mbrier"</span>))</span>
<span id="cb72-6"><a href="#cb72-6"></a><span class="co"># valoración</span></span>
<span id="cb72-7"><a href="#cb72-7"></a>pred_train<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc classif.mbrier 
     0.9666667      0.0412616 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>pred_test<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.acc classif.mbrier 
    0.93333333     0.08086887 </code></pre>
</div>
</div>
<p>Para este modelo tenemos un porcentaje de clasificación correcta del 93.3% para la muestra de validación frente al 96.67% del modelo anterior. Perdemos solo un 3% al quitar dos posibles variables predictoras lo que podemos considerar como aceptable si queremos un modelo que seleccione pocas predictoras. Podemos finalizar el análisis de este modelo con un estudio de remuestreo y la construcción de la curva de aprendizaje. Esta tarea se deja como ejercicio.</p>
</section>
<section id="sec-70.4.3" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="sec-70.4.3"><span class="header-section-number">7.4.3</span> Actualizando los modelos</h3>
<p>Como hicimos en el tema anterior, tratamos de mejorar el modelo del punto anterior introduciendo penalización sobre los coeficientes del modelo. En concreto utilizamos el proceso de optimización de <span class="math inline">\(\alpha\)</span> del tema anterior adaptado a los problemas de clasificación tratados en este punto. para hacer esto hacemos uso del learner <code>classif.cv_glmnet</code> y <code>classif.glmnet</code> indicando que estamos en un modelo logístico.</p>
<section id="datos-breast-cancer" class="level4" data-number="7.4.3.1">
<h4 data-number="7.4.3.1" class="anchored" data-anchor-id="datos-breast-cancer"><span class="header-section-number">7.4.3.1</span> Datos Breast Cancer</h4>
<p>Definimos el proceso de aprendizaje mediante el algoritmo de validación cruzada para encontrar el valor óptimo de <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co"># Algoritmo de aprendizaje </span></span>
<span id="cb76-3"><a href="#cb76-3"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">type.logistic =</span> <span class="st">"Newton"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb76-4"><a href="#cb76-4"></a>              <span class="at">alpha =</span> <span class="fu">to_tune</span>(<span class="fl">1e-10</span>, <span class="dv">1</span>))</span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb76-7"><a href="#cb76-7"></a>gr <span class="ot">=</span>  pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb76-8"><a href="#cb76-8"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb76-9"><a href="#cb76-9"></a><span class="co"># Definimos instancia de optimización</span></span>
<span id="cb76-10"><a href="#cb76-10"></a>instance <span class="ot">=</span> <span class="fu">ti</span>(</span>
<span id="cb76-11"><a href="#cb76-11"></a>  <span class="at">task =</span> tsk_cancer,</span>
<span id="cb76-12"><a href="#cb76-12"></a>  <span class="at">learner =</span> gr,</span>
<span id="cb76-13"><a href="#cb76-13"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>),</span>
<span id="cb76-14"><a href="#cb76-14"></a>  <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>),</span>
<span id="cb76-15"><a href="#cb76-15"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">15</span>)</span>
<span id="cb76-16"><a href="#cb76-16"></a>)</span>
<span id="cb76-17"><a href="#cb76-17"></a><span class="co"># Tipo de optimizador</span></span>
<span id="cb76-18"><a href="#cb76-18"></a>tuner <span class="ot">=</span> <span class="fu">tnr</span>(<span class="st">"random_search"</span>)</span>
<span id="cb76-19"><a href="#cb76-19"></a><span class="co"># Proceso de optimización</span></span>
<span id="cb76-20"><a href="#cb76-20"></a>tuner<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:54:55.913] [bbotk] Starting to optimize 1 parameter(s) with '&lt;OptimizerRandomSearch&gt;' and '&lt;TerminatorEvals&gt; [n_evals=15, k=0]'
INFO  [17:54:55.921] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:55.967] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:55.974] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:56.793] [mlr3] Finished benchmark
INFO  [17:54:56.825] [bbotk] Result of batch 1:
INFO  [17:54:56.827] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:56.827] [bbotk]                0.9465745   0.9823009        0      0            0.751
INFO  [17:54:56.827] [bbotk]                                 uhash
INFO  [17:54:56.827] [bbotk]  dd0d99b1-9884-4ab2-961a-3b7bbb76cc05
INFO  [17:54:56.832] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:56.880] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:56.886] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:57.274] [mlr3] Finished benchmark
INFO  [17:54:57.323] [bbotk] Result of batch 2:
INFO  [17:54:57.325] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:57.325] [bbotk]               0.08194529           1        0      0            0.377
INFO  [17:54:57.325] [bbotk]                                 uhash
INFO  [17:54:57.325] [bbotk]  be4fb8fb-e7f5-4788-a0aa-2cfabd957b56
INFO  [17:54:57.330] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:57.375] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:57.382] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:57.754] [mlr3] Finished benchmark
INFO  [17:54:57.791] [bbotk] Result of batch 3:
INFO  [17:54:57.793] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:57.793] [bbotk]               0.01887609           1        0      0            0.362
INFO  [17:54:57.793] [bbotk]                                 uhash
INFO  [17:54:57.793] [bbotk]  fae2f056-eab3-47ff-918c-9816dff5f142
INFO  [17:54:57.797] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:57.849] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:57.856] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:58.411] [mlr3] Finished benchmark
INFO  [17:54:58.443] [bbotk] Result of batch 4:
INFO  [17:54:58.444] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:58.444] [bbotk]                0.6223626           1        0      0            0.545
INFO  [17:54:58.444] [bbotk]                                 uhash
INFO  [17:54:58.444] [bbotk]  77c4946b-b5a9-495a-9cf5-d2e1ac526417
INFO  [17:54:58.447] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:58.491] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:58.497] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:59.129] [mlr3] Finished benchmark
INFO  [17:54:59.161] [bbotk] Result of batch 5:
INFO  [17:54:59.163] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:59.163] [bbotk]                0.8763153   0.9734513        0      0            0.622
INFO  [17:54:59.163] [bbotk]                                 uhash
INFO  [17:54:59.163] [bbotk]  6da32ea7-86ec-46b2-b9ed-1009ac35a2b9
INFO  [17:54:59.166] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:59.209] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:59.216] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:54:59.646] [mlr3] Finished benchmark
INFO  [17:54:59.680] [bbotk] Result of batch 6:
INFO  [17:54:59.682] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:54:59.682] [bbotk]                 0.296863           1        0      0            0.422
INFO  [17:54:59.682] [bbotk]                                 uhash
INFO  [17:54:59.682] [bbotk]  2348b5d0-e46a-430a-bff0-a00d2101ec6a
INFO  [17:54:59.686] [bbotk] Evaluating 1 configuration(s)
INFO  [17:54:59.728] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:54:59.735] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:00.430] [mlr3] Finished benchmark
INFO  [17:55:00.466] [bbotk] Result of batch 7:
INFO  [17:55:00.468] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:00.468] [bbotk]                0.9421247   0.9734513        0      0            0.684
INFO  [17:55:00.468] [bbotk]                                 uhash
INFO  [17:55:00.468] [bbotk]  4f32c02b-0a7d-4eb1-95a7-657b7650c37c
INFO  [17:55:00.471] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:00.517] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:00.524] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:01.096] [mlr3] Finished benchmark
INFO  [17:55:01.132] [bbotk] Result of batch 8:
INFO  [17:55:01.133] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:01.133] [bbotk]                 0.734974           1        0      0            0.561
INFO  [17:55:01.133] [bbotk]                                 uhash
INFO  [17:55:01.133] [bbotk]  b504ea4c-b0f8-45b9-b756-b6a540f1bb97
INFO  [17:55:01.137] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:01.183] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:01.189] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:01.603] [mlr3] Finished benchmark
INFO  [17:55:01.636] [bbotk] Result of batch 9:
INFO  [17:55:01.638] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:01.638] [bbotk]                0.2421076           1        0      0            0.405
INFO  [17:55:01.638] [bbotk]                                 uhash
INFO  [17:55:01.638] [bbotk]  ea746dc0-12a8-49c9-b736-5a1e8a076351
INFO  [17:55:01.641] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:01.685] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:01.692] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:02.254] [mlr3] Finished benchmark
INFO  [17:55:02.292] [bbotk] Result of batch 10:
INFO  [17:55:02.294] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:02.294] [bbotk]                0.7850792   0.9823009        0      0            0.552
INFO  [17:55:02.294] [bbotk]                                 uhash
INFO  [17:55:02.294] [bbotk]  332049ce-b42f-4a43-b0cc-9386ad039368
INFO  [17:55:02.298] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:02.341] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:02.348] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:02.991] [mlr3] Finished benchmark
INFO  [17:55:03.023] [bbotk] Result of batch 11:
INFO  [17:55:03.025] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:03.025] [bbotk]                0.9245107   0.9823009        0      0            0.633
INFO  [17:55:03.025] [bbotk]                                 uhash
INFO  [17:55:03.025] [bbotk]  bc4e73e8-af95-4b89-a1a7-a84325968dfb
INFO  [17:55:03.029] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:03.072] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:03.079] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:03.437] [mlr3] Finished benchmark
INFO  [17:55:03.471] [bbotk] Result of batch 12:
INFO  [17:55:03.473] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:03.473] [bbotk]               0.07095276           1        0      0            0.349
INFO  [17:55:03.473] [bbotk]                                 uhash
INFO  [17:55:03.473] [bbotk]  dcd856a6-1ecc-4f66-bded-4ddfd53f23ef
INFO  [17:55:03.477] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:03.522] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:03.529] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:04.285] [mlr3] Finished benchmark
INFO  [17:55:04.318] [bbotk] Result of batch 13:
INFO  [17:55:04.320] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:04.320] [bbotk]                0.9846512   0.9823009        0      0            0.747
INFO  [17:55:04.320] [bbotk]                                 uhash
INFO  [17:55:04.320] [bbotk]  8cf5f503-055e-4236-8d76-04d4a77a030c
INFO  [17:55:04.323] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:04.368] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:04.374] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:05.138] [mlr3] Finished benchmark
INFO  [17:55:05.169] [bbotk] Result of batch 14:
INFO  [17:55:05.171] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:05.171] [bbotk]                0.4820736           1        0      0            0.754
INFO  [17:55:05.171] [bbotk]                                 uhash
INFO  [17:55:05.171] [bbotk]  bb742ada-8196-4f1f-8f6b-b56580f1716b
INFO  [17:55:05.174] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:05.217] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:05.224] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'breastcancer[, -1]' (iter 1/1)
INFO  [17:55:05.676] [mlr3] Finished benchmark
INFO  [17:55:05.712] [bbotk] Result of batch 15:
INFO  [17:55:05.714] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:05.714] [bbotk]                0.3840564           1        0      0            0.442
INFO  [17:55:05.714] [bbotk]                                 uhash
INFO  [17:55:05.714] [bbotk]  6617efc1-4dde-41be-a7e8-48754c5bae9f
INFO  [17:55:05.724] [bbotk] Finished optimizing after 15 evaluation(s)
INFO  [17:55:05.725] [bbotk] Result:
INFO  [17:55:05.726] [bbotk]  classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
INFO  [17:55:05.726] [bbotk]               0.08194529          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
1:              0.08194529          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Resultado</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>instance<span class="sc">$</span>result</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
1:              0.08194529          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
</div>
<p>El proceso de optimización nos da un <span class="math inline">\(\alpha\)</span> de 0.081945293 con un porcentaje de clasificación correcta del 100%. Utilizamos este valor para obtener el modelo definitivo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="fu">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="co"># Algoritmo de aprendizaje </span></span>
<span id="cb81-3"><a href="#cb81-3"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.glmnet"</span>, <span class="at">type.logistic =</span> <span class="st">"Newton"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-4"><a href="#cb81-4"></a>              <span class="at">alpha =</span> instance<span class="sc">$</span>result<span class="sc">$</span>classif.cv_glmnet.alpha)</span>
<span id="cb81-5"><a href="#cb81-5"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb81-7"><a href="#cb81-7"></a>gr <span class="ot">=</span>  pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb81-8"><a href="#cb81-8"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb81-10"><a href="#cb81-10"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_cancer)</span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="co"># Modelo obtenido para todos los lambda</span></span>
<span id="cb81-12"><a href="#cb81-12"></a>modelo_AA <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.glmnet<span class="sc">$</span>model</span>
<span id="cb81-13"><a href="#cb81-13"></a><span class="co"># Lambda óptimo</span></span>
<span id="cb81-14"><a href="#cb81-14"></a>lmin <span class="ot">=</span> modelo_AA<span class="sc">$</span>lambda[<span class="dv">100</span>]</span>
<span id="cb81-15"><a href="#cb81-15"></a><span class="do">##############################################</span></span>
<span id="cb81-16"><a href="#cb81-16"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.glmnet"</span>, <span class="at">type.logistic =</span> <span class="st">"Newton"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>, </span>
<span id="cb81-17"><a href="#cb81-17"></a>              <span class="at">alpha =</span> instance<span class="sc">$</span>result<span class="sc">$</span>classif.cv_glmnet.alpha, </span>
<span id="cb81-18"><a href="#cb81-18"></a>              <span class="at">lambda =</span> lmin)</span>
<span id="cb81-19"><a href="#cb81-19"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb81-20"><a href="#cb81-20"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb81-21"><a href="#cb81-21"></a>gr <span class="ot">=</span>  pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb81-22"><a href="#cb81-22"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb81-23"><a href="#cb81-23"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb81-24"><a href="#cb81-24"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_cancer)</span>
<span id="cb81-25"><a href="#cb81-25"></a><span class="co"># Modelo resultante</span></span>
<span id="cb81-26"><a href="#cb81-26"></a>modelo_glmnet_AA <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.glmnet<span class="sc">$</span>model</span>
<span id="cb81-27"><a href="#cb81-27"></a>modelo_glmnet_AA</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  (if (cv) glmnet::cv.glmnet else glmnet::glmnet)(x = data, y = target,      family = "binomial", alpha = 0.0819452890181685, lambda = 0.000463893969288626,      standardize = FALSE, type.logistic = "Newton") 

  Df %Dev    Lambda
1 29 93.1 0.0004639</code></pre>
</div>
</div>
<p>El modelo considera 29 predictoras con un porcentaje de clasificación correcta del 95.77% que es salgo superior al el modelo sin penalización. Podemos apreciar el efecto de cada predictor en el gráfico siguiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Data frame con los coeficientes obtenidos y su codificación) positivo-negativo quitando intercept</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>coeficientes <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">as.matrix</span>(modelo_glmnet_AA<span class="sc">$</span>beta))</span>
<span id="cb83-3"><a href="#cb83-3"></a>coeficientes <span class="ot">=</span> <span class="fu">rownames_to_column</span>(coeficientes)</span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="fu">colnames</span>(coeficientes) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Coef"</span>, <span class="st">"Estimate"</span>)</span>
<span id="cb83-5"><a href="#cb83-5"></a>coeficientes<span class="sc">$</span>Value <span class="ot">=</span> <span class="fu">ifelse</span>(coeficientes<span class="sc">$</span>Estimate <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Positivo"</span>, <span class="st">"Negativo"</span>)</span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="co"># Gráfico de coeficientes</span></span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="fu">ggplot</span>(coeficientes, <span class="fu">aes</span>(Estimate, Coef, <span class="at">color =</span> Value)) <span class="sc">+</span> </span>
<span id="cb83-8"><a href="#cb83-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb83-9"><a href="#cb83-9"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/reglog-039-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Coeficientes del modelo actualizado. Task Breast Cancer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Apreciamos claramente los coeficientes que contribuyen al aumento de la probabilidad de clasificación como maligno (puntos en azul) frente a los que no (puntos en rojo).</p>
</section>
<section id="datos-iris" class="level4" data-number="7.4.3.2">
<h4 data-number="7.4.3.2" class="anchored" data-anchor-id="datos-iris"><span class="header-section-number">7.4.3.2</span> Datos iris</h4>
<p>Definimos el proceso de aprendizaje mediante el algoritmo de validación cruzada para encontrar el valor óptimo de <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="fu">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="co"># Algoritmo de aprendizaje </span></span>
<span id="cb84-3"><a href="#cb84-3"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.cv_glmnet"</span>, <span class="at">type.multinomial =</span> <span class="st">"ungrouped"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb84-4"><a href="#cb84-4"></a>              <span class="at">alpha =</span> <span class="fu">to_tune</span>(<span class="fl">1e-10</span>, <span class="dv">1</span>))</span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb84-7"><a href="#cb84-7"></a>gr <span class="ot">=</span>  pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb84-8"><a href="#cb84-8"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb84-9"><a href="#cb84-9"></a><span class="co"># Definimos instancia de optimización</span></span>
<span id="cb84-10"><a href="#cb84-10"></a>instance <span class="ot">=</span> <span class="fu">ti</span>(</span>
<span id="cb84-11"><a href="#cb84-11"></a>  <span class="at">task =</span> tsk_iris,</span>
<span id="cb84-12"><a href="#cb84-12"></a>  <span class="at">learner =</span> gr,</span>
<span id="cb84-13"><a href="#cb84-13"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>),</span>
<span id="cb84-14"><a href="#cb84-14"></a>  <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>),</span>
<span id="cb84-15"><a href="#cb84-15"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">15</span>)</span>
<span id="cb84-16"><a href="#cb84-16"></a>)</span>
<span id="cb84-17"><a href="#cb84-17"></a><span class="co"># Tipo de optimizador</span></span>
<span id="cb84-18"><a href="#cb84-18"></a>tuner <span class="ot">=</span> <span class="fu">tnr</span>(<span class="st">"random_search"</span>)</span>
<span id="cb84-19"><a href="#cb84-19"></a><span class="co"># Proceso de optimización</span></span>
<span id="cb84-20"><a href="#cb84-20"></a>tuner<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO  [17:55:07.203] [bbotk] Starting to optimize 1 parameter(s) with '&lt;OptimizerRandomSearch&gt;' and '&lt;TerminatorEvals&gt; [n_evals=15, k=0]'
INFO  [17:55:07.212] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:07.255] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:07.262] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:07.667] [mlr3] Finished benchmark
INFO  [17:55:07.696] [bbotk] Result of batch 1:
INFO  [17:55:07.697] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:07.697] [bbotk]                0.7946393           1        0      0            0.398
INFO  [17:55:07.697] [bbotk]                                 uhash
INFO  [17:55:07.697] [bbotk]  8fa2f06b-c3a9-4aa8-ad71-3beb299225db
INFO  [17:55:07.701] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:07.743] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:07.750] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:08.123] [mlr3] Finished benchmark
INFO  [17:55:08.158] [bbotk] Result of batch 2:
INFO  [17:55:08.160] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:08.160] [bbotk]                0.2701054           1        0      0            0.365
INFO  [17:55:08.160] [bbotk]                                 uhash
INFO  [17:55:08.160] [bbotk]  b7b932a8-e65c-46ec-8238-8d5311adc608
INFO  [17:55:08.164] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:08.207] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:08.214] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:08.645] [mlr3] Finished benchmark
INFO  [17:55:08.683] [bbotk] Result of batch 3:
INFO  [17:55:08.685] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:08.685] [bbotk]                0.3366187           1        0      0             0.42
INFO  [17:55:08.685] [bbotk]                                 uhash
INFO  [17:55:08.685] [bbotk]  75dbdfc7-902a-4f23-863d-3c559e538c21
INFO  [17:55:08.689] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:08.738] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:08.745] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:09.212] [mlr3] Finished benchmark
INFO  [17:55:09.248] [bbotk] Result of batch 4:
INFO  [17:55:09.250] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:09.250] [bbotk]                0.9559843   0.9666667        0      0            0.458
INFO  [17:55:09.250] [bbotk]                                 uhash
INFO  [17:55:09.250] [bbotk]  ccd9b8b0-f9ee-4fee-9375-13b934a26e63
INFO  [17:55:09.253] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:09.303] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:09.312] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:09.689] [mlr3] Finished benchmark
INFO  [17:55:09.722] [bbotk] Result of batch 5:
INFO  [17:55:09.723] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:09.723] [bbotk]                0.1747555           1        0      0            0.353
INFO  [17:55:09.723] [bbotk]                                 uhash
INFO  [17:55:09.723] [bbotk]  788aaea1-2856-4ea2-a75e-ad63caf24a68
INFO  [17:55:09.726] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:09.771] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:09.778] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:10.167] [mlr3] Finished benchmark
INFO  [17:55:10.207] [bbotk] Result of batch 6:
INFO  [17:55:10.210] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:10.210] [bbotk]                0.4126345   0.9666667        0      0             0.38
INFO  [17:55:10.210] [bbotk]                                 uhash
INFO  [17:55:10.210] [bbotk]  9e1c1ea1-abeb-4798-9f99-504815c5f1aa
INFO  [17:55:10.214] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:10.257] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:10.264] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:10.642] [mlr3] Finished benchmark
INFO  [17:55:10.677] [bbotk] Result of batch 7:
INFO  [17:55:10.679] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:10.679] [bbotk]                0.1601827           1        0      0             0.37
INFO  [17:55:10.679] [bbotk]                                 uhash
INFO  [17:55:10.679] [bbotk]  ec881d3b-3819-498a-9989-7a56b13c9376
INFO  [17:55:10.698] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:10.760] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:10.767] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:11.145] [mlr3] Finished benchmark
INFO  [17:55:11.185] [bbotk] Result of batch 8:
INFO  [17:55:11.187] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:11.187] [bbotk]                0.8289039           1        0      0             0.37
INFO  [17:55:11.187] [bbotk]                                 uhash
INFO  [17:55:11.187] [bbotk]  b3fb3712-4df7-4a1d-bf97-6728770b8f2d
INFO  [17:55:11.191] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:11.260] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:11.268] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:11.632] [mlr3] Finished benchmark
INFO  [17:55:11.664] [bbotk] Result of batch 9:
INFO  [17:55:11.666] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:11.666] [bbotk]                0.9111099   0.9666667        0      0            0.355
INFO  [17:55:11.666] [bbotk]                                 uhash
INFO  [17:55:11.666] [bbotk]  27d05389-4e28-4eef-b576-c555b08df2d5
INFO  [17:55:11.670] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:11.715] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:11.721] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:12.109] [mlr3] Finished benchmark
INFO  [17:55:12.142] [bbotk] Result of batch 10:
INFO  [17:55:12.144] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:12.144] [bbotk]                0.9065234   0.9666667        0      0             0.38
INFO  [17:55:12.144] [bbotk]                                 uhash
INFO  [17:55:12.144] [bbotk]  2ecc94e0-5f5d-4610-97c4-a938a454c13e
INFO  [17:55:12.147] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:12.192] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:12.199] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:12.571] [mlr3] Finished benchmark
INFO  [17:55:12.604] [bbotk] Result of batch 11:
INFO  [17:55:12.606] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:12.606] [bbotk]                0.9017083           1        0      0            0.363
INFO  [17:55:12.606] [bbotk]                                 uhash
INFO  [17:55:12.606] [bbotk]  dce2b13a-59d5-410b-b157-e89eed5b50e7
INFO  [17:55:12.609] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:12.653] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:12.660] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:13.027] [mlr3] Finished benchmark
INFO  [17:55:13.059] [bbotk] Result of batch 12:
INFO  [17:55:13.061] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:13.061] [bbotk]                0.4936158           1        0      0            0.358
INFO  [17:55:13.061] [bbotk]                                 uhash
INFO  [17:55:13.061] [bbotk]  dd3c218f-3bc8-45f6-8e3b-97db26037a23
INFO  [17:55:13.064] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:13.108] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:13.115] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:13.480] [mlr3] Finished benchmark
INFO  [17:55:13.513] [bbotk] Result of batch 13:
INFO  [17:55:13.515] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:13.515] [bbotk]                0.5996826           1        0      0            0.357
INFO  [17:55:13.515] [bbotk]                                 uhash
INFO  [17:55:13.515] [bbotk]  9c9117f3-e73c-4352-bd74-ffac7218fd30
INFO  [17:55:13.518] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:13.560] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:13.567] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:13.940] [mlr3] Finished benchmark
INFO  [17:55:13.972] [bbotk] Result of batch 14:
INFO  [17:55:13.974] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:13.974] [bbotk]                0.8073887           1        0      0            0.366
INFO  [17:55:13.974] [bbotk]                                 uhash
INFO  [17:55:13.974] [bbotk]  c3f26899-dcfd-44cb-afff-1b8d58958566
INFO  [17:55:13.978] [bbotk] Evaluating 1 configuration(s)
INFO  [17:55:14.022] [mlr3] Running benchmark with 1 resampling iterations
INFO  [17:55:14.028] [mlr3] Applying learner 'scale.classif.cv_glmnet' on task 'iris' (iter 1/1)
INFO  [17:55:14.398] [mlr3] Finished benchmark
INFO  [17:55:14.430] [bbotk] Result of batch 15:
INFO  [17:55:14.432] [bbotk]  classif.cv_glmnet.alpha classif.acc warnings errors runtime_learners
INFO  [17:55:14.432] [bbotk]                0.6659255           1        0      0            0.361
INFO  [17:55:14.432] [bbotk]                                 uhash
INFO  [17:55:14.432] [bbotk]  f50cd0a6-3c1a-42ae-890d-0efdf7c1a505
INFO  [17:55:14.441] [bbotk] Finished optimizing after 15 evaluation(s)
INFO  [17:55:14.442] [bbotk] Result:
INFO  [17:55:14.443] [bbotk]  classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
INFO  [17:55:14.443] [bbotk]                0.7946393          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
1:               0.7946393          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># Resultado</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>instance<span class="sc">$</span>result</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   classif.cv_glmnet.alpha learner_param_vals  x_domain classif.acc
1:               0.7946393          &lt;list[6]&gt; &lt;list[1]&gt;           1</code></pre>
</div>
</div>
<p>El proceso de optimización nos da un <span class="math inline">\(\alpha\)</span> de 0.6604496 con un porcentaje de clasificación correcta del 87.5%. Utilizamos este valor para obtener el modelo definitivo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="co"># Algoritmo de aprendizaje </span></span>
<span id="cb89-3"><a href="#cb89-3"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.glmnet"</span>,  <span class="at">type.multinomial =</span> <span class="st">"ungrouped"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb89-4"><a href="#cb89-4"></a>              <span class="at">alpha =</span> instance<span class="sc">$</span>result<span class="sc">$</span>classif.cv_glmnet.alpha)</span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb89-7"><a href="#cb89-7"></a>gr <span class="ot">=</span>  pp_iris <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb89-8"><a href="#cb89-8"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb89-10"><a href="#cb89-10"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_iris)</span>
<span id="cb89-11"><a href="#cb89-11"></a><span class="co"># Modelo obtenido para todos los lambda</span></span>
<span id="cb89-12"><a href="#cb89-12"></a>modelo_AA <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.glmnet<span class="sc">$</span>model</span>
<span id="cb89-13"><a href="#cb89-13"></a><span class="co"># Lambda óptimo</span></span>
<span id="cb89-14"><a href="#cb89-14"></a>lmin <span class="ot">=</span> modelo_AA<span class="sc">$</span>lambda[<span class="dv">100</span>]</span>
<span id="cb89-15"><a href="#cb89-15"></a><span class="do">##############################################</span></span>
<span id="cb89-16"><a href="#cb89-16"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.glmnet"</span>,  <span class="at">type.multinomial =</span> <span class="st">"ungrouped"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb89-17"><a href="#cb89-17"></a>              <span class="at">alpha =</span> instance<span class="sc">$</span>result<span class="sc">$</span>classif.cv_glmnet.alpha, </span>
<span id="cb89-18"><a href="#cb89-18"></a>              <span class="at">lambda =</span> lmin)</span>
<span id="cb89-19"><a href="#cb89-19"></a><span class="co"># Proceso de aprendizaje</span></span>
<span id="cb89-20"><a href="#cb89-20"></a><span class="co"># Graphlearner: Estructura del modelo y learner</span></span>
<span id="cb89-21"><a href="#cb89-21"></a>gr <span class="ot">=</span>  pp_cancer <span class="sc">%&gt;&gt;%</span> learner</span>
<span id="cb89-22"><a href="#cb89-22"></a>gr <span class="ot">=</span> GraphLearner<span class="sc">$</span><span class="fu">new</span>(gr)</span>
<span id="cb89-23"><a href="#cb89-23"></a><span class="co"># Entrenamiento del modelo</span></span>
<span id="cb89-24"><a href="#cb89-24"></a>gr<span class="sc">$</span><span class="fu">train</span>(tsk_train_iris)</span>
<span id="cb89-25"><a href="#cb89-25"></a><span class="co"># Modelo resultante</span></span>
<span id="cb89-26"><a href="#cb89-26"></a>modelo_glmnet_AA <span class="ot">=</span> gr<span class="sc">$</span>model<span class="sc">$</span>classif.glmnet<span class="sc">$</span>model</span>
<span id="cb89-27"><a href="#cb89-27"></a>modelo_glmnet_AA</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  (if (cv) glmnet::cv.glmnet else glmnet::glmnet)(x = data, y = target,      family = "multinomial", alpha = 0.794639304999309, lambda = 5.46223434838074e-05,      standardize = FALSE, type.multinomial = "ungrouped") 

  Df  %Dev    Lambda
1  4 98.14 5.462e-05</code></pre>
</div>
</div>
<p>El modelo considera 4 predictoras con un porcentaje de clasificación correcta del 97.79% similar al que teníamos con le modelo anterior. En este caso el estudio de los coeficientes es algo más complejo ya que tenemos un conjunto para cada nivel de la respuesta. Preparamos los coeficientes de cada nivel para su representación gráfica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Data frame con los coeficientes obtenidos y su codificación) positivo-negativo quitando intercept</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>coeficientes <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">as.matrix</span>(modelo_glmnet_AA<span class="sc">$</span>beta<span class="sc">$</span><span class="st">`</span><span class="at">Iris-virginica</span><span class="st">`</span>),</span>
<span id="cb91-3"><a href="#cb91-3"></a>      <span class="fu">as.matrix</span>(modelo_glmnet_AA<span class="sc">$</span>beta<span class="sc">$</span><span class="st">`</span><span class="at">Iris-versicolor</span><span class="st">`</span>),</span>
<span id="cb91-4"><a href="#cb91-4"></a>      <span class="fu">as.matrix</span>(modelo_glmnet_AA<span class="sc">$</span>beta<span class="sc">$</span><span class="st">`</span><span class="at">Iris-setosa</span><span class="st">`</span>))</span>
<span id="cb91-5"><a href="#cb91-5"></a>variables <span class="ot">=</span> <span class="fu">rownames</span>(coeficientes)</span>
<span id="cb91-6"><a href="#cb91-6"></a></span>
<span id="cb91-7"><a href="#cb91-7"></a>coeficientes <span class="ot">=</span> <span class="fu">as.data.frame</span>(coeficientes)</span>
<span id="cb91-8"><a href="#cb91-8"></a><span class="fu">names</span>(coeficientes)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"Estimate"</span></span>
<span id="cb91-9"><a href="#cb91-9"></a>coeficientes<span class="sc">$</span>Variable <span class="ot">=</span> variables</span>
<span id="cb91-10"><a href="#cb91-10"></a>coeficientes<span class="sc">$</span>Species <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Iris-virginica"</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="st">"Iris-versicolor"</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="st">"Iris-setosa"</span>, <span class="dv">4</span>))</span>
<span id="cb91-11"><a href="#cb91-11"></a>coeficientes<span class="sc">$</span>Valor <span class="ot">=</span> <span class="fu">ifelse</span>(coeficientes<span class="sc">$</span>Estimate <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Positivo"</span>, <span class="st">"Negativo"</span>)</span>
<span id="cb91-12"><a href="#cb91-12"></a><span class="co"># Gráfico de coeficientes</span></span>
<span id="cb91-13"><a href="#cb91-13"></a><span class="fu">ggplot</span>(coeficientes, <span class="fu">aes</span>(Estimate, Variable, <span class="at">color =</span> Valor)) <span class="sc">+</span> </span>
<span id="cb91-14"><a href="#cb91-14"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Species), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span> </span>
<span id="cb91-15"><a href="#cb91-15"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="70_LogisticModels_files/figure-html/reglog-043-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Coeficientes del modelo actualizado. Task Iris</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Apreciamos claramente los coeficientes que contribuyen al aumento de la probabilidad de clasificación como maligno (puntos en azul) frente a los que no (puntos en rojo).</p>
</section>
</section>
</section>
<section id="sec-70.5" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="sec-70.5"><span class="header-section-number">7.5</span> Ejercicios</h2>
<ol type="1">
<li>Ajustar un modelo de aprendizaje automático basado en modelos de regresión logística para el banco de datos <code>Mushroom</code><a href="40_DataBases.html#sec-mushroom"><span>4.3.4</span></a>.</li>
<li>Ajustar un modelo de aprendizaje automático basado en modelos de regresión logística para el banco de datos <code>Water potability</code><a href="40_DataBases.html#sec-waterpot"><span>4.3.7</span></a>.</li>
<li>Ajustar un modelo de aprendizaje automático basado en modelos de regresión logística para el banco de datos <code>Hepatitis</code><a href="40_DataBases.html#sec-hepatitis"><span>4.3.9</span></a>.</li>
<li>Ajustar un modelo de aprendizaje automático basado en modelos de regresión logística para el banco de datos <code>Abalone</code><a href="40_DataBases.html#sec-abalone"><span>4.3.1</span></a>.</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "¡Copiado!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "¡Copiado!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./60_RegressionModels.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos de Regresión</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./80_SurvivalModels.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modelos de supervivencia</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, IA4LEGOS. Universidad Miguel Hernández de Elche</div>   
  </div>
</footer>



</body></html>